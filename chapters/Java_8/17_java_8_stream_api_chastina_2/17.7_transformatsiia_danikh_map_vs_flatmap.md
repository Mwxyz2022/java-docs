---
layout: default
title: "–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö: map() vs flatMap()"
parent: "Stream API"
grand_parent: "Java 8"
nav_order: 7
---

# –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö: map() vs flatMap()

* –∫–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å: `map()` –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç —Å—Ç—Ä—ñ–º—É –Ω–∞ –æ–¥–∏–Ω —ñ–Ω—à–∏–π –æ–±'—î–∫—Ç (`–æ–¥–∏–Ω-–¥–æ-–æ–¥–Ω–æ–≥–æ`). `flatMap()` –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç –Ω–∞ –ø–æ—Ç—ñ–∫ (—Å—Ç—Ä—ñ–º), –∞ –ø–æ—Ç—ñ–º —Å–ø–ª—é—â—É—î –≤—Å—ñ —Ü—ñ —Å—Ç—Ä—ñ–º–∏ –≤ –æ–¥–∏–Ω –∑–∞–≥–∞–ª—å–Ω–∏–π (`–±–∞–≥–∞—Ç–æ-–¥–æ –æ–¥–Ω–æ–≥–æ`, `flattening`).

* –ø–æ–Ω—è—Ç—Ç—è: `map()`, `flatMap()`, `flattening`.

* –ø—Ä–∏–∫–ª–∞–¥–∏: `lines.stream().map(line -> line.split(" "))` (–ø–æ–≤–µ—Ä–Ω–µ `Stream<String[]>`), `lines.stream().flatMap(line -> Arrays.stream(line.split(" ")))` (–ø–æ–≤–µ—Ä–Ω–µ `Stream<String>`).

* –∫–ª—é—á–æ–≤—ñ –º–æ–º–µ–Ω—Ç–∏: `flatMap()` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤–∫–ª–∞–¥–µ–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä (—Å–ø–∏—Å–∫—ñ–≤ —Å–ø–∏—Å–∫—ñ–≤, –º–∞—Å–∏–≤—ñ–≤ –º–∞—Å–∏–≤—ñ–≤) —É —î–¥–∏–Ω–∏–π –ø–æ—Ç—ñ–∫.

* —â–æ –≤–∞–∂–ª–∏–≤–æ –∑–Ω–∞—Ç–∏ –Ω–∞ —Å–ø—ñ–≤–±–µ—Å—ñ–¥—ñ: –ß—ñ—Ç–∫–∞ —Ä—ñ–∑–Ω–∏—Ü—è, –∫–æ–ª–∏ —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏.

### **‚úÖ –û—Ñ—ñ—Ü—ñ–π–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è:**

* **`map()`** ‚Äî –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç —Å—Ç—Ä—ñ–º—É –≤ —ñ–Ω—à–∏–π –æ–±‚Äô—î–∫—Ç, –ø–æ–≤–µ—Ä—Ç–∞—é—á–∏ **–æ–¥–∏–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ –æ–¥–∏–Ω –µ–ª–µ–º–µ–Ω—Ç**.
* **`flatMap()`** ‚Äî –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç —É **–ø–æ—Ç—ñ–∫** (—Å—Ç—Ä—ñ–º), –∞ –ø–æ—Ç—ñ–º **—Å–ø–ª—é—â—É—î** –≤—Å—ñ —Å—Ç—Ä—ñ–º–∏ –≤ –æ–¥–∏–Ω –∑–∞–≥–∞–ª—å–Ω–∏–π.

### **üß† –ü—Ä–æ—Å—Ç–∏–º–∏ —Å–ª–æ–≤–∞–º–∏:**

* **`map()`** ‚Äî —Ü–µ —è–∫ *"–æ–±–≥–æ—Ä–Ω—É—Ç–∏ —Ü—É–∫–µ—Ä–∫—É –≤ –æ–±–≥–æ—Ä—Ç–∫—É"*.
* **`flatMap()`** ‚Äî *"—Ä–æ–∑–ø–∞–∫—É–≤–∞—Ç–∏ –≤—Å—ñ —Ü—É–∫–µ—Ä–∫–∏ –∑ –∫–æ—Ä–æ–±–æ–∫ —ñ –≤–∏—Å–∏–ø–∞—Ç–∏ –Ω–∞ —Å—Ç—ñ–ª"*.  
  –ó–∞–º—ñ—Å—Ç—å **`Stream<Stream<T>>`** —Ç–∏ –æ—Ç—Ä–∏–º—É—î—à –ø—Ä–æ—Å—Ç–æ **`Stream<T>`**.

---

## üìä **–ü–æ—Ä—ñ–≤–Ω—è–ª—å–Ω–∞ —Ç–∞–±–ª–∏—Ü—è:**

|      –ú–µ—Ç–æ–¥      |          –©–æ –ø—Ä–∏–π–º–∞—î          |   –©–æ –ø–æ–≤–µ—Ä—Ç–∞—î   |          –î–ª—è —á–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è          |
|:---------------:|:----------------------------:|:---------------:|:-------------------------------------------:|
|   **`map()`**   |     **`Function<T, R>`**     | **`Stream<R>`** |        –ó–∞–º—ñ–Ω–∞/–ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤        |
| **`flatMap()`** | **`Function<T, Stream<R>>`** | **`Stream<R>`** | –†–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤–∫–ª–∞–¥–µ–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä (flattening) |

---

## **–ü–æ—è—Å–Ω–µ–Ω–Ω—è –Ω–∞ –ø–∞–ª—å—Ü—è—Ö (üí°)**

–£—è–≤–∏, —Ç–∏ –º–∞—î—à —Å–ø–∏—Å–æ–∫ —É—á–Ω—ñ–≤, –∞ –≤ –∫–æ–∂–Ω–æ–≥–æ —î —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç—ñ–≤.

* **`map()`** –¥–∞—î —Ç–æ–±—ñ —Å–ø–∏—Å–æ–∫ —Å–ø–∏—Å–∫—ñ–≤ –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ (**`Stream<List<String>>`**)
* **`flatMap()`** –¥–∞—î —Ç–æ–±—ñ **–æ–¥–∏–Ω —Å—Ç—Ä—ñ–º —É—Å—ñ—Ö –ø—Ä–µ–¥–º–µ—Ç—ñ–≤**, –Ω—ñ–±–∏ —Ç–∏ –≤—Å—ñ—Ö —É—á–Ω—ñ–≤ "—Ä–æ–∑–ø–∞–∫—É–≤–∞–≤" —ñ –∑—ñ–±—Ä–∞–≤ –≤ –æ–¥–Ω—É –∫—É–ø—É.

---

## **–ö–æ—Ä–∏—Å–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ (üß™)**

```java
// –î–∞–Ω—ñ: —Å–ø–∏—Å–æ–∫ —Ä—è–¥–∫—ñ–≤ –∑—ñ —Å–ª–æ–≤–∞–º–∏
List<String> lines = List.of("hello world", "java stream");

// map() -- –¥–∞—î Stream<String[]>
Stream<String[]> mapped = lines.stream()
                               .map(line -> line.split(" "));

// flatMap() -- –¥–∞—î Stream<String>
Stream<String> flattened = lines.stream()
                                .flatMap(line -> Arrays.stream(line.split(" ")));
```

```java
// –ü—Ä–∏–∫–ª–∞–¥ –∑ –≤–∫–ª–∞–¥–µ–Ω–∏–º–∏ –∫–æ–ª–µ–∫—Ü—ñ—è–º–∏
List<List<Integer>> nested = List.of(List.of(1, 2), List.of(3, 4));

// map --> Stream<List<Integer>>
Stream<List<Integer>> streamOfLists = nested.stream().map(x -> x);

// flatMap --> Stream<Integer>
Stream<Integer> streamOfInts = nested.stream().flatMap(List::stream);
```

```java
// map() –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç
List<String> names = List.of("John", "Jane");
names.stream()
     .map(String::toUpperCase)
     .forEach(System.out::println); // JOHN, JANE
```

---

## **–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è (‚öñÔ∏è)**

|         –ö—Ä–∏—Ç–µ—Ä—ñ–π         |                `map()`                |                `flatMap()`                |
|:------------------------:|:-------------------------------------:|:-----------------------------------------:|
|       **–ü–æ–≤–µ—Ä—Ç–∞—î**       |            **`Stream<R>`**            |     **`Stream<R>`** (–ø—ñ—Å–ª—è —Å–ø–ª—é—â–µ–Ω–Ω—è)     |
|       **–ü—Ä–∞—Ü—é—î –∑**       |         –ü—Ä—è–º–∏–º –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è–º          |          –í–∫–ª–∞–¥–µ–Ω–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏           |
|  **–¢–∏–ø–æ–≤–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**   | **`Stream<List<T>>`, `Stream<T[]>`**  |              **`Stream<T>`**              |
| **–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏** | –ö–æ–ª–∏ –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –≤ 1 | –ö–æ–ª–∏ –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î—Ç—å—Å—è —É —Å—Ç—Ä—ñ–º |

---

## **üß† –ú–Ω–µ–º–æ–Ω—ñ–∫–∞ –¥–ª—è –∑–∞–ø–∞–º‚Äô—è—Ç–æ–≤—É–≤–∞–Ω–Ω—è:**

**"map ‚Äî –∑–º—ñ–Ω—é–π, flatMap ‚Äî –≤–∏—Ç—Ä—É—à—É–π"**

üì¶ **`map()`** ‚Äî —Ç–∏ –∑–∞–ª–∏—à–∞—î—à –∫–æ—Ä–æ–±–∫–∏ –∑–∞–ø–∞–∫–æ–≤–∞–Ω–∏–º–∏  
üì§ **`flatMap()`** ‚Äî —Ç–∏ –≤—ñ–¥–∫—Ä–∏–≤–∞—î—à –∫–æ—Ä–æ–±–∫–∏ —ñ –≤–∏–π–º–∞—î—à —É—Å–µ, —â–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ

---

## **üü© –ü—ñ–¥—Å—É–º–æ–∫:**

* **`map()`** ‚Äî –∑–∞—Å—Ç–æ—Å–æ–≤—É—î —Ñ—É–Ω–∫—Ü—ñ—é –¥–æ –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞, –ø–æ–≤–µ—Ä—Ç–∞—î —Å—Ç—Ä—ñ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.
* **`flatMap()`** ‚Äî –∑–∞—Å—Ç–æ—Å–æ–≤—É—î —Ñ—É–Ω–∫—Ü—ñ—é, —è–∫–∞ –ø–æ–≤–µ—Ä—Ç–∞—î —Å—Ç—Ä—ñ–º, —ñ **"—Å–ø–ª—é—â—É—î"** —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –æ–¥–∏–Ω –ø–æ—Ç—ñ–∫.
* –ù–∞–π—á–∞—Å—Ç—ñ—à–µ **`flatMap()`** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –¥–ª—è **—Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤–∫–ª–∞–¥–µ–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä** (—Å–ø–∏—Å–∫–∏, –º–∞—Å–∏–≤–∏, —Å—Ç—Ä—ñ–º–∏).
* –î–∞—î —á–∏—Å—Ç–∏–π, –ª–∞–∫–æ–Ω—ñ—á–Ω–∏–π —ñ —á–∏—Ç–∞–±–µ–ª—å–Ω–∏–π –∫–æ–¥ –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑—ñ —Å–∫–ª–∞–¥–Ω–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏.

---

### **üîó –î–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–∂–µ—Ä–µ–ª–∞:**

* [**Oracle Java 8 Stream Documentation**](https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#flatMap-java.util.function.Function-)
* [**StackOverflow: map vs flatMap in Java Streams**](https://stackoverflow.com/questions/30627854/what-is-the-difference-between-map-and-flatmap-methods-in-java-8)

* * *

# **FAQ ‚Äî –ß–∞—Å—Ç—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è (‚ùì)**

### **1 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–©–æ —Ç–∞–∫–µ –ø—Ä–æ–º—ñ–∂–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è `map()` —ñ —è–∫–∞ —ó—ó –æ—Å–Ω–æ–≤–Ω–∞ –º–µ—Ç–∞?

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> **`map()`** ‚Äî —Ü–µ –æ–¥–Ω–∞ –∑ –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–∏—Ö –ø—Ä–æ–º—ñ–∂–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π –≤ `Stream API`.
>
> **–û—Å–Ω–æ–≤–Ω–∞ –º–µ—Ç–∞:** **–ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ (transform)** –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç –ø–æ—Ç–æ–∫—É –Ω–∞ —ñ–Ω—à–∏–π –µ–ª–µ–º–µ–Ω—Ç. –¶—è –æ–ø–µ—Ä–∞—Ü—ñ—è –∑–∞—Å—Ç–æ—Å–æ–≤—É—î –∑–∞–¥–∞–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é –¥–æ –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ —ñ –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–æ–≤–∏–π –ø–æ—Ç—ñ–∫, —â–æ —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —Ü—å–æ–≥–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è.
>
> **–ö–ª—é—á–æ–≤–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞:** –¶–µ –æ–ø–µ—Ä–∞—Ü—ñ—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è **"–æ–¥–∏–Ω-–≤-–æ–¥–∏–Ω" (one-to-one)**. –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –≤—Ö—ñ–¥–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —Ä—ñ–≤–Ω–æ –æ–¥–∏–Ω –≤–∏—Ö—ñ–¥–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç. –¢–∏–ø –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —É –≤–∏—Ö—ñ–¥–Ω–æ–º—É –ø–æ—Ç–æ—Ü—ñ –º–æ–∂–µ –±—É—Ç–∏ —ñ–Ω—à–∏–º, –Ω—ñ–∂ —É –≤—Ö—ñ–¥–Ω–æ–º—É.
>
> `map()` –ø—Ä–∏–π–º–∞—î –∞—Ä–≥—É–º–µ–Ω—Ç —Ç–∏–ø—É **`Function<T, R>`**.

#### **üìù –ê–Ω–∞–ª–æ–≥—ñ—è:**

–£—è–≤—ñ—Ç—å –∫–æ–Ω–≤–µ—î—Ä –∑ —è–±–ª—É–∫–∞–º–∏. `map()` ‚Äî —Ü–µ —Å—Ç–∞–Ω—Ü—ñ—è, —è–∫–∞ –±–µ—Ä–µ –∫–æ–∂–Ω–µ —è–±–ª—É–∫–æ —ñ —Ä–æ–±–∏—Ç—å –∑ –Ω—å–æ–≥–æ –±–∞–Ω–∫—É —è–±–ª—É—á–Ω–æ–≥–æ —Å–æ–∫—É. –ù–∞ –≤—Ö–æ–¥—ñ –±—É–ª–æ –æ–¥–Ω–µ —è–±–ª—É–∫–æ, –Ω–∞ –≤–∏—Ö–æ–¥—ñ ‚Äî –æ–¥–Ω–∞ –±–∞–Ω–∫–∞ —Å–æ–∫—É.

#### **üìù –ü—Ä–∏–∫–ª–∞–¥:**

```java
List<String> names = List.of("alice", "bob", "charlie");

// –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–∂–µ–Ω —Ä—è–¥–æ–∫ –Ω–∞ –π–æ–≥–æ –¥–æ–≤–∂–∏–Ω—É
List<Integer> lengths = names.stream()
                               .map(s -> s.length()) // –∞–±–æ String::length
                               .collect(Collectors.toList());

System.out.println(lengths); // [5, 3, 7]
```

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ë–∞–∑–æ–≤–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ—ó –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è "–æ–¥–∏–Ω-–≤-–æ–¥–∏–Ω" —Ç–∞ —ó—ó –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è. –ö–∞–Ω–¥–∏–¥–∞—Ç –ø–æ–≤–∏–Ω–µ–Ω –∑–Ω–∞—Ç–∏, —â–æ `map` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∑–º—ñ–Ω–∏ –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞.*

* * *

### **2 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–©–æ —Ç–∞–∫–µ –ø—Ä–æ–º—ñ–∂–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è `flatMap()` —ñ —á–∏–º –≤–æ–Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤–æ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≤—ñ–¥ `map()`?

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> **`flatMap()`** ‚Äî —Ü–µ —Ç–∞–∫–æ–∂ –ø—Ä–æ–º—ñ–∂–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è, –∞–ª–µ –≤–æ–Ω–∞ –≤–∏—Ä—ñ—à—É—î –±—ñ–ª—å—à —Å–∫–ª–∞–¥–Ω—É –∑–∞–¥–∞—á—É.
>
> **–û—Å–Ω–æ–≤–Ω–∞ –º–µ—Ç–∞:** –ü–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç –ø–æ—Ç–æ–∫—É –Ω–∞ **–ø–æ—Ç—ñ–∫ —ñ–Ω—à–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤** (`Stream`), –∞ –ø–æ—Ç—ñ–º **"—Å–ø–ª—é—â–∏—Ç–∏" (flatten)** –≤—Å—ñ —Ü—ñ –æ—Ç—Ä–∏–º–∞–Ω—ñ –ø–æ—Ç–æ–∫–∏ –≤ –æ–¥–∏–Ω —î–¥–∏–Ω–∏–π –ø–æ—Ç—ñ–∫.
>
> **–ü—Ä–∏–Ω—Ü–∏–ø–æ–≤–∞ –≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –≤—ñ–¥ `map()`:**
>
> * `map()`: –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è **"–æ–¥–∏–Ω-–≤-–æ–¥–∏–Ω"**.
> * `flatMap()`: –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è **"–æ–¥–∏–Ω-–≤-–±–∞–≥–∞—Ç–æ" (one-to-many)**.
>
> `flatMap()` –ø—Ä–∏–π–º–∞—î `Function<T, Stream<R>>`. –¢–æ–±—Ç–æ —Ñ—É–Ω–∫—Ü—ñ—è, –ø–µ—Ä–µ–¥–∞–Ω–∞ –≤ `flatMap`, –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ –º–∞—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –Ω–æ–≤–∏–π `Stream`, –∞ `flatMap` –ø–æ—Ç—ñ–º –æ–±'—î–¥–Ω–∞—î –≤—Å—ñ —Ü—ñ —Å—Ç—Ä—ñ–º–∏.

#### **üìù –ê–Ω–∞–ª–æ–≥—ñ—è:**

–£—è–≤—ñ—Ç—å, —â–æ —É –≤–∞—Å —î –∫—ñ–ª—å–∫–∞ –∫–æ—à–∏–∫—ñ–≤ –∑ —è–±–ª—É–∫–∞–º–∏.

* `map` –¥–∞–≤ –±–∏ –≤–∞–º –ø–æ—Ç—ñ–∫ –∫–æ—à–∏–∫—ñ–≤ (`Stream<List<Apple>>`).
* `flatMap` "–≤–∏—Ç—Ä—É—à—É—î" —è–±–ª—É–∫–∞ –∑ –∫–æ–∂–Ω–æ–≥–æ –∫–æ—à–∏–∫–∞ —ñ —Å—Ç–≤–æ—Ä—é—î –æ–¥–∏–Ω –≤–µ–ª–∏–∫–∏–π –ø–æ—Ç—ñ–∫ —è–±–ª—É–∫ (`Stream<Apple>`).

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–†–æ–∑—É–º—ñ–Ω–Ω—è –∫–æ–Ω—Ü–µ–ø—Ü—ñ—ó "—Å–ø–ª—é—â–µ–Ω–Ω—è" —Ç–∞ —Ç–æ–≥–æ, —â–æ `flatMap` –ø—Ä–∞—Ü—é—î –∑—ñ —Å—Ü–µ–Ω–∞—Ä—ñ—è–º–∏ "–æ–¥–∏–Ω-–≤-–±–∞–≥–∞—Ç–æ", –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—é—á–∏ –ø–æ—Ç—ñ–∫ –ø–æ—Ç–æ–∫—ñ–≤ –≤ –æ–¥–∏–Ω –ø–æ—Ç—ñ–∫.*

* * *

### **3 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–Ω–æ–Ω—ñ—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥, —â–æ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î —Ä—ñ–∑–Ω–∏—Ü—é –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ —Ä–æ–±–æ—Ç–∏ `map()` —Ç–∞ `flatMap()`.

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –ù–∞–π–∫—Ä–∞—â–∏–π –ø—Ä–∏–∫–ª–∞–¥ ‚Äî —Ü–µ —Ä–æ–∑–±–∏—Ç—Ç—è —Å–ø–∏—Å–∫—É —Ä–µ—á–µ–Ω—å –Ω–∞ –æ–∫—Ä–µ–º—ñ —Å–ª–æ–≤–∞.
>
> **–ó–∞–¥–∞—á–∞:** –ú–∞—é—á–∏ `List<String>`, –¥–µ –∫–æ–∂–µ–Ω —Ä—è–¥–æ–∫ ‚Äî —Ü–µ —Ä–µ—á–µ–Ω–Ω—è, –æ—Ç—Ä–∏–º–∞—Ç–∏ —î–¥–∏–Ω–∏–π —Å–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö —Å–ª—ñ–≤.
>
> **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `map()` (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–ª—è —Ü—ñ—î—ó –∑–∞–¥–∞—á—ñ):**
> –ú–µ—Ç–æ–¥ `line.split(" ")` –ø–æ–≤–µ—Ä—Ç–∞—î `String[]`. –û—Ç–∂–µ, `map` —Å—Ç–≤–æ—Ä–∏—Ç—å –ø–æ—Ç—ñ–∫ –º–∞—Å–∏–≤—ñ–≤ —Ä—è–¥–∫—ñ–≤.
>
> ```java
> List<String> lines = List.of("hello world", "java stream");
> List<String[]> resultWithMap = lines.stream()
>                                      .map(line -> line.split(" "))
>                                      .collect(Collectors.toList());
> // –†–µ–∑—É–ª—å—Ç–∞—Ç: List<String[]> -> [[hello, world], [java, stream]]
> ```
>
> –¶–µ –Ω–µ —Ç–µ, —â–æ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ.
>
> **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `flatMap()` (–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥):**
> –ú–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–∂–µ–Ω –º–∞—Å–∏–≤ —Å–ª—ñ–≤ –Ω–∞ –ø–æ—Ç—ñ–∫ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `Arrays.stream()`, –∞ `flatMap` –æ–±'—î–¥–Ω—É—î —ó—Ö –≤ –æ–¥–∏–Ω.
>
> ```java
> List<String> resultWithFlatMap = lines.stream()
>                                         .flatMap(line -> Arrays.stream(line.split(" ")))
>                                         .collect(Collectors.toList());
> // –†–µ–∑—É–ª—å—Ç–∞—Ç: List<String> -> [hello, world, java, stream]
> ```
>
> –¶–µ–π –ø—Ä–∏–∫–ª–∞–¥ –Ω–∞–æ—á–Ω–æ –ø–æ–∫–∞–∑—É—î, —è–∫ `flatMap` "—Å–ø–ª—é—â—É—î" —Å—Ç—Ä—É–∫—Ç—É—Ä—É `Stream<String[]>` –¥–æ `Stream<String>`.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ü—Ä–∞–∫—Ç–∏—á–Ω–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è —Ä—ñ–∑–Ω–∏—Ü—ñ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö. –ö–∞–Ω–¥–∏–¥–∞—Ç –ø–æ–≤–∏–Ω–µ–Ω —á—ñ—Ç–∫–æ –ø–æ—è—Å–Ω–∏—Ç–∏, —á–æ–º—É `map` –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ—Ç—ñ–∫ –º–∞—Å–∏–≤—ñ–≤, –∞ `flatMap` ‚Äî –ø–æ—Ç—ñ–∫ —Å–ª—ñ–≤.*

* * *

### **4 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–Ø–∫—ñ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ –ø—Ä–∏–π–º–∞—é—Ç—å –º–µ—Ç–æ–¥–∏ `map()` —Ç–∞ `flatMap()`?

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –°–∏–≥–Ω–∞—Ç—É—Ä–∏ —Ü–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ —ñ —î –∫–ª—é—á–µ–º –¥–æ —Ä–æ–∑—É–º—ñ–Ω–Ω—è —ó—Ö–Ω—å–æ—ó —Ä—ñ–∑–Ω–∏—Ü—ñ.
>
> * **`map(Function<T, R> mapper)`:**
>   * –ü—Ä–∏–π–º–∞—î `Function<T, R>`. –¶–µ —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ —Ç–∏–ø—É `T` –ø–æ–≤–µ—Ä—Ç–∞—î **–æ–¥–∏–Ω** —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–∏–ø—É `R`.
>
> * **`flatMap(Function<T, Stream<R>> mapper)`:**
>   * –ü—Ä–∏–π–º–∞—î `Function<T, Stream<R>>`. –¶–µ —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ —Ç–∏–ø—É `T` –ø–æ–≤–µ—Ä—Ç–∞—î **—Ü—ñ–ª–∏–π –ø–æ—Ç—ñ–∫** (`Stream`) –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —Ç–∏–ø—É `R`.
>
> –û—Ç–∂–µ, –æ—Å–Ω–æ–≤–Ω–∞ —Ä—ñ–∑–Ω–∏—Ü—è –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä—ñ ‚Äî —Ü–µ —Ç–∏–ø, —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î —Ñ—É–Ω–∫—Ü—ñ—è-–º–∞–ø–ø–µ—Ä: `R` –ø—Ä–æ—Ç–∏ `Stream<R>`.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–Ω–∞–Ω–Ω—è API —Ç–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä –æ—Å–Ω–æ–≤–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤. –†–æ–∑—É–º—ñ–Ω–Ω—è —Ç–∏–ø—ñ–≤ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏—Ö —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤ –ø–æ—è—Å–Ω—é—î, —è–∫ —Ü—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –ø—Ä–∞—Ü—é—é—Ç—å.*

* * *

### **5 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ù–∞–≤–µ–¥—ñ—Ç—å –ø—Ä–∏–∫–ª–∞–¥ `map` –¥–ª—è –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è `Stream<User>` –Ω–∞ `Stream<String>` (—ñ–º–µ–Ω–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤).

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –¶–µ –∫–ª–∞—Å–∏—á–Ω–∏–π –≤–∏–ø–∞–¥–æ–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `map` ‚Äî –≤–∏—Ç—è–≥–Ω—É—Ç–∏ –ø–µ–≤–Ω–µ –ø–æ–ª–µ –∑ –ø–æ—Ç–æ–∫—É –æ–±'—î–∫—Ç—ñ–≤.
>
> **–ó–∞–¥–∞—á–∞:** –ú–∞—é—á–∏ `Stream<User>`, –æ—Ç—Ä–∏–º–∞—Ç–∏ `Stream<String>` –∑ —ñ–º–µ–Ω–∞–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.
>
> –ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `map` –∑ —Ñ—É–Ω–∫—Ü—ñ—î—é, —è–∫–∞ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –æ–±'—î–∫—Ç–∞ `User` –≤–∏–∫–ª–∏–∫–∞—î –π–æ–≥–æ –º–µ—Ç–æ–¥ `getName()`. –¶–µ –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ —è–∫ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ª—è–º–±–¥–∏, —Ç–∞–∫ —ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –º–µ—Ç–æ–¥.

#### **üìù –ü—Ä–∏–∫–ª–∞–¥:**

```java
class User {
    private String name;
    public User(String name) { this.name = name; }
    public String getName() { return name; }
}

List<User> users = List.of(new User("Alice"), new User("Bob"));

// –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è map –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –Ω–∞ –º–µ—Ç–æ–¥ (–∫—Ä–∞—â–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç)
List<String> names = users.stream()
                          .map(User::getName)
                          .collect(Collectors.toList());

System.out.println(names); // [Alice, Bob]
```

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –Ω–∞–≤–∏—á–∫–∏ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è `map` –¥–ª—è –æ–¥–Ω–æ–≥–æ –∑ –Ω–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤ ‚Äî –ø—Ä–æ–µ–∫—Ü—ñ—ó –¥–∞–Ω–∏—Ö (–≤–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è –ø–æ–ª—ñ–≤).*

* * *

### **6 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ù–∞–≤–µ–¥—ñ—Ç—å –ø—Ä–∏–∫–ª–∞–¥ `flatMap` –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –≤–∫–ª–∞–¥–µ–Ω–∏—Ö –∫–æ–ª–µ–∫—Ü—ñ–π, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `List<List<Integer>>`.

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –¶–µ –æ—Å–Ω–æ–≤–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π, –¥–ª—è —è–∫–æ–≥–æ –±—É–ª–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ `flatMap`.
>
> **–ó–∞–¥–∞—á–∞:** –ú–∞—é—á–∏ —Å–ø–∏—Å–æ–∫ —Å–ø–∏—Å–∫—ñ–≤ —á–∏—Å–µ–ª, –æ—Ç—Ä–∏–º–∞—Ç–∏ –æ–¥–∏–Ω —î–¥–∏–Ω–∏–π —Å–ø–∏—Å–æ–∫ —É—Å—ñ—Ö —á–∏—Å–µ–ª.
>
> –ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `flatMap`, –ø–µ—Ä–µ–¥–∞—é—á–∏ –π–æ–º—É —Ñ—É–Ω–∫—Ü—ñ—é, —è–∫–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –∫–æ–∂–µ–Ω –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å–ø–∏—Å–æ–∫ –Ω–∞ –ø–æ—Ç—ñ–∫. –î–ª—è `List` —Ü–µ –ª–µ–≥–∫–æ –∑—Ä–æ–±–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –º–µ—Ç–æ–¥ `List::stream`.

#### **üìù –ü—Ä–∏–∫–ª–∞–¥:**

```java
List<List<Integer>> listOfLists = List.of(
    List.of(1, 2, 3),
    List.of(4, 5),
    List.of(6)
);

List<Integer> flattenedList = listOfLists.stream()
                                         // –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ list –≤–∏–∫–ª–∏–∫–∞—î–º–æ .stream(), 
                                         // —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ Stream<Integer>. flatMap —ó—Ö –æ–±'—î–¥–Ω—É—î.
                                         .flatMap(list -> list.stream()) 
                                         .collect(Collectors.toList());

System.out.println(flattenedList); // [1, 2, 3, 4, 5, 6]
```

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –Ω–∞–≤–∏—á–∫–∏ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è `flatMap` –¥–ª—è –Ω–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä—ñ—é ‚Äî "—Å–ø–ª—é—â–µ–Ω–Ω—è" –≤–∫–ª–∞–¥–µ–Ω–∏—Ö –∫–æ–ª–µ–∫—Ü—ñ–π.*

* * *

### **7 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ß–∏ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `map` —ñ `flatMap` —Ä–∞–∑–æ–º –≤ –æ–¥–Ω–æ–º—É –ª–∞–Ω—Ü—é–∂–∫—É? –ù–∞–≤–µ–¥—ñ—Ç—å –ø—Ä–∏–∫–ª–∞–¥.

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> **–¢–∞–∫, –∑–≤—ñ—Å–Ω–æ.** –¶–µ –¥—É–∂–µ –ø–æ—à–∏—Ä–µ–Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è –æ–±—Ä–æ–±–∫–∏ —Å–∫–ª–∞–¥–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–∏—Ö.
>
> **–°—Ü–µ–Ω–∞—Ä—ñ–π:** –£ –Ω–∞—Å —î `Map<String, List<String>>`, –¥–µ –∫–ª—é—á ‚Äî —Ü–µ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è, –∞ –∑–Ω–∞—á–µ–Ω–Ω—è ‚Äî —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ —É —Ü—ñ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó. –ù–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –æ–¥–∏–Ω —Å–ø–∏—Å–æ–∫ —É—Å—ñ—Ö –ø—Ä–æ–¥—É–∫—Ç—ñ–≤, –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–∏—Ö —É –≤–µ—Ä—Ö–Ω—ñ–π —Ä–µ–≥—ñ—Å—Ç—Ä.
>
> **–õ–∞–Ω—Ü—é–∂–æ–∫:**
>
> 1. –û—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ—Ç—ñ–∫ –∑–Ω–∞—á–µ–Ω—å –º–∞–ø–∏ (`Stream<List<String>>`).
> 2. "–°–ø–ª—é—â–∏—Ç–∏" —Ü–µ–π –ø–æ—Ç—ñ–∫ —Å–ø–∏—Å–∫—ñ–≤ –¥–æ –æ–¥–Ω–æ–≥–æ –ø–æ—Ç–æ–∫—É –ø—Ä–æ–¥—É–∫—Ç—ñ–≤ (`flatMap`).
> 3. –ü–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–∂–µ–Ω –ø—Ä–æ–¥—É–∫—Ç —É –≤–µ—Ä—Ö–Ω—ñ–π —Ä–µ–≥—ñ—Å—Ç—Ä (`map`).

#### **üìù –ü—Ä–∏–∫–ª–∞–¥:**

```java
Map<String, List<String>> categories = Map.of(
    "Fruits", List.of("apple", "banana"),
    "Vegetables", List.of("carrot")
);

List<String> allProductsUpperCase = categories.values().stream() // Stream<List<String>>
    .flatMap(List::stream)                 // Stream<String> -> "apple", "banana", "carrot"
    .map(String::toUpperCase)              // Stream<String> -> "APPLE", "BANANA", "CARROT"
    .collect(Collectors.toList());

System.out.println(allProductsUpperCase); // [APPLE, BANANA, CARROT] (–ø–æ—Ä—è–¥–æ–∫ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–∏–π)
```

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–¥–∞—Ç–Ω—ñ—Å—Ç—å –±—É–¥—É–≤–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—ñ –ª–∞–Ω—Ü—é–∂–∫–∏ –æ–ø–µ—Ä–∞—Ü—ñ–π, –∫–æ–º–±—ñ–Ω—É—é—á–∏ —Ä—ñ–∑–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ `Stream API`.*

* * *

### **8 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–©–æ –ø–æ–≤–µ—Ä–Ω–µ `stream.map(f)` —è–∫—â–æ —Ñ—É–Ω–∫—Ü—ñ—è `f` –ø–æ–≤–µ—Ä—Ç–∞—î `null`? ‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –û–ø–µ—Ä–∞—Ü—ñ—è `map` –Ω–µ –º–∞—î —è–∫–æ—ó—Å—å –æ—Å–æ–±–ª–∏–≤–æ—ó –æ–±—Ä–æ–±–∫–∏ –¥–ª—è `null`. –Ø–∫—â–æ —Ñ—É–Ω–∫—Ü—ñ—è-–º–∞–ø–ø–µ—Ä –ø–æ–≤–µ—Ä—Ç–∞—î `null`, —Ç–æ –≤–∏—Ö—ñ–¥–Ω–∏–π –ø–æ—Ç—ñ–∫ –ø—Ä–æ—Å—Ç–æ –±—É–¥–µ –º—ñ—Å—Ç–∏—Ç–∏ `null` —è–∫ –µ–ª–µ–º–µ–Ω—Ç.
>
> **–ü—Ä–∏–∫–ª–∞–¥:**
>
> ```java
> List<String> names = Arrays.asList("Alice", "Bob", null);
> Stream<Integer> lengthStream = names.stream()
>                                      .map(s -> (s == null) ? null : s.length());
> // lengthStream –±—É–¥–µ –º—ñ—Å—Ç–∏—Ç–∏: [5, 3, null]
> ```
>
> **–ù–µ–±–µ–∑–ø–µ–∫–∞:**
> –¶–µ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ `NullPointerException` —É –ø–æ–¥–∞–ª—å—à–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ—è—Ö, —è–∫—â–æ –≤–æ–Ω–∏ –Ω–µ –æ—á—ñ–∫—É—é—Ç—å `null`. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –ø—ñ—Å–ª—è —Ü—å–æ–≥–æ `map` —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `mapToInt`, —Ü–µ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ `NPE` –ø—Ä–∏ —Å–ø—Ä–æ–±—ñ unboxing'—É `null`.
>
> **–ö—Ä–∞—â–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞:**
> –ó–∞–≤–∂–¥–∏ —Ñ—ñ–ª—å—Ç—Ä—É–π—Ç–µ `null`'–∏ (`.filter(Objects::nonNull)`) –ø–µ—Ä–µ–¥ –∞–±–æ –ø—ñ—Å–ª—è –æ–ø–µ—Ä–∞—Ü—ñ—ó `map`, —â–æ–± —É–±–µ–∑–ø–µ—á–∏—Ç–∏ –ø–æ–¥–∞–ª—å—à–∏–π –ª–∞–Ω—Ü—é–∂–æ–∫.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–†–æ–∑—É–º—ñ–Ω–Ω—è —Ç–æ–≥–æ, —è–∫ `Stream API` –æ–±—Ä–æ–±–ª—è—î `null`-–∑–Ω–∞—á–µ–Ω–Ω—è, —Ç–∞ –≤–º—ñ–Ω–Ω—è –ø–∏—Å–∞—Ç–∏ –±–µ–∑–ø–µ—á–Ω–∏–π –∫–æ–¥, —â–æ —É–Ω–∏–∫–∞—î `NPE`.*

* * *

### **9 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–©–æ –ø–æ–≤–µ—Ä–Ω–µ `stream.flatMap(f)` —è–∫—â–æ —Ñ—É–Ω–∫—Ü—ñ—è `f` –ø–æ–≤–µ—Ä—Ç–∞—î `null` –∞–±–æ –ø–æ—Ä–æ–∂–Ω—ñ–π —Å—Ç—Ä—ñ–º? ‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –¶–µ –¥–≤–∞ —Ä—ñ–∑–Ω—ñ –≤–∏–ø–∞–¥–∫–∏ –∑ —Ä—ñ–∑–Ω–∏–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.
>
> * **–Ø–∫—â–æ —Ñ—É–Ω–∫—Ü—ñ—è –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ—Ä–æ–∂–Ω—ñ–π —Å—Ç—Ä—ñ–º (`Stream.empty()`):**
>     `flatMap` –∫–æ—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–æ–±–∏—Ç—å —Ü—é —Å–∏—Ç—É–∞—Ü—ñ—é. –ü–æ—Ä–æ–∂–Ω—ñ–π —Å—Ç—Ä—ñ–º –ø—Ä–æ—Å—Ç–æ –Ω–µ –¥–æ–¥–∞—Å—Ç—å –∂–æ–¥–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ –¥–æ –∫—ñ–Ω—Ü–µ–≤–æ–≥–æ –ø–æ—Ç–æ–∫—É. –¶–µ –±–µ–∑–ø–µ—á–Ω–∞ —ñ —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó —Ç–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ).
>
> * **–Ø–∫—â–æ —Ñ—É–Ω–∫—Ü—ñ—è –ø–æ–≤–µ—Ä—Ç–∞—î `null`:**
>     –¶–µ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ **`NullPointerException`**. –û–ø–µ—Ä–∞—Ü—ñ—è `flatMap` –æ—á—ñ–∫—É—î –æ—Ç—Ä–∏–º–∞—Ç–∏ `Stream` –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞. –Ø–∫—â–æ –≤–æ–Ω–∞ –æ—Ç—Ä–∏–º—É—î `null`, –≤–æ–Ω–∞ –Ω–µ –º–æ–∂–µ –Ω–∞ –Ω—å–æ–º—É –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—ó –¥–ª—è "—Å–ø–ª—é—â–µ–Ω–Ω—è" —ñ –ø–∞–¥–∞—î –∑ –ø–æ–º–∏–ª–∫–æ—é.
>
> **–ü—Ä–∞–≤–∏–ª–æ:** –§—É–Ω–∫—Ü—ñ—è, —â–æ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –≤ `flatMap`, **–Ω—ñ–∫–æ–ª–∏ –Ω–µ –ø–æ–≤–∏–Ω–Ω–∞ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ `null`**. –Ø–∫—â–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –Ω–µ–º–∞—î, –≤–æ–Ω–∞ –º–∞—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ `Stream.empty()`.

#### **üìù –ü—Ä–∏–∫–ª–∞–¥:**

```java
// –ë–ï–ó–ü–ï–ß–ù–û: –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –ø–æ—Ä–æ–∂–Ω—å–æ–≥–æ —Å—Ç—Ä—ñ–º—É
stream.flatMap(s -> s.isEmpty() ? Stream.empty() : Stream.of(s))

// –ù–ï–ë–ï–ó–ü–ï–ß–ù–û: –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è null
// stream.flatMap(s -> s.isEmpty() ? null : Stream.of(s)) // NPE
```

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–Ω–∞–Ω–Ω—è –ø—Ä–∞–≤–∏–ª —Ç–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤ `flatMap`. –¶–µ –≤–∞–∂–ª–∏–≤–µ –ø–∏—Ç–∞–Ω–Ω—è –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –Ω–∞–¥—ñ–π–Ω–æ–≥–æ –∫–æ–¥—É, —è–∫–µ –ø–æ–∫–∞–∑—É—î, —â–æ –∫–∞–Ω–¥–∏–¥–∞—Ç –∑–Ω–∞—î –ø—Ä–æ –ø–æ—à–∏—Ä–µ–Ω—É –ø–∞—Å—Ç–∫—É –∑ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è–º `null`.*

* * *

### **10 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–Ø–∫ `flatMap` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ `Optional`? ‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –ö–æ–Ω—Ü–µ–ø—Ü—ñ—è `flatMap` —î –Ω–µ —Ç—ñ–ª—å–∫–∏ –≤ `Stream`, –∞–ª–µ —ñ –≤ `Optional`, —ñ –≤–∏—Ä—ñ—à—É—î —Å—Ö–æ–∂—É –ø—Ä–æ–±–ª–µ–º—É ‚Äî —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –≤–∫–ª–∞–¥–µ–Ω–æ—Å—Ç—ñ.
>
> * **`Optional.map(Function<T, R> f)`:**
>   * –Ø–∫—â–æ `Optional` –º—ñ—Å—Ç–∏—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è, `map` –∑–∞—Å—Ç–æ—Å–æ–≤—É—î –¥–æ –Ω—å–æ–≥–æ —Ñ—É–Ω–∫—Ü—ñ—é. –Ø–∫—â–æ —Ñ—É–Ω–∫—Ü—ñ—è –ø–æ–≤–µ—Ä—Ç–∞—î `R`, —Ç–æ `map` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–≥–æ—Ä—Ç–∞—î —Ü–µ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `Optional<R>`.
>   * –ü—Ä–æ–±–ª–µ–º–∞: —è–∫—â–æ —Ñ—É–Ω–∫—Ü—ñ—è —Å–∞–º–∞ –ø–æ —Å–æ–±—ñ –ø–æ–≤–µ—Ä—Ç–∞—î `Optional<R>`, —Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –±—É–¥–µ **–≤–∫–ª–∞–¥–µ–Ω–∏–π `Optional<Optional<R>>`**.
>
> * **`Optional.flatMap(Function<T, Optional<R>> f)`:**
>   * "–°–ø–ª—é—â—É—î" —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –Ø–∫—â–æ —Ñ—É–Ω–∫—Ü—ñ—è –ø–æ–≤–µ—Ä—Ç–∞—î `Optional<R>`, `flatMap` –Ω–µ –±—É–¥–µ –¥–æ–¥–∞—Ç–∫–æ–≤–æ –∑–∞–≥–æ—Ä—Ç–∞—Ç–∏ –π–æ–≥–æ. –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –±—É–¥–µ –ø—Ä–æ—Å—Ç–æ `Optional<R>`.
>
> **–ö–æ–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:** `flatMap` –Ω–∞ `Optional` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è, –∫–æ–ª–∏ –≤–∏ —Ö–æ—á–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ª–∞–Ω—Ü—é–∂–æ–∫ –≤–∏–∫–ª–∏–∫—ñ–≤ –º–µ—Ç–æ–¥—ñ–≤, –∫–æ–∂–µ–Ω –∑ —è–∫–∏—Ö –º–æ–∂–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ `Optional`.

#### **üìù –ü—Ä–∏–∫–ª–∞–¥:**

```java
class User { Optional<Address> getAddress() { ... } }
class Address { Optional<String> getStreet() { ... } }

User user = ...;
// map —Å—Ç–≤–æ—Ä–∏–≤ –±–∏ Optional<Optional<String>>
Optional<Optional<String>> nested = user.getAddress().map(Address::getStreet); 

// flatMap "—Å–ø–ª—é—â—É—î" –¥–æ Optional<String>
Optional<String> street = user.getAddress().flatMap(Address::getStreet);
```

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–†–æ–∑—É–º—ñ–Ω–Ω—è —Ç–æ–≥–æ, —â–æ `flatMap` ‚Äî —Ü–µ –∑–∞–≥–∞–ª—å–Ω–∏–π –ø–∞—Ç–µ—Ä–Ω –¥–ª—è –º–æ–Ω–∞–¥–Ω–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä, –∞ –Ω–µ —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Å—Ç—Ä—ñ–º—ñ–≤. –¶–µ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –±—ñ–ª—å—à –≥–ª–∏–±–æ–∫–µ, –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è.*

* * *

### **11 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–Ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å `flatMap` –ø–æ—Ä—ñ–≤–Ω—è–Ω–æ –∑ `map`? –ß–∏ —î –≤—ñ–Ω –¥–æ—Ä–æ–∂—á–æ—é –æ–ø–µ—Ä–∞—Ü—ñ—î—é? ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> **–¢–∞–∫, `flatMap` –∑–∞–∑–≤–∏—á–∞–π —î –¥–æ—Ä–æ–∂—á–æ—é –æ–ø–µ—Ä–∞—Ü—ñ—î—é**, –Ω—ñ–∂ `map`.
>
> **–ü—Ä–∏—á–∏–Ω–∏:**
>
> 1. **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –æ–±'—î–∫—Ç—ñ–≤:**
>     * `map` –ø—Ä–æ—Å—Ç–æ —Å—Ç–≤–æ—Ä—é—î –æ–¥–∏–Ω –≤–∏—Ö—ñ–¥–Ω–∏–π –æ–±'—î–∫—Ç –Ω–∞ –æ–¥–∏–Ω –≤—Ö—ñ–¥–Ω–∏–π.
>     * `flatMap` –≤–∏–º–∞–≥–∞—î –≤—ñ–¥ —Ñ—É–Ω–∫—Ü—ñ—ó-–º–∞–ø–ø–µ—Ä–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è **—Ü—ñ–ª–æ–≥–æ –Ω–æ–≤–æ–≥–æ `Stream`** –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–æ—Ç–æ–∫—É —Ç–∞ –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ –Ω–∏–º –æ–±'—î–∫—Ç—ñ–≤ (—è–∫ `Spliterator`) –º–∞—î —Å–≤–æ—ó –Ω–∞–∫–ª–∞–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏.
>
> 2. **–†–æ–±–æ—Ç–∞ –∑—ñ "—Å–ø–ª—é—â–µ–Ω–Ω—è–º":**
>     –ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–æ –ø–æ—Ç—ñ–∫, `flatMap` –ø–æ–≤–∏–Ω–µ–Ω –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—É —Ä–æ–±–æ—Ç—É, —â–æ–± –æ–±'—î–¥–Ω–∞—Ç–∏ –≤—Å—ñ —Ü—ñ –º–∞–ª–µ–Ω—å–∫—ñ –ø–æ—Ç–æ–∫–∏ –≤ –æ–¥–∏–Ω –≤–µ–ª–∏–∫–∏–π.
>
> –•–æ—á–∞ `Stream API` –¥—É–∂–µ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–æ, —Ü—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –∫—Ä–æ–∫–∏ —Ä–æ–±–ª—è—Ç—å `flatMap` ÿ®ÿ∑ÿ®Ÿäÿπÿ™Ÿá –±—ñ–ª—å—à —Ä–µ—Å—É—Ä—Å–æ–º—ñ—Å—Ç–∫–∏–º, –Ω—ñ–∂ `map`. –¶–µ –æ—Å–æ–±–ª–∏–≤–æ –ø–æ–º—ñ—Ç–Ω–æ, —è–∫—â–æ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —î –≤–µ–ª–∏–∫–æ—é.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–†–æ–∑—É–º—ñ–Ω–Ω—è –Ω–∞—Å–ª—ñ–¥–∫—ñ–≤ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –≤—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä—ñ–∑–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π. –ö–∞–Ω–¥–∏–¥–∞—Ç –ø–æ–≤–∏–Ω–µ–Ω —É—Å–≤—ñ–¥–æ–º–ª—é–≤–∞—Ç–∏, —â–æ `flatMap` –º–∞—î —Å–≤–æ—é "—Ü—ñ–Ω—É".*

* * *

### **12 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–Ø–∫ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `flatMap` —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –¥–µ–∫–∞—Ä—Ç–æ–≤–∏–π –¥–æ–±—É—Ç–æ–∫ –¥–≤–æ—Ö —Å–ø–∏—Å–∫—ñ–≤? ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –î–µ–∫–∞—Ä—Ç–æ–≤–∏–π –¥–æ–±—É—Ç–æ–∫ (—É—Å—ñ –º–æ–∂–ª–∏–≤—ñ –ø–∞—Ä–∏ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –∑ –¥–≤–æ—Ö —Å–ø–∏—Å–∫—ñ–≤) —î –∫–ª–∞—Å–∏—á–Ω–∏–º —ñ –¥—É–∂–µ –∫—Ä–∞—Å–∏–≤–∏–º –ø—Ä–∏–∫–ª–∞–¥–æ–º –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è `flatMap`.
>
> **–Ü–¥–µ—è:**
>
> 1. –ú–∏ –±–µ—Ä–µ–º–æ –ø–æ—Ç—ñ–∫ –ø–µ—Ä—à–æ–≥–æ —Å–ø–∏—Å–∫—É.
> 2. –î–ª—è **–∫–æ–∂–Ω–æ–≥–æ** –µ–ª–µ–º–µ–Ω—Ç–∞ –ø–µ—Ä—à–æ–≥–æ —Å–ø–∏—Å–∫—É (`n1`) –º–∏ —Å—Ç–≤–æ—Ä—é—î–º–æ **–Ω–æ–≤–∏–π –ø–æ—Ç—ñ–∫ –∑ –¥—Ä—É–≥–æ–≥–æ —Å–ø–∏—Å–∫—É**.
> 3. –í—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ü—å–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ –ø–æ—Ç–æ–∫—É –º–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ (`map`) –∫–æ–∂–µ–Ω –π–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç (`n2`) –Ω–∞ –ø–∞—Ä—É `[n1, n2]`.
> 4. `flatMap` –æ–±'—î–¥–Ω—É—î –≤—Å—ñ —Ü—ñ –ø–æ—Ç–æ–∫–∏ –ø–∞—Ä –≤ –æ–¥–∏–Ω —î–¥–∏–Ω–∏–π –ø–æ—Ç—ñ–∫.

#### **üìù –ü—Ä–∏–∫–ª–∞–¥ –∫–æ–¥—É:**

```java
List<Integer> list1 = List.of(1, 2);
List<String> list2 = List.of("A", "B");

List<String> cartesianProduct = list1.stream()
    .flatMap(n1 -> list2.stream()
                        .map(s2 -> n1 + s2)) // –î–ª—è –∫–æ–∂–Ω–æ–≥–æ n1 —Å—Ç–≤–æ—Ä—é—î–º–æ –ø–æ—Ç—ñ–∫ –ø–∞—Ä
    .collect(Collectors.toList());

System.out.println(cartesianProduct); // [1A, 1B, 2A, 2B]
```

–¶–µ–π –∫–æ–¥ —î –¥—É–∂–µ –µ–ª–µ–≥–∞–Ω—Ç–Ω–∏–º —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–º –µ–∫–≤—ñ–≤–∞–ª–µ–Ω—Ç–æ–º –¥–≤–æ—Ö –≤–∫–ª–∞–¥–µ–Ω–∏—Ö —Ü–∏–∫–ª—ñ–≤ `for`.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–¥–∞—Ç–Ω—ñ—Å—Ç—å –≤–∏—Ä—ñ—à—É–≤–∞—Ç–∏ –Ω–µ—Ç—Ä–∏–≤—ñ–∞–ª—å–Ω—ñ –∞–ª–≥–æ—Ä–∏—Ç–º—ñ—á–Ω—ñ –∑–∞–¥–∞—á—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `Stream API`. –¶–µ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –≤–ø–µ–≤–Ω–µ–Ω–µ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º.*

* * *

### **13 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–£ `Stream API` —î –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω—ñ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó `mapToInt`, `mapToLong`. –ß–∏ —ñ—Å–Ω—É—é—Ç—å –∞–Ω–∞–ª–æ–≥—ñ—á–Ω—ñ –¥–ª—è `flatMap`? ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> **–¢–∞–∫, —ñ—Å–Ω—É—é—Ç—å.** –î–ª—è `flatMap` —Ç–∞–∫–æ–∂ —î –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω—ñ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó, —è–∫—ñ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—é—Ç—å –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç –ø–æ—Ç–æ–∫—É –Ω–∞ –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏–π –ø–æ—Ç—ñ–∫ —ñ "—Å–ø–ª—é—â—É—é—Ç—å" —ó—Ö.
>
> * **`flatMapToInt(Function<T, IntStream> mapper)`**: –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î `Stream<T>` –Ω–∞ `IntStream`.
> * **`flatMapToLong(Function<T, LongStream> mapper)`**: –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î `Stream<T>` –Ω–∞ `LongStream`.
> * **`flatMapToDouble(Function<T, DoubleStream> mapper)`**: –ü–µ—Ä–µ—Ç–≤–æ—Ä—é—î `Stream<T>` –Ω–∞ `DoubleStream`.
>
> –í–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –∑ —Ç—ñ—î—é –∂ –º–µ—Ç–æ—é, —â–æ —ñ `mapToInt`: **—É–Ω–∏–∫–Ω—É—Ç–∏ boxing/unboxing** —Ç–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ –ø—Ä–∏–º—ñ—Ç–∏–≤–Ω–∏—Ö –ø–æ—Ç–æ–∫—ñ–≤.
>
> #### –ü—Ä–∏–∫–ª–∞–¥
>
> `List<List<Integer>>` -> `IntStream`
>
> ```java
> list.stream() // Stream<List<Integer>>
>      .flatMapToInt(innerList -> innerList.stream().mapToInt(Integer::intValue))
>      .sum();
> ```

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ü–æ–≤–Ω–µ –∑–Ω–∞–Ω–Ω—è API, –≤–∫–ª—é—á–∞—é—á–∏ –º–µ–Ω—à –ø–æ—à–∏—Ä–µ–Ω—ñ, –∞–ª–µ –≤–∞–∂–ª–∏–≤—ñ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó.*

* * *

### **14 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–Ø–∫ –±–∏ –≤–∏ —Ä–µ–∞–ª—ñ–∑—É–≤–∞–ª–∏ –æ–ø–µ—Ä–∞—Ü—ñ—é `flatMap` –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `map` —Ç–∞ `reduce`? ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –¶–µ —Å–∫–ª–∞–¥–Ω–µ —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è, —è–∫–µ –ø–æ–∫–∞–∑—É—î –≤–∑–∞—î–º–æ–∑–∞–º—ñ–Ω–Ω—ñ—Å—Ç—å –æ—Å–Ω–æ–≤–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π –§–ü.
>
> **–Ü–¥–µ—è:**
>
> 1. –°–ø–æ—á–∞—Ç–∫—É –º–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ **`map`**, —â–æ–± –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç `T` –Ω–∞ `Stream<R>`. –£ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –º–∏ –æ—Ç—Ä–∏–º–∞—î–º–æ `Stream<Stream<R>>`.
> 2. –¢–µ–ø–µ—Ä –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ "—Å–ø–ª—é—â–∏—Ç–∏" —Ü–µ–π –ø–æ—Ç—ñ–∫ –ø–æ—Ç–æ–∫—ñ–≤. –ú–∏ –º–æ–∂–µ–º–æ –∑—Ä–æ–±–∏—Ç–∏ —Ü–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **`reduce`**. –ú–∏ –≤—ñ–∑—å–º–µ–º–æ –ø–æ—Ä–æ–∂–Ω—ñ–π –ø–æ—Ç—ñ–∫ —è–∫ –ø–æ—á–∞—Ç–∫–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è —ñ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ –±—É–¥–µ–º–æ –æ–±'—î–¥–Ω—É–≤–∞—Ç–∏ –π–æ–≥–æ –∑ –∫–æ–∂–Ω–∏–º –ø–æ—Ç–æ–∫–æ–º —É `Stream<Stream<R>>` –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `Stream.concat()`.
>
> **–ü—Å–µ–≤–¥–æ–∫–æ–¥ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó:**
>
> ```java
> public <T, R> Stream<R> flatMap(Stream<T> stream, Function<T, Stream<R>> mapper) {
>     // –ö—Ä–æ–∫ 1: map
>     Stream<Stream<R>> streamOfStreams = stream.map(mapper);
>
>     // –ö—Ä–æ–∫ 2: reduce
>     return streamOfStreams.reduce(Stream.empty(), Stream::concat);
> }
> ```
>
> **–ß–æ–º—É —Ç–∞–∫ –Ω–µ —Ä–æ–±–ª—è—Ç—å –Ω–∞ –ø—Ä–∞–∫—Ç–∏—Ü—ñ:**
> –¢–∞–∫–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –±—É–¥–µ –∑–Ω–∞—á–Ω–æ **–º–µ–Ω—à –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—é**, –Ω—ñ–∂ –≤–±—É–¥–æ–≤–∞–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è `flatMap` —É JDK, —è–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ `Spliterator`'–∏ —ñ –Ω–µ —Å—Ç–≤–æ—Ä—é—î —Å—Ç—ñ–ª—å–∫–∏ –ø—Ä–æ–º—ñ–∂–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤. –¶–µ —Å—É—Ç–æ –∞–∫–∞–¥–µ–º—ñ—á–Ω–∞ –≤–ø—Ä–∞–≤–∞.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–î—É–∂–µ –≥–ª–∏–±–æ–∫–µ, —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è `Stream API` —Ç–∞ –π–æ–≥–æ –æ—Å–Ω–æ–≤. –¶–µ –ø–∏—Ç–∞–Ω–Ω—è –Ω–∞ —Ä–æ–∑—É–º—ñ–Ω–Ω—è —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∏—Ö –∫–æ–Ω—Ü–µ–ø—Ü—ñ–π —Ä–µ–¥—É–∫—Ü—ñ—ó —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è.*

* * *

### **15 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ß–∏ –º–æ–∂–µ `flatMap` –∑–º—ñ–Ω–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä –ø–æ—Ç–æ–∫—É (–∫—ñ–ª—å–∫—ñ—Å—Ç—å –µ–ª–µ–º–µ–Ω—Ç—ñ–≤)? –ü–æ—è—Å–Ω—ñ—Ç—å. ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> **–¢–∞–∫, –º–æ–∂–µ.** `flatMap` —î –æ–¥–Ω—ñ—î—é –∑ –æ–ø–µ—Ä–∞—Ü—ñ–π, —è–∫–∞ –º–æ–∂–µ —è–∫ –∑–±—ñ–ª—å—à—É–≤–∞—Ç–∏, —Ç–∞–∫ —ñ –∑–º–µ–Ω—à—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —É –ø–æ—Ç–æ—Ü—ñ.
>
> **–Ø–∫ —Ü–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:**
> –§—É–Ω–∫—Ü—ñ—è-–º–∞–ø–ø–µ—Ä, —è–∫—É –≤–∏ –ø–µ—Ä–µ–¥–∞—î—Ç–µ –≤ `flatMap`, –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –≤—Ö—ñ–¥–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î **–ø–æ—Ç—ñ–∫**. –¶–µ–π –ø–æ—Ç—ñ–∫ –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏:
>
> * **–ù—É–ª—å –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ (`Stream.empty()`):** –¶–µ —Ñ–∞–∫—Ç–∏—á–Ω–æ –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É—î –≤—Ö—ñ–¥–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç. –Ø–∫—â–æ —Ç–∞–∫ –∑—Ä–æ–±–∏—Ç–∏ –¥–ª—è –≤—Å—ñ—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, –∫—ñ–Ω—Ü–µ–≤–∏–π –ø–æ—Ç—ñ–∫ –±—É–¥–µ –ø–æ—Ä–æ–∂–Ω—ñ–º.
> * **–û–¥–∏–Ω –µ–ª–µ–º–µ–Ω—Ç (`Stream.of(r)`):** –ü–æ–≤–µ–¥—ñ–Ω–∫–∞ –±—É–¥–µ —Å—Ö–æ–∂–æ—é –Ω–∞ `map`. –†–æ–∑–º—ñ—Ä –Ω–µ –∑–º—ñ–Ω–∏—Ç—å—Å—è.
> * **–ö—ñ–ª—å–∫–∞ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤:** –¶–µ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —É –∫—ñ–Ω—Ü–µ–≤–æ–º—É –ø–æ—Ç–æ—Ü—ñ.
>
> **`flatMap` = `map` + `filter` (–∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è):**
> –ó–∞–≤–¥—è–∫–∏ —Ç–æ–º—É, —â–æ –º–æ–∂–Ω–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–π –ø–æ—Ç—ñ–∫, `flatMap` –º–æ–∂–µ –æ–¥–Ω–æ—á–∞—Å–Ω–æ —ñ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é–≤–∞—Ç–∏, —ñ —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏.
>
> #### –ü—Ä–∏–∫–ª–∞–¥ (—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Ç–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è)
>
> –ü–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ—Ç—ñ–∫ —Ä—è–¥–∫—ñ–≤ –Ω–∞ –ø–æ—Ç—ñ–∫ —ó—Ö –¥–æ–≤–∂–∏–Ω, –∞–ª–µ —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ä—è–¥–∫—ñ–≤ –¥–æ–≤–∂–∏–Ω–æ—é –±—ñ–ª—å—à–µ 3.
>
> ```java
> List<String> list = List.of("a", "Java", "b", "Stream");
> List<Integer> lengths = list.stream()
>     .flatMap(s -> s.length() > 3 ? Stream.of(s.length()) : Stream.empty())
>     .collect(Collectors.toList());
> 
> System.out.println(lengths); // [4, 6]
> ```
>
> –¢—É—Ç –º–∏ –∑–∞–º—ñ–Ω–∏–ª–∏ –ª–∞–Ω—Ü—é–∂–æ–∫ `.filter(...).map(...)` –æ–¥–Ω–∏–º `flatMap`, —â–æ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –π–æ–≥–æ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ü–æ–≤–Ω–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π `flatMap`. –ö–∞–Ω–¥–∏–¥–∞—Ç –ø–æ–≤–∏–Ω–µ–Ω –∑–Ω–∞—Ç–∏, —â–æ —Ü–µ –Ω–µ —Ç—ñ–ª—å–∫–∏ –ø—Ä–æ "—Å–ø–ª—é—â–µ–Ω–Ω—è", –∞ –π –ø—Ä–æ –¥—É–∂–µ –≥–Ω—É—á–∫—É –æ–ø–µ—Ä–∞—Ü—ñ—é –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è "–æ–¥–∏–Ω-–≤-–Ω—É–ª—å-–∞–±–æ-–±–∞–≥–∞—Ç–æ".*

* * *
