---
layout: default
title: "Stream API –∑ Optional"
parent: "Stream API"
grand_parent: "Java 8"
nav_order: 20
---

# Stream API –∑ Optional

* –∫–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è `Optional` –∑ Stream API –¥–æ–∑–≤–æ–ª—è—î –æ–±'—î–¥–Ω–∞—Ç–∏ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—É –æ–±—Ä–æ–±–∫—É –ø–æ—Ç–æ–∫—ñ–≤ —ñ–∑ –±–µ–∑–ø–µ—á–Ω–æ—é —Ä–æ–±–æ—Ç–æ—é –∑ –≤—ñ–¥—Å—É—Ç–Ω—ñ–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏. –ó Java 9, `Optional` –º–∞—î –º–µ—Ç–æ–¥ `stream()`, —â–æ –¥–æ–∑–≤–æ–ª—è—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –Ω–∏–º —è–∫ –∑ –ø–æ—Ç–æ–∫–æ–º –∑ 0 –∞–±–æ 1 –µ–ª–µ–º–µ–Ω—Ç–∞.

* –ø–æ–Ω—è—Ç—Ç—è: `Optional.stream()` (–∑ Java 9), `Stream.ofNullable()` (–∑ Java 9), `flatMap(Optional::stream)`.

* –ø—Ä–∏–∫–ª–∞–¥–∏: `Optional.of("Alice").stream().collect(...)`, `Stream.ofNullable(null)` (—Å—Ç–≤–æ—Ä–∏—Ç—å –ø–æ—Ä–æ–∂–Ω—ñ–π —Å—Ç—Ä—ñ–º), `list.stream().flatMap(Optional::stream)` (—Ä–æ–∑–ø–∞–∫–æ–≤—É—î –∑–Ω–∞—á–µ–Ω–Ω—è –∑ `Optional` —É —Å—Ç—Ä—ñ–º—ñ).

* –∫–ª—é—á–æ–≤—ñ –º–æ–º–µ–Ω—Ç–∏: –î–æ–∑–≤–æ–ª—è—î —É–Ω–∏–∫–∞—Ç–∏ `NullPointerException` —Ç–∞ `if`-–ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ —É Stream-–ø–∞–π–ø–ª–∞–π–Ω–∞—Ö, —Ä–æ–±–∏—Ç—å –∫–æ–¥ —á–∏—Å—Ç—ñ—à–∏–º.

* —â–æ –≤–∞–∂–ª–∏–≤–æ –∑–Ω–∞—Ç–∏ –Ω–∞ —Å–ø—ñ–≤–±–µ—Å—ñ–¥—ñ: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è Stream —Ç–∞ Optional, `flatMap` –¥–ª—è "—Ä–æ–∑–ø–∞–∫–æ–≤–∫–∏".

### **‚úÖ –û—Ñ—ñ—Ü—ñ–π–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è:**

–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è **`Stream`** —Ç–∞ **`Optional`** –≤ Java –¥–æ–∑–≤–æ–ª—è—î –æ–±'—î–¥–Ω–∞—Ç–∏ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—É –æ–±—Ä–æ–±–∫—É –ø–æ—Ç–æ–∫—ñ–≤ —ñ–∑ –±–µ–∑–ø–µ—á–Ω–æ—é —Ä–æ–±–æ—Ç–æ—é –∑ –≤—ñ–¥—Å—É—Ç–Ω—ñ–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ —á–µ—Ä–µ–∑ **`Optional`**. –ü–æ—á–∏–Ω–∞—é—á–∏ –∑ Java 9, **`Optional`** –º–∞—î –º–µ—Ç–æ–¥ **`stream()`**, —â–æ –¥–∞—î –∑–º–æ–≥—É –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑ –Ω–∏–º —è–∫ –∑ –ø–æ—Ç–æ–∫–æ–º.

### **üß† –ü—Ä–æ—Å—Ç–∏–º–∏ —Å–ª–æ–≤–∞–º–∏:**

–¶–µ "–º—ñ—Å—Ç–æ–∫" –º—ñ–∂ **Optional**, —è–∫–∏–π –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ –∞–±–æ –Ω–µ –º—ñ—Å—Ç–∏—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è, —Ç–∞ **Stream**, —è–∫–∏–π –æ–ø–µ—Ä—É—î –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—é –¥–∞–Ω–∏—Ö. –ó–∞–≤–¥—è–∫–∏ **`Optional.stream()`** –º–æ–∂–Ω–∞ –≤–ø–∏—Å–∞—Ç–∏ Optional —É –ø–æ—Ç—ñ–∫ —è–∫ –µ–ª–µ–º–µ–Ω—Ç (–∞–±–æ –Ω–µ –≤–∫–ª—é—á–∞—Ç–∏, —è–∫—â–æ –ø–æ—Ä–æ–∂–Ω—ñ–π) ‚Äî –±–µ–∑ if'—ñ–≤, –ø—Ä–æ—Å—Ç–æ –µ–ª–µ–≥–∞–Ω—Ç–Ω–æ

---

## üìä **–ö–ª—é—á–æ–≤—ñ –º–µ—Ç–æ–¥–∏:**

* **`Stream.ofNullable(value)`** ‚Äî —Å—Ç–≤–æ—Ä—é—î –ø–æ—Ç—ñ–∫ –∑ –æ–¥–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ –∞–±–æ –ø–æ—Ä–æ–∂–Ω—ñ–π.
* **`Optional.stream()`** ‚Äî –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î Optional —É –ø–æ—Ç—ñ–∫ –∑ 0 –∞–±–æ 1 –µ–ª–µ–º–µ–Ω—Ç–∞.
* **`flatMap(Optional::stream)`** ‚Äî "—Ä–æ–∑–ø–∞–∫–æ–≤—É—î" Optional –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–æ—Ç–æ–∫—É.
* **`filter(...), map(...), orElse(...)`** ‚Äî –º–æ–∂–Ω–∞ –æ–±'—î–¥–Ω—É–≤–∞—Ç–∏ –∑—ñ —Å—Ç—Ä—ñ–º–∞–º–∏.

---

## **–ü–æ—è—Å–Ω–µ–Ω–Ω—è –Ω–∞ –ø–∞–ª—å—Ü—è—Ö (üí°)**

–£—è–≤–∏: –≤ —Ç–µ–±–µ —î —Å–ø–∏—Å–æ–∫ Optional'—ñ–≤, —ñ —Ç–∏ —Ö–æ—á–µ—à –≤–∏—Ç—è–≥–Ω—É—Ç–∏ –≤—Å—ñ –∑–Ω–∞—á–µ–Ω–Ω—è.  

–ú–æ–∂–Ω–∞:

1. –ü–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ **`.isPresent()`**?
2. –î—ñ—Å—Ç–∞—Ç–∏ **`.get()`**?

üëé –ù–µ–±–µ–∑–ø–µ—á–Ω–æ –π –Ω—É–¥–Ω–æ.

–ö—Ä–∞—â–µ:

‚úÖ **`flatMap(Optional::stream)`** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏–±–∏—Ä–∞—î –ø–æ—Ä–æ–∂–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∞ "—Ä–æ–∑–≥–æ—Ä—Ç–∞—î" –∑–Ω–∞—á—É—â—ñ.

---

## **–ö–æ—Ä–∏—Å–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ (üß™)**

### **üîπ `Optional.stream()` ‚Äî Java 9+**

```java
Optional<String> maybeName = Optional.of("Alice");

List<String> names = maybeName.stream().collect(Collectors.toList());
// --> ["Alice"]
```

---

### **üîπ `Stream.ofNullable(...)` ‚Äî Java 9+**

```java
Stream<String> stream = Stream.ofNullable(null);
// --> –ø–æ—Ä–æ–∂–Ω—ñ–π –ø–æ—Ç—ñ–∫
```

---

### **üîπ `flatMap(Optional::stream)` ‚Äî –≤–∏—Ç—è–≥ –∑–Ω–∞—á–µ–Ω—å —ñ–∑ Optional —É —Å—Ç—Ä—ñ–º—ñ**

```java
List<Optional<String>> list = List.of(Optional.of("A"), Optional.empty(), Optional.of("B"));

List<String> result = list.stream()
    .flatMap(Optional::stream)
    .collect(Collectors.toList());
// --> ["A", "B"]
```

---

### **üîπ –ö–æ–º–±—ñ–Ω—É–≤–∞–Ω–Ω—è: –æ–±—Ä–æ–±–∫–∞ Nullable –∑–Ω–∞—á–µ–Ω—å —á–µ—Ä–µ–∑ Stream**

```java
Stream.ofNullable(getUser())
    .flatMap(user -> Stream.ofNullable(user.getName()))
    .forEach(System.out::println);
```

---

## **–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è (‚öñÔ∏è)**

|              –ú–µ—Ç–æ–¥              |                  –©–æ —Ä–æ–±–∏—Ç—å                  |           –ü–µ—Ä–µ–≤–∞–≥–∏            |
|:-------------------------------:|:-------------------------------------------:|:-----------------------------:|
|     **`Optional.stream()`**     |    –ü–æ—Ç—ñ–∫ –∑ 0 –∞–±–æ 1 –µ–ª–µ–º–µ–Ω—Ç–æ–º —ñ–∑ Optional    |       –ü—Ä–æ—Å—Ç–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è       |
|    **`Stream.ofNullable()`**    | –ü–æ—Ç—ñ–∫ –∑ 0 –∞–±–æ 1 –µ–ª–µ–º–µ–Ω—Ç–æ–º –∑ null-–ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é |    –ó—Ä—É—á–Ω–æ –∑–∞–º—ñ—Å—Ç—å if-null     |
| **`flatMap(Optional::stream)`** |    –í–∏—Ç—è–≥—É—î –∑–Ω–∞—á–µ–Ω–Ω—è –∑ Optional —É –ø–æ—Ç–æ—Ü—ñ     | –ü—Ä–∏–±–∏—Ä–∞—î **`empty`** –∑–Ω–∞—á–µ–Ω–Ω—è |

---

## **üß† –ú–Ω–µ–º–æ–Ω—ñ–∫–∞ –¥–ª—è –∑–∞–ø–∞–º‚Äô—è—Ç–æ–≤—É–≤–∞–Ω–Ω—è:**

**"–û–°–§ ‚Äî Optional, Stream, FlatMap"**  
üîó –©–æ–± –∑–≤‚Äô—è–∑–∞—Ç–∏ Optional —Ç–∞ Stream:

* **O**ptional -->
* **`.**S**tream()`** -->
* **`.**F**latMap(Optional::stream)`** --> –æ—Ç—Ä–∏–º–∞–π –ª–∏—à–µ —Ç—ñ, —â–æ —â–æ—Å—å –º—ñ—Å—Ç—è—Ç—å.

---

## **üü© –ü—ñ–¥—Å—É–º–æ–∫:**

* **`Optional.stream()`** ‚Äî —á—É–¥–æ–≤–∏–π —Å–ø–æ—Å—ñ–± –≤–∫–ª—é—á–∏—Ç–∏ Optional —É —Å—Ç—Ä—ñ–º –±–µ–∑ if-—ñ–≤.
* **`Stream.ofNullable()`** ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ **`null`**.
* **`flatMap(Optional::stream)`** ‚Äî –¥–æ–∑–≤–æ–ª—è—î —Ä–æ–∑–ø–∞–∫–æ–≤—É–≤–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –∑ Optional —É –∫–æ–ª–µ–∫—Ü—ñ—è—Ö.
* –í–∞–∂–ª–∏–≤–æ –∑–Ω–∞—Ç–∏: –∑ Java 9 —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è Optional \+ Stream —Å—Ç–∞–ª–∞ –ø—Ä–∏—Ä–æ–¥–Ω–æ—é –π –¥—É–∂–µ –ø–æ—Ç—É–∂–Ω–æ—é.

---

### **üîó –î–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–∂–µ—Ä–µ–ª–∞:**

* [**Official JavaDocs ‚Äî Optional.stream()**](https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Optional.html#stream\(\))

* * *

# **FAQ ‚Äî –ß–∞—Å—Ç—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è (‚ùì)**

### **1 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–î–ª—è —á–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–±'—î–¥–Ω—É–≤–∞—Ç–∏ `Stream API` —Ç–∞ `Optional`? –Ø–∫—É –ø—Ä–æ–±–ª–µ–º—É —Ü–µ –≤–∏—Ä—ñ—à—É—î?

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –û—Å–Ω–æ–≤–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞, —è–∫—É –≤–∏—Ä—ñ—à—É—î —ó—Ö–Ω—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è, ‚Äî —Ü–µ **–±–µ–∑–ø–µ—á–Ω–∞ —Ç–∞ –µ–ª–µ–≥–∞–Ω—Ç–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –∫–æ–ª–µ–∫—Ü—ñ–π, —è–∫—ñ –º–æ–∂—É—Ç—å –º—ñ—Å—Ç–∏—Ç–∏ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è**.
>
> **–°—Ü–µ–Ω–∞—Ä—ñ–π:** –£—è–≤—ñ—Ç—å, —É –≤–∞—Å —î –º–µ—Ç–æ–¥, —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î `Optional<User>` –∑–∞ ID. –í–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç–µ –π–æ–≥–æ –¥–ª—è —Å–ø–∏—Å–∫—É ID —ñ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –æ—Ç—Ä–∏–º—É—î—Ç–µ `List<Optional<User>>`. –î–µ—è–∫—ñ –∑ —Ü–∏—Ö `Optional`'—ñ–≤ –±—É–¥—É—Ç—å –ø–æ—Ä–æ–∂–Ω—ñ–º–∏.
>
> **–ü—Ä–æ–±–ª–µ–º–∞:** –í–∞–º –ø–æ—Ç—Ä—ñ–±–µ–Ω –Ω–µ `List<Optional<User>>`, –∞ `List<User>`, —â–æ –º—ñ—Å—Ç–∏—Ç—å –ª–∏—à–µ —Ç–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, —è–∫—ñ –±—É–ª–∏ –∑–Ω–∞–π–¥–µ–Ω—ñ.
>
> –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è `Stream` —Ç–∞ `Optional` –¥–æ–∑–≤–æ–ª—è—î:
>
> * –õ–µ–≥–∫–æ –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ `Optional`'–∏.
> * "–†–æ–∑–ø–∞–∫—É–≤–∞—Ç–∏" –∑–Ω–∞—á–µ–Ω–Ω—è –∑ –Ω–µ–ø—É—Å—Ç–∏—Ö `Optional`'—ñ–≤.
> * –†–æ–±–∏—Ç–∏ —Ü–µ –≤ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–º—É, —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ–º—É —Å—Ç–∏–ª—ñ, —É–Ω–∏–∫–∞—é—á–∏ –≥—Ä–æ–º—ñ–∑–¥–∫–∏—Ö `if (opt.isPresent())` –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ —É —Ü–∏–∫–ª–∞—Ö.

#### **üìù –ê–Ω–∞–ª–æ–≥—ñ—è:**

–¶–µ —è–∫ –º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–æ–±–æ–∫, –¥–µ—è–∫—ñ –∑ —è–∫–∏—Ö –ø–æ—Ä–æ–∂–Ω—ñ. –ó–∞–º—ñ—Å—Ç—å —Ç–æ–≥–æ, —â–æ–± –≤—ñ–¥–∫—Ä–∏–≤–∞—Ç–∏ –∫–æ–∂–Ω—É —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏, —á–∏ —î —â–æ—Å—å –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ (`if`-–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞), –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –≤—Å—ñ –∫–æ—Ä–æ–±–∫–∏ —á–µ—Ä–µ–∑ "–º–∞–≥—ñ—á–Ω–∏–π –∫–æ–Ω–≤–µ—î—Ä", —è–∫–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–∏–Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ —ñ –≤–∏–∫–ª–∞–¥–µ –Ω–∞ —Å—Ç—ñ–ª –ª–∏—à–µ –≤–º—ñ—Å—Ç –ø–æ–≤–Ω–∏—Ö.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–†–æ–∑—É–º—ñ–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–æ—ó –ø—Ä–æ–±–ª–µ–º–∏, —â–æ –≤–∏–Ω–∏–∫–∞—î –Ω–∞ –ø–µ—Ä–µ—Ç–∏–Ω—ñ –∫–æ–ª–µ–∫—Ü—ñ–π —Ç–∞ `Optional` ‚Äî –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –±–µ–∑–ø–µ—á–Ω–æ –æ–±—Ä–æ–±–ª—è—Ç–∏ —Ç–∞ —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è —É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ–º—É —Å—Ç–∏–ª—ñ.*

* * *

### **2 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–Ø–∫ —É Java 8 (–¥–æ –ø–æ—è–≤–∏ `Optional.stream()`) –±—É–ª–æ –ø—Ä–∏–π–Ω—è—Ç–æ –æ–±—Ä–æ–±–ª—è—Ç–∏ –ø–æ—Ç—ñ–∫ `Optional`'—ñ–≤, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –ª–∏—à–µ –ø—Ä–∏—Å—É—Ç–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è?

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –î–æ Java 9 –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –ø–∞—Ç–µ—Ä–Ω –∑ –¥–≤–æ—Ö –ø—Ä–æ–º—ñ–∂–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π: **`filter()`** —Ç–∞ **`map()`**.
>
> 1. **`filter(Optional::isPresent)`:** –°–ø–æ—á–∞—Ç–∫—É –ø–æ—Ç—ñ–∫ —Ñ—ñ–ª—å—Ç—Ä—É—î—Ç—å—Å—è, –∑–∞–ª–∏—à–∞—é—á–∏ –ª–∏—à–µ —Ç—ñ `Optional`-–æ–±'—î–∫—Ç–∏, —è–∫—ñ –º—ñ—Å—Ç—è—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è.
> 2. **`map(Optional::get)`:** –ü–æ—Ç—ñ–º –¥–æ –∫–æ–∂–Ω–æ–≥–æ –≥–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–æ –Ω–µ–ø—É—Å—Ç–æ–≥–æ `Optional` –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è –æ–ø–µ—Ä–∞—Ü—ñ—è `.get()`, —â–æ–± "—Ä–æ–∑–ø–∞–∫—É–≤–∞—Ç–∏" –∑–Ω–∞—á–µ–Ω–Ω—è.
>
> –¶–µ–π –ø—ñ–¥—Ö—ñ–¥ —î –∞–±—Å–æ–ª—é—Ç–Ω–æ —Ä–æ–±–æ—á–∏–º, –∞–ª–µ —Ç—Ä–æ—Ö–∏ –±–∞–≥–∞—Ç–æ—Å–ª—ñ–≤–Ω–∏–º —ñ –º–∞—î –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ –Ω–µ–¥–æ–ª—ñ–∫–∏ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ä–∏–∑–∏–∫ –≤–∏–ø–∞–¥–∫–æ–≤–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `map(Optional::get)` –±–µ–∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ `filter`).

#### **üìù –ü—Ä–∏–∫–ª–∞–¥ (Java 8):**

```java
import java.util.List;
import java.util.Optional;
import java.util.stream.Collectors;

public class OptionalJava8Example {
    public static void main(String[] args) {
        List<Optional<String>> optionals = List.of(
            Optional.of("A"),
            Optional.empty(),
            Optional.of("B"),
            Optional.empty()
        );

        List<String> presentValues = optionals.stream()
            .filter(Optional::isPresent)
            .map(Optional::get)
            .collect(Collectors.toList());

        System.out.println(presentValues); // [A, B]
    }
}
```

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–Ω–∞–Ω–Ω—è "–∫–ª–∞—Å–∏—á–Ω–æ–≥–æ" –ø–∞—Ç–µ—Ä–Ω—É –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ `Optional` —É —Å—Ç—Ä—ñ–º–∞—Ö. –¶–µ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –¥–æ—Å–≤—ñ–¥ —Ä–æ–±–æ—Ç–∏ –∑ Java 8 —Ç–∞ —Ä–æ–∑—É–º—ñ–Ω–Ω—è, —á–æ–º—É –≤ –Ω–æ–≤–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö –±—É–ª–∏ –≤–≤–µ–¥–µ–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è.*

* * *

### **3 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–Ø–∫ Java 9 –ø–æ–∫—Ä–∞—â–∏–ª–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—é `Optional` —Ç–∞ `Stream API`?

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –£ Java 9 –¥–æ –∫–ª–∞—Å—É `Optional` –±—É–ª–æ –¥–æ–¥–∞–Ω–æ –º–µ—Ç–æ–¥ **`.stream()`**. –¶–µ–π –º–µ—Ç–æ–¥ –∑–Ω–∞—á–Ω–æ —Å–ø—Ä–æ—â—É—î –æ–±—Ä–æ–±–∫—É.
>
> **`Optional.stream()`** ‚Äî —Ü–µ –º–µ—Ç–æ–¥, —è–∫–∏–π –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î `Optional` –Ω–∞ `Stream`:
>
> * –Ø–∫—â–æ `Optional` **–º—ñ—Å—Ç–∏—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è**, –≤—ñ–Ω –ø–æ–≤–µ—Ä—Ç–∞—î **–ø–æ—Ç—ñ–∫ –∑ –æ–¥–Ω–æ–≥–æ —Ü—å–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞** (`Stream.of(value)`).
> * –Ø–∫—â–æ `Optional` —î **–ø–æ—Ä–æ–∂–Ω—ñ–º**, –≤—ñ–Ω –ø–æ–≤–µ—Ä—Ç–∞—î **–ø–æ—Ä–æ–∂–Ω—ñ–π –ø–æ—Ç—ñ–∫** (`Stream.empty()`).
>
> –¶–µ –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ü—ñ—é **`flatMap()`** –¥–ª—è –µ–ª–µ–≥–∞–Ω—Ç–Ω–æ–≥–æ "—Å–ø–ª—é—â–µ–Ω–Ω—è" –ø–æ—Ç–æ–∫—É `Optional`'—ñ–≤ –≤ –æ–¥–∏–Ω –ø–æ—Ç—ñ–∫ –∑–Ω–∞—á–µ–Ω—å, —É–Ω–∏–∫–∞—é—á–∏ –¥–≤–æ–∫—Ä–æ–∫–æ–≤–æ—ó –ª–æ–≥—ñ–∫–∏ `filter-map`.

#### **üìù –ü—Ä–∏–∫–ª–∞–¥ (Java 9+):**

```java
List<Optional<String>> optionals = List.of(Optional.of("A"), Optional.empty(), Optional.of("B"));

List<String> presentValues = optionals.stream()
    .flatMap(Optional::stream) // –ï–ª–µ–≥–∞–Ω—Ç–Ω–∞ –∑–∞–º—ñ–Ω–∞ –¥–ª—è filter/map
    .collect(Collectors.toList());

System.out.println(presentValues); // [A, B]
```

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–Ω–∞–Ω–Ω—è —Å—É—á–∞—Å–Ω–∏—Ö (–ø—ñ—Å–ª—è 8) –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π Java. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `flatMap(Optional::stream)` —î —ñ–¥—ñ–æ–º–∞—Ç–∏—á–Ω–∏–º —Ç–∞ –∫—Ä–∞—â–∏–º –ø—ñ–¥—Ö–æ–¥–æ–º —É —Å—É—á–∞—Å–Ω–æ–º—É –∫–æ–¥—ñ.*

* * *

### **4 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–©–æ —Ä–æ–±–∏—Ç—å –º–µ—Ç–æ–¥ `Stream.ofNullable()` —ñ –∑ —è–∫–æ—ó –≤–µ—Ä—Å—ñ—ó –≤—ñ–Ω –¥–æ—Å—Ç—É–ø–Ω–∏–π?

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> **`Stream.ofNullable(T value)`** ‚Äî —Ü–µ —Å—Ç–∞—Ç–∏—á–Ω–∏–π –º–µ—Ç–æ–¥, –¥–æ–¥–∞–Ω–∏–π —É **Java 9**, —è–∫–∏–π —Å—Ç–≤–æ—Ä—é—î –ø–æ—Ç—ñ–∫ –∑ –æ–±'—î–∫—Ç–∞, —â–æ –º–æ–∂–µ –±—É—Ç–∏ `null`.
>
> **–Ø–∫ –≤—ñ–Ω –ø—Ä–∞—Ü—é—î:**
>
> * –Ø–∫—â–æ –ø–µ—Ä–µ–¥–∞–Ω–∏–π `value` **–Ω–µ —î `null`**, –≤—ñ–Ω —Å—Ç–≤–æ—Ä—é—î –ø–æ—Ç—ñ–∫ –∑ **–æ–¥–Ω–æ–≥–æ —Ü—å–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞**.
> * –Ø–∫—â–æ –ø–µ—Ä–µ–¥–∞–Ω–∏–π `value` **—î `null`**, –≤—ñ–Ω —Å—Ç–≤–æ—Ä—é—î **–ø–æ—Ä–æ–∂–Ω—ñ–π –ø–æ—Ç—ñ–∫ (`Stream.empty()`)**.
>
> –¶–µ–π –º–µ—Ç–æ–¥ —î –¥—É–∂–µ –∑—Ä—É—á–Ω–æ—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–æ—é –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–∞ `null`:
>
> * **–°—Ç–∞—Ä–∏–π –ø—ñ–¥—Ö—ñ–¥:** `if (obj != null) { ... }` –∞–±–æ `Optional.ofNullable(obj).ifPresent(...)`.
> * **–ù–æ–≤–∏–π –ø—ñ–¥—Ö—ñ–¥:** `Stream.ofNullable(obj).forEach(...)`.
>
> –í—ñ–Ω –¥–æ–∑–≤–æ–ª—è—î –≤–±—É–¥—É–≤–∞—Ç–∏ `null-safe` –æ–±—Ä–æ–±–∫—É –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –≤ –ª–∞–Ω—Ü—é–∂–æ–∫ —Å—Ç—Ä—ñ–º—É.

#### **üìù –ü—Ä–∏–∫–ª–∞–¥:**

```java
String name = "Alice";
String nullName = null;

// –°—Ç–≤–æ—Ä—é—î –ø–æ—Ç—ñ–∫ –∑ –æ–¥–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞
Stream.ofNullable(name).forEach(System.out::println); // –í–∏–≤–µ–¥–µ "Alice"

// –°—Ç–≤–æ—Ä—é—î –ø–æ—Ä–æ–∂–Ω—ñ–π –ø–æ—Ç—ñ–∫, —Ç–æ–º—É forEach –Ω–µ –≤–∏–∫–æ–Ω–∞—î—Ç—å—Å—è
Stream.ofNullable(nullName).forEach(System.out::println); // –ù—ñ—á–æ–≥–æ –Ω–µ –≤–∏–≤–µ–¥–µ
```

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–Ω–∞–Ω–Ω—è —Å—É—á–∞—Å–Ω–∏—Ö —É—Ç–∏–ª—ñ—Ç–∞—Ä–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ `Stream API` —Ç–∞ —Å–ø–æ—Å–æ–±—ñ–≤ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è —á–∏—Å—Ç–æ–≥–æ, `null-safe` –∫–æ–¥—É –±–µ–∑ —è–≤–Ω–∏—Ö `if`-–ø–µ—Ä–µ–≤—ñ—Ä–æ–∫.*

* * *

### **5 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ü–æ—è—Å–Ω—ñ—Ç—å, —É —á–æ–º—É —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ `stream.map(f)` —Ç–∞ `stream.flatMap(f)` –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ —Ñ—É–Ω–∫—Ü—ñ—î—é, —â–æ –ø–æ–≤–µ—Ä—Ç–∞—î `Optional`.

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –¶–µ –∫–ª—é—á–æ–≤–∞ —Ä—ñ–∑–Ω–∏—Ü—è, —è–∫–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î —Å–∏–ª—É `flatMap` –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ "–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–∏–º–∏" —Ç–∏–ø–∞–º–∏, —è–∫-–æ—Ç `Optional`.
>
> * **`map(f -> Optional<R>)`**:
>   * –¶—è –æ–ø–µ—Ä–∞—Ü—ñ—è –ø—Ä–æ—Å—Ç–æ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î —Ñ—É–Ω–∫—Ü—ñ—é –¥–æ –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞. –Ø–∫—â–æ —Ñ—É–Ω–∫—Ü—ñ—è –ø–æ–≤–µ—Ä—Ç–∞—î `Optional`, —Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –±—É–¥–µ **–ø–æ—Ç—ñ–∫ –∑ `Optional`'—ñ–≤** (`Stream<Optional<R>>`). –í–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ "–ø–æ—Ç—ñ–∫ –∫–æ—Ä–æ–±–æ–∫", –¥–µ—è–∫—ñ –∑ —è–∫–∏—Ö –ø–æ—Ä–æ–∂–Ω—ñ.
>
> * **`flatMap(f -> Optional<R>.stream())`**:
>   * –¶—è –æ–ø–µ—Ä–∞—Ü—ñ—è —Ç–∞–∫–æ–∂ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î —Ñ—É–Ω–∫—Ü—ñ—é, –∞–ª–µ –≤–æ–Ω–∞ –æ—á—ñ–∫—É—î, —â–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –±—É–¥–µ –ø–æ—Ç—ñ–∫ (`Stream`). –ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `Optional::stream` –º–∏ –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î–º–æ –∫–æ–∂–µ–Ω `Optional` –Ω–∞ –ø–æ—Ç—ñ–∫ –∑ 0 –∞–±–æ 1 –µ–ª–µ–º–µ–Ω—Ç–∞.
>   * –î–∞–ª—ñ `flatMap` **"—Å–ø–ª—é—â—É—î"** –≤—Å—ñ —Ü—ñ –º–∞–ª–µ–Ω—å–∫—ñ –ø–æ—Ç–æ–∫–∏ –≤ –æ–¥–∏–Ω —î–¥–∏–Ω–∏–π –ø–æ—Ç—ñ–∫ –∑–Ω–∞—á–µ–Ω—å (`Stream<R>`). –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ "–ø–æ—Ç—ñ–∫ –≤–º—ñ—Å—Ç—É –∫–æ—Ä–æ–±–æ–∫", –∞ –ø–æ—Ä–æ–∂–Ω—ñ –∫–æ—Ä–æ–±–∫–∏ –ø—Ä–æ—Å—Ç–æ —ñ–≥–Ω–æ—Ä—É—é—Ç—å—Å—è.
>
> **–ö–æ—Ä–æ—Ç–∫–æ:** `map` –∑–∞–ª–∏—à–∞—î –≤–∞—Å –∑ `Stream<Optional<T>>`, `flatMap` –¥–∞—î –≤–∞–º —á–∏—Å—Ç–∏–π `Stream<T>`.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ì–ª–∏–±–æ–∫–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è —Ç–æ–≥–æ, —â–æ `flatMap` —î —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–º —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –±—É–¥—å-—è–∫–æ—é —Å—Ç—Ä—É–∫—Ç—É—Ä–æ—é, —è–∫–∞ –º–æ–∂–µ –±—É—Ç–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ —è–∫ –ø–æ—Ç—ñ–∫ (–∫–æ–ª–µ–∫—Ü—ñ—ó, –º–∞—Å–∏–≤–∏, `Optional`).*

* * *

### **6 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–Ø–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ—Ç—ñ–∫ –∑ –∫—ñ–ª—å–∫–æ—Ö `Optional`-–æ–±'—î–∫—Ç—ñ–≤, –≤–∫–ª—é—á–∏–≤—à–∏ –ª–∏—à–µ —Ç—ñ, —â–æ –º—ñ—Å—Ç—è—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è?

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –î–ª—è —Ü—å–æ–≥–æ —ñ–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è `Stream.of()` —Ç–∞ `flatMap(Optional::stream)`.
>
> 1. –°—Ç–≤–æ—Ä—é—î–º–æ –ø–æ—Ç—ñ–∫ –∑ —Å–∞–º–∏—Ö `Optional`-–æ–±'—î–∫—Ç—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `Stream.of()`.
> 2. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `flatMap` –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –Ω–∞ –º–µ—Ç–æ–¥ `Optional::stream`, —â–æ–± "—Ä–æ–∑–ø–∞–∫—É–≤–∞—Ç–∏" –∫–æ–∂–µ–Ω `Optional`.

#### **üìù –ü—Ä–∏–∫–ª–∞–¥:**

```java
Optional<String> name1 = Optional.of("Alice");
Optional<String> name2 = Optional.empty();
Optional<String> name3 = Optional.of("Bob");

Stream.of(name1, name2, name3) // –°—Ç–≤–æ—Ä—é—î–º–æ Stream<Optional<String>>
      .flatMap(Optional::stream)  // "–†–æ–∑–ø–∞–∫–æ–≤—É—î–º–æ" –≤ Stream<String>
      .forEach(System.out::println); // –í–∏–≤–µ–¥–µ "Alice" —ñ "Bob"
```

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ü—Ä–∞–∫—Ç–∏—á–Ω—ñ –Ω–∞–≤–∏—á–∫–∏ –∫–æ–º–±—ñ–Ω—É–≤–∞–Ω–Ω—è —Ä—ñ–∑–Ω–∏—Ö —Å–ø–æ—Å–æ–±—ñ–≤ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –æ–±—Ä–æ–±–∫–∏ –ø–æ—Ç–æ–∫—ñ–≤.*

* * *

### **7 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–í–∏ –º–∞—î—Ç–µ –º–µ—Ç–æ–¥ `Optional<User> findUser(long id)`. –Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (`List<User>`) –¥–ª—è —Å–ø–∏—Å–∫—É ID, —ñ–≥–Ω–æ—Ä—É—é—á–∏ —Ç–∏—Ö, –∫–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ?

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –¶–µ –∫–ª–∞—Å–∏—á–Ω–∞ –∑–∞–¥–∞—á–∞, –¥–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ—Ç—ñ–∫ ID –Ω–∞ –ø–æ—Ç—ñ–∫ –∑–Ω–∞–π–¥–µ–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.
>
> **–õ–∞–Ω—Ü—é–∂–æ–∫ –æ–ø–µ—Ä–∞—Ü—ñ–π:**
>
> 1. –°—Ç–≤–æ—Ä—é—î–º–æ –ø–æ—Ç—ñ–∫ ID: `ids.stream()`.
> 2. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `map` –¥–ª—è –≤–∏–∫–ª–∏–∫—É `findUser(id)` –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ ID. –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –±—É–¥–µ `Stream<Optional<User>>`.
> 3. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ `flatMap(Optional::stream)` –¥–ª—è "—Ä–æ–∑–ø–∞–∫—É–≤–∞–Ω–Ω—è" `Optional`'—ñ–≤ —Ç–∞ –≤—ñ–¥–∫–∏–¥–∞–Ω–Ω—è –ø–æ—Ä–æ–∂–Ω—ñ—Ö. –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –±—É–¥–µ `Stream<User>`.
> 4. –ó–±–∏—Ä–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É `List`.

#### **üìù –ü—Ä–∏–∫–ª–∞–¥ –∫–æ–¥—É:**

```java
List<Long> ids = List.of(1L, 2L, 99L, 3L); // –ü—Ä–∏–ø—É—Å—Ç–∏–º–æ, –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ ID 99 –Ω–µ —ñ—Å–Ω—É—î

List<User> foundUsers = ids.stream()                       // Stream<Long>
                          .map(this::findUser)           // Stream<Optional<User>>
                          .flatMap(Optional::stream)       // Stream<User>
                          .collect(Collectors.toList()); // List<User>
```

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–¥–∞—Ç–Ω—ñ—Å—Ç—å –∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏ –ø–∞—Ç–µ—Ä–Ω "map-flatMap" –¥–ª—è –≤–∏—Ä—ñ—à–µ–Ω–Ω—è —Ä–µ–∞–ª—å–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å –∑ –æ–±—Ä–æ–±–∫–∏ –¥–∞–Ω–∏—Ö.*

* * *

### **8 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–Ø–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–≤–µ—Ä–Ω–µ —Ü–µ–π –∫–æ–¥ —ñ —á–æ–º—É: `Optional.ofNullable(null).stream().count()`? ‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –±—É–¥–µ **`0`**.
>
> **–ü–æ–∫—Ä–æ–∫–æ–≤–∏–π —Ä–æ–∑–±—ñ—Ä:**
>
> 1. `Optional.ofNullable(null)`: –°—Ç–≤–æ—Ä—é—î –ø–æ—Ä–æ–∂–Ω—ñ–π `Optional` (`Optional.empty()`).
> 2. `.stream()`: –ú–µ—Ç–æ–¥ `stream()` –Ω–∞ –ø–æ—Ä–æ–∂–Ω—å–æ–º—É `Optional` –ø–æ–≤–µ—Ä—Ç–∞—î **–ø–æ—Ä–æ–∂–Ω—ñ–π –ø–æ—Ç—ñ–∫** (`Stream.empty()`).
> 3. `.count()`: –¢–µ—Ä–º—ñ–Ω–∞–ª—å–Ω–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è `count()` –Ω–∞ –ø–æ—Ä–æ–∂–Ω—å–æ–º—É –ø–æ—Ç–æ—Ü—ñ –∫–æ—Ä–µ–∫—Ç–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—î `0`.
>
> –¶–µ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î, —è–∫ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è `Optional` —Ç–∞ `Stream` –¥–æ–∑–≤–æ–ª—è—î –±–µ–∑–ø–µ—á–Ω–æ –æ–±—Ä–æ–±–ª—è—Ç–∏ `null`-–∑–Ω–∞—á–µ–Ω–Ω—è –±–µ–∑ —è–≤–Ω–∏—Ö –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ —Ç–∞ —Ä–∏–∑–∏–∫—É `NullPointerException`.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–í–º—ñ–Ω–Ω—è –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ª–∞–Ω—Ü—é–∂–∫–∏ –≤–∏–∫–ª–∏–∫—ñ–≤ —Ç–∞ –ø–µ—Ä–µ–¥–±–∞—á–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —Ä–æ–∑—É–º—ñ—é—á–∏, —è–∫ –∫–æ–∂–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ–±—Ä–æ–±–ª—è—î "–ø–æ—Ä–æ–∂–Ω—ñ" –≤–∏–ø–∞–¥–∫–∏.*

* * *

### **9 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ß–æ–º—É –ø–∞—Ç–µ—Ä–Ω `filter(Optional::isPresent).map(Optional::get)` –≤–≤–∞–∂–∞—î—Ç—å—Å—è –º–µ–Ω—à –±–µ–∑–ø–µ—á–Ω–∏–º –∞–±–æ –µ–ª–µ–≥–∞–Ω—Ç–Ω–∏–º, –Ω—ñ–∂ `flatMap(Optional::stream)`? ‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –•–æ—á–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ –æ–¥–Ω–∞–∫–æ–≤–∏–º, –ø–∞—Ç–µ—Ä–Ω –∑ `flatMap` –≤–≤–∞–∂–∞—î—Ç—å—Å—è –∫—Ä–∞—â–∏–º –∑ –∫—ñ–ª—å–∫–æ—Ö –ø—Ä–∏—á–∏–Ω:
>
> 1. **–ú–µ–Ω—à–∏–π —Ä–∏–∑–∏–∫ –ø–æ–º–∏–ª–∫–∏:** –ü—Ä–∏ –ø—ñ–¥—Ö–æ–¥—ñ `filter/map` —î –ª—é–¥—Å—å–∫–∏–π —Ä–∏–∑–∏–∫ **–∑–∞–±—É—Ç–∏ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `filter`** —ñ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `map(Optional::get)` –Ω–∞ –ø–æ—Ç–æ—Ü—ñ, —â–æ –º—ñ—Å—Ç–∏—Ç—å –ø–æ—Ä–æ–∂–Ω—ñ `Optional`'–∏. –¶–µ –æ–¥—Ä–∞–∑—É –∂ –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ `NoSuchElementException`. –ü–∞—Ç–µ—Ä–Ω –∑ `flatMap` –Ω–µ –º–∞—î —Ç–∞–∫–æ–≥–æ —Ä–∏–∑–∏–∫—É, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—Å—è –ª–æ–≥—ñ–∫–∞ —ñ–Ω–∫–∞–ø—Å—É–ª—å–æ–≤–∞–Ω–∞ –≤ –º–µ—Ç–æ–¥—ñ `Optional.stream()`.
> 2. **–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ç–∞ –µ–ª–µ–≥–∞–Ω—Ç–Ω—ñ—Å—Ç—å:** `flatMap(Optional::stream)` —î –±—ñ–ª—å—à –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∏–º. –í—ñ–Ω –∫–∞–∂–µ: "–¥–ª—è –∫–æ–∂–Ω–æ–≥–æ `Optional`'–∞, –¥–∞–π –º–µ–Ω—ñ –π–æ–≥–æ —è–∫ –ø–æ—Ç—ñ–∫ (—è–∫—â–æ –≤—ñ–Ω —î)". –¶–µ –æ–¥–∏–Ω –ª–æ–≥—ñ—á–Ω–∏–π –∫—Ä–æ–∫. `filter` —ñ `map` ‚Äî —Ü–µ –¥–≤–∞ –æ–∫—Ä–µ–º—ñ, –±—ñ–ª—å—à —ñ–º–ø–µ—Ä–∞—Ç–∏–≤–Ω—ñ –∫—Ä–æ–∫–∏.
> 3. **–ê—Ç–æ–º–∞—Ä–Ω—ñ—Å—Ç—å:** `flatMap` –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î —Å–æ–±–æ—é —î–¥–∏–Ω—É, —Ü—ñ–ª—ñ—Å–Ω—É –æ–ø–µ—Ä–∞—Ü—ñ—é –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è, —â–æ –∫—Ä–∞—â–µ –∑ —Ç–æ—á–∫–∏ –∑–æ—Ä—É –¥–∏–∑–∞–π–Ω—É.
>
> –í —Ü—ñ–ª–æ–º—É, `flatMap` —î –±—ñ–ª—å—à —Å—É—á–∞—Å–Ω–∏–º, –±–µ–∑–ø–µ—á–Ω–∏–º —Ç–∞ —ñ–¥—ñ–æ–º–∞—Ç–∏—á–Ω–∏–º –ø—ñ–¥—Ö–æ–¥–æ–º.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–¥–∞—Ç–Ω—ñ—Å—Ç—å –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∫–æ–¥ –Ω–µ —Ç—ñ–ª—å–∫–∏ –∑ —Ç–æ—á–∫–∏ –∑–æ—Ä—É "—á–∏ –≤—ñ–Ω –ø—Ä–∞—Ü—é—î?", –∞ –π –∑ —Ç–æ—á–∫–∏ –∑–æ—Ä—É –π–æ–≥–æ –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ, —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞ —Å—Ö–∏–ª—å–Ω–æ—Å—Ç—ñ –¥–æ –ø–æ–º–∏–ª–æ–∫.*

* * *

### **10 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ö–æ–ª–∏ –º–µ—Ç–æ–¥ –º–æ–∂–µ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ `Stream<T>` –∑–∞–º—ñ—Å—Ç—å `Optional<T>` –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –∞–±–æ –Ω—É–ª—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤? ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è `Stream<T>` (–∑ 0 –∞–±–æ 1 –µ–ª–µ–º–µ–Ω—Ç–∞) –∑–∞–º—ñ—Å—Ç—å `Optional<T>` –º–æ–∂–µ –±—É—Ç–∏ –¥–æ—Ü—ñ–ª—å–Ω–∏–º —É **–¥—É–∂–µ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö**, –∫–æ–ª–∏ –≤–∏ –æ—á—ñ–∫—É—î—Ç–µ, —â–æ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π –∫–æ–¥, —à–≤–∏–¥—à–µ –∑–∞ –≤—Å–µ, –∑–∞—Ö–æ—á–µ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –æ–±—Ä–æ–±–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É —É –≤–∏–≥–ª—è–¥—ñ –ø–æ—Ç–æ–∫—É.
>
> **–ü–µ—Ä–µ–≤–∞–≥–∏ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è `Stream<T>`:**
>
> * **–ë–µ–∑—à–æ–≤–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ `flatMap`:** –ö–ª—ñ—î–Ω—Ç—Å—å–∫–∏–π –∫–æ–¥ –º–æ–∂–µ –æ–¥—Ä–∞–∑—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ü–µ–π –º–µ—Ç–æ–¥ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ `flatMap` –±–µ–∑ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –¥–æ–¥–∞—Ç–∫–æ–≤–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `.stream()` –Ω–∞ `Optional`.
>
> **–ù–µ–¥–æ–ª—ñ–∫–∏:**
>
> * **–ù–µ—Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ:** `Optional` –±—É–≤ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è —Ç–æ–≥–æ, —â–æ–± —è–≤–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç–∏ —ñ–¥–µ—é "–æ–¥–Ω–æ–≥–æ –∞–±–æ –Ω—É–ª—è –∑–Ω–∞—á–µ–Ω—å". `Stream` —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ –æ–∑–Ω–∞—á–∞—î "–ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –∑ –Ω—É–ª—è –∞–±–æ –±—ñ–ª—å—à–µ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤". –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `Stream` –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –æ–¥–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è –º–æ–∂–µ –∑–∞–ø–ª—É—Ç–∞—Ç–∏.
> * **–ë—ñ–ª—å—à—ñ –Ω–∞–∫–ª–∞–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏:** –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞ `Stream` —î —Ç—Ä–æ—Ö–∏ –¥–æ—Ä–æ–∂—á–∏–º, –Ω—ñ–∂ `Optional`.
>
> **–í–∏—Å–Ω–æ–≤–æ–∫:** –£ 99% –≤–∏–ø–∞–¥–∫—ñ–≤ –¥–ª—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –≤—ñ–¥—Å—É—Ç–Ω—å–æ–≥–æ **–æ–¥–∏–Ω–∏—á–Ω–æ–≥–æ** –∑–Ω–∞—á–µ–Ω–Ω—è —Å–ª—ñ–¥ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ `Optional`. –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è `Stream` –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–ø—Ä–∞–≤–¥–∞–Ω–∏–º –ª–∏—à–µ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø—Ä–∏–≤–∞—Ç–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ –∞–±–æ –≤ –¥—É–∂–µ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö API, –¥–µ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º —î –±–µ–∑—à–æ–≤–Ω–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤ –ª–∞–Ω—Ü—é–∂–∫–∏ `flatMap`.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–µ –º–∏—Å–ª–µ–Ω–Ω—è —Ç–∞ —Ä–æ–∑—É–º—ñ–Ω–Ω—è —Å–µ–º–∞–Ω—Ç–∏–∫–∏ API. –ö–∞–Ω–¥–∏–¥–∞—Ç –ø–æ–≤–∏–Ω–µ–Ω –∑–Ω–∞—Ç–∏, —è–∫–∏–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —î –Ω–∞–π–±—ñ–ª—å—à –ø—ñ–¥—Ö–æ–¥—è—â–∏–º –¥–ª—è –≤–∏—Ä–∞–∂–µ–Ω–Ω—è –ø–µ–≤–Ω–æ–≥–æ –Ω–∞–º—ñ—Ä—É.*

* * *

### **11 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–Ø–∫ –±–∏ –≤–∏ —Ä–µ–∞–ª—ñ–∑—É–≤–∞–ª–∏ `Optional.stream()` "–≤—Ä—É—á–Ω—É" –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–µ—Ä–Ω–∞—Ä–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞? ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–µ—Ç–æ–¥—É `stream()` –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–ª–∞—Å—É `Optional` —î –¥–æ—Å–∏—Ç—å –ø—Ä–æ—Å—Ç–æ—é —ñ —á—É–¥–æ–≤–æ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –π–æ–≥–æ –ª–æ–≥—ñ–∫—É.
>
> –í–æ–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –ø—Ä–∏—Å—É—Ç–Ω—î –∑–Ω–∞—á–µ–Ω–Ω—è. –Ø–∫—â–æ —Ç–∞–∫ ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ—Ç—ñ–∫ –∑ —Ü—å–æ–≥–æ –æ–¥–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è. –Ø–∫—â–æ –Ω—ñ ‚Äî –ø–æ–≤–µ—Ä—Ç–∞—î –ø–æ—Ä–æ–∂–Ω—ñ–π –ø–æ—Ç—ñ–∫.

#### **üìù –ü—Å–µ–≤–¥–æ–∫–æ–¥ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ `Optional<T>`:**

```java
public Stream<T> stream() {
    if (isPresent()) {
        return Stream.of(value);
    } else {
        return Stream.empty();
    }
}
// –ê–±–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ç–µ—Ä–Ω–∞—Ä–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞:
// return isPresent() ? Stream.of(value) : Stream.empty();
```

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–¥–∞—Ç–Ω—ñ—Å—Ç—å –≤—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏ –ª–æ–≥—ñ–∫—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ API, —â–æ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –≥–ª–∏–±–æ–∫–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è —ó—Ö–Ω—å–æ—ó —Ä–æ–±–æ—Ç–∏.*

* * *

### **12 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–£ –≤–∞—Å —î `Map<K, Optional<V>>`. –Ø–∫ –æ—Ç—Ä–∏–º–∞—Ç–∏ `Map<K, V>`, —â–æ –º—ñ—Å—Ç–∏—Ç—å –ª–∏—à–µ –∑–∞–ø–∏—Å–∏ –∑ –ø—Ä–∏—Å—É—Ç–Ω—ñ–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏? ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –î–ª—è —Ü—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—Ä–æ—ñ—Ç–µ—Ä—É–≤–∞—Ç–∏—Å—è –ø–æ `entrySet`, –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –ø–∞—Ä–∏ –∑ –ø–æ—Ä–æ–∂–Ω—ñ–º–∏ `Optional`-–∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ —ñ –∑—ñ–±—Ä–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É –Ω–æ–≤—É –º–∞–ø—É.
>
> **–õ–∞–Ω—Ü—é–∂–æ–∫ –æ–ø–µ—Ä–∞—Ü—ñ–π:**
>
> 1. –°—Ç–≤–æ—Ä—é—î–º–æ –ø–æ—Ç—ñ–∫ –∑ `entrySet()`: `Stream<Map.Entry<K, Optional<V>>>`.
> 2. `filter()` –∑–∞–ª–∏—à–∞—î –ª–∏—à–µ —Ç—ñ `Entry`, –¥–µ –∑–Ω–∞—á–µ–Ω–Ω—è `.isPresent()`.
> 3. `collect(Collectors.toMap(...))` –∑–±–∏—Ä–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –£ `valueMapper` –º–∏ –±–µ–∑–ø–µ—á–Ω–æ –≤–∏–∫–ª–∏–∫–∞—î–º–æ `.get()`, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–∂–µ –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞–ª–∏ –ø–æ—Ä–æ–∂–Ω—ñ.

#### **üìù –ü—Ä–∏–∫–ª–∞–¥ –∫–æ–¥—É:**

```java
Map<String, Optional<Integer>> scores = Map.of(
    "Alice", Optional.of(90),
    "Bob", Optional.empty(),
    "Charlie", Optional.of(85)
);

Map<String, Integer> presentScores = scores.entrySet().stream()
    .filter(entry -> entry.getValue().isPresent())
    .collect(Collectors.toMap(
        Map.Entry::getKey,
        entry -> entry.getValue().get()
    ));

System.out.println(presentScores); // {Alice=90, Charlie=85}
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –∑ `flatMap` (–±—ñ–ª—å—à –µ–ª–µ–≥–∞–Ω—Ç–Ω–æ):**
–ú–æ–∂–Ω–∞ –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–∂–µ–Ω –∑–∞–ø–∏—Å –Ω–∞ –ø–æ—Ç—ñ–∫ –∑ 0 –∞–±–æ 1 "—Å–ø–ª—é—â–µ–Ω–æ–≥–æ" –∑–∞–ø–∏—Å—É.

```java
Map<String, Integer> presentScores2 = scores.entrySet().stream()
    .flatMap(entry -> entry.getValue().stream()
                            .map(value -> new AbstractMap.SimpleEntry<>(entry.getKey(), value)))
    .collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue));
```

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–¥–∞—Ç–Ω—ñ—Å—Ç—å –≤–∏—Ä—ñ—à—É–≤–∞—Ç–∏ –Ω–µ—Ç—Ä–∏–≤—ñ–∞–ª—å–Ω—ñ –∑–∞–¥–∞—á—ñ –∑ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—ó –¥–∞–Ω–∏—Ö, –∫–æ–º–±—ñ–Ω—É—é—á–∏ —Ä–æ–±–æ—Ç—É –∑ `Map`, `Stream` —Ç–∞ `Optional`.*

* * *

### **13 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ß–∏ —î —Ä—ñ–∑–Ω–∏—Ü—è –≤ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –º—ñ–∂ `filter(Optional::isPresent).map(Optional::get)` —Ç–∞ `flatMap(Optional::stream)`? ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –ù–∞ –±—ñ–ª—å—à–æ—Å—Ç—ñ —Å—É—á–∞—Å–Ω–∏—Ö JVM —Ä—ñ–∑–Ω–∏—Ü—è –≤ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –±—É–¥–µ **–Ω–µ–∑–Ω–∞—á–Ω–æ—é –∞–±–æ –≤–∑–∞–≥–∞–ª—ñ –≤—ñ–¥—Å—É—Ç–Ω—å–æ—é**.
>
> **–¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑:**
>
> * `filter().map()`: –°—Ç–≤–æ—Ä—é—î –æ–¥–∏–Ω –ø—Ä–æ–º—ñ–∂–Ω–∏–π –ø–æ—Ç—ñ–∫ –ø—ñ—Å–ª—è `filter`.
> * `flatMap()`: –î–ª—è –∫–æ–∂–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ —Å—Ç–≤–æ—Ä—é—î –º—ñ–Ω—ñ-–ø–æ—Ç—ñ–∫ (–∑ 0 –∞–±–æ 1 –µ–ª–µ–º–µ–Ω—Ç–∞), —â–æ —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω–æ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –±—ñ–ª—å—à–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö –æ–±'—î–∫—Ç—ñ–≤.
>
> **–ü—Ä–∞–∫—Ç–∏—á–Ω–∞ —Ä–µ–∞–ª—å–Ω—ñ—Å—Ç—å:**
>
> JIT-–∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä –≤ Java —î –¥—É–∂–µ "—Ä–æ–∑—É–º–Ω–∏–º". –í—ñ–Ω –º–æ–∂–µ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –æ–±–∏–¥–≤–∞ –ª–∞–Ω—Ü—é–∂–∫–∏ –¥–æ –¥—É–∂–µ —Å—Ö–æ–∂–æ–≥–æ, —è–∫—â–æ –Ω–µ —ñ–¥–µ–Ω—Ç–∏—á–Ω–æ–≥–æ, –º–∞—à–∏–Ω–Ω–æ–≥–æ –∫–æ–¥—É. –í—ñ–Ω –º–æ–∂–µ "—Å–ø–ª–∞–≤–∏—Ç–∏" (fuse) –æ–ø–µ—Ä–∞—Ü—ñ—ó, —É—Å—É–Ω—É—Ç–∏ –∑–∞–π–≤—ñ –∞–ª–ª–æ–∫–∞—Ü—ñ—ó —Ç–∞ —ñ–Ω–ª–∞–π–Ω–∏—Ç–∏ –≤–∏–∫–ª–∏–∫–∏.
>
> **–í–∏—Å–Ω–æ–≤–æ–∫:**
> –í–∏–±—ñ—Ä –º—ñ–∂ —Ü–∏–º–∏ –¥–≤–æ–º–∞ –ø—ñ–¥—Ö–æ–¥–∞–º–∏ —Å–ª—ñ–¥ —Ä–æ–±–∏—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ **—á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞ –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ**, –∞ –Ω–µ –º—ñ–∫—Ä–æ–æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ–π. **`flatMap(Optional::stream)` —î –∫—Ä–∞—â–∏–º**, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –±—ñ–ª—å—à –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∏–π, —ñ–¥—ñ–æ–º–∞—Ç–∏—á–Ω–∏–π —Ç–∞ –º–µ–Ω—à —Å—Ö–∏–ª—å–Ω–∏–π –¥–æ –ø–æ–º–∏–ª–æ–∫ (—è–∫-–æ—Ç –ø—Ä–æ–ø—É—Å–∫ `filter`).

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó—Ä—ñ–ª–µ —Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–æ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ. –ö–∞–Ω–¥–∏–¥–∞—Ç –ø–æ–≤–∏–Ω–µ–Ω —Ä–æ–∑—É–º—ñ—Ç–∏, —â–æ JIT-–æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó —á–∞—Å—Ç–æ –Ω—ñ–≤–µ–ª—é—é—Ç—å —Ç–µ–æ—Ä–µ—Ç–∏—á–Ω—ñ –≤—ñ–¥–º—ñ–Ω–Ω–æ—Å—Ç—ñ, —ñ —â–æ —á–∏—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å –∫–æ–¥—É —î –±—ñ–ª—å—à –≤–∞–∂–ª–∏–≤–∏–º —Ñ–∞–∫—Ç–æ—Ä–æ–º.*

* * *

### **14 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–Ø–∫ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `Stream.ofNullable` —Ç–∞ `Optional` –±–µ–∑–ø–µ—á–Ω–æ –æ–±—Ä–æ–±–∏—Ç–∏ –ª–∞–Ω—Ü—é–∂–æ–∫ –≤–∏–∫–ª–∏–∫—ñ–≤, –¥–µ –±—É–¥—å-—è–∫–∏–π –∑ –Ω–∏—Ö –º–æ–∂–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ `null`? ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> **–ó–∞–¥–∞—á–∞:** –ë–µ–∑–ø–µ—á–Ω–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –Ω–∞–∑–≤—É –≤—É–ª–∏—Ü—ñ –∑ –æ–±'—î–∫—Ç–∞ `User`, –¥–µ `user` –º–æ–∂–µ –±—É—Ç–∏ `null`, `user.getAddress()` –º–æ–∂–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ `null`, —ñ `address.getStreet()` –º–æ–∂–µ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ `null`.
>
> **–¢—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥:** "–ü—ñ—Ä–∞–º—ñ–¥–∞ –ø–µ–∫–ª–∞" –∑ `if (obj != null)`.
>
> **–ü—ñ–¥—Ö—ñ–¥ –∑ `Optional`:**
>
> ```java
> Optional.ofNullable(user)
>         .map(User::getAddress)
>         .map(Address::getStreet)
>         .orElse("Unknown Street");
> ```
>
> –¶–µ –¥–æ–±—Ä–µ, –∞–ª–µ `map` –ø–æ–≤–µ—Ä—Ç–∞—î `null` –≤ `Optional`, —â–æ –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –ø—Ä–æ–±–ª–µ–º–∏. `flatMap` –∫—Ä–∞—â–µ.
>
> ```java
> Optional.ofNullable(user)
>         .flatMap(u -> Optional.ofNullable(u.getAddress()))
>         .flatMap(a -> Optional.ofNullable(a.getStreet()))
>         .orElse("Unknown Street");
> ```
>
> **–ü—ñ–¥—Ö—ñ–¥ –∑ `Stream.ofNullable` (—â–µ –æ–¥–∏–Ω –≤–∞—Ä—ñ–∞–Ω—Ç):**
>
> –ú–∏ –º–æ–∂–µ–º–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–∏ –∫–æ–∂–µ–Ω –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ `null`-–æ–±'—î–∫—Ç —è–∫ –ø–æ—Ç—ñ–∫ –∑ 0 –∞–±–æ 1 –µ–ª–µ–º–µ–Ω—Ç–∞.
>
> ```java
> String street = Stream.ofNullable(user)
>      .map(User::getAddress)
>      .flatMap(Stream::ofNullable) // –Ø–∫—â–æ address —î null, –ø–æ—Ç—ñ–∫ —Å—Ç–∞–Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ–º
>      .map(Address::getStreet)
>      .flatMap(Stream::ofNullable) // –Ø–∫—â–æ street —î null, –ø–æ—Ç—ñ–∫ —Å—Ç–∞–Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ–º
>      .findFirst()
>      .orElse("Unknown Street");
> ```
>
> `flatMap` –∑ `Stream::ofNullable` –µ–ª–µ–≥–∞–Ω—Ç–Ω–æ –ø–µ—Ä–µ—Ä–∏–≤–∞—î –ª–∞–Ω—Ü—é–∂–æ–∫, —è–∫—â–æ –Ω–∞ –±—É–¥—å-—è–∫–æ–º—É –µ—Ç–∞–ø—ñ –∑—É—Å—Ç—Ä—ñ—á–∞—î—Ç—å—Å—è `null`. –û–¥–Ω–∞–∫, –ª–∞–Ω—Ü—é–∂–æ–∫ –∑ `Optional` –∑–∞–∑–≤–∏—á–∞–π —î –±—ñ–ª—å—à —ñ–¥—ñ–æ–º–∞—Ç–∏—á–Ω–∏–º –¥–ª—è —Ç–∞–∫–æ—ó –∑–∞–¥–∞—á—ñ.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–¥–∞—Ç–Ω—ñ—Å—Ç—å –≤–∏—Ä—ñ—à—É–≤–∞—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É –±–µ–∑–ø–µ—á–Ω–æ—ó –Ω–∞–≤—ñ–≥–∞—Ü—ñ—ó –ø–æ –æ–±'—î–∫—Ç–∞—Ö —Ä—ñ–∑–Ω–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏. –¶–µ –ø–æ–∫–∞–∑—É—î –≥–ª–∏–±–æ–∫–µ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è API.*

* * *

### **15 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ù–∞–≤–µ–¥—ñ—Ç—å –ø—Ä–∏–∫–ª–∞–¥, –¥–µ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—è `Optional.stream()` –∑ `Collectors.groupingBy` –º–æ–∂–µ –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–æ—é. ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –£—è–≤—ñ–º–æ, —É –Ω–∞—Å —î —Å–ø–∏—Å–æ–∫ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤, —ñ –º–∏ —Ö–æ—á–µ–º–æ –∑–≥—Ä—É–ø—É–≤–∞—Ç–∏ —ó—Ö –∑–∞ –ø—Ä–æ–µ–∫—Ç–æ–º, –Ω–∞–¥ —è–∫–∏–º –≤–æ–Ω–∏ –ø—Ä–∞—Ü—é—é—Ç—å. –ü—Ä–∏ —Ü—å–æ–º—É –ø–æ–ª–µ –ø—Ä–æ–µ–∫—Ç—É —î `Optional<String>`, –æ—Å–∫—ñ–ª—å–∫–∏ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫ –º–æ–∂–µ –±—É—Ç–∏ –Ω–µ –ø—Ä–∏–≤'—è–∑–∞–Ω–∏–π –¥–æ –∂–æ–¥–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç—É. –ù–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–∞ –º–∞–ø–∞, —â–æ –≤–∫–ª—é—á–∞—î –ª–∏—à–µ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤, —è–∫—ñ –ø—Ä–∞—Ü—é—é—Ç—å –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–∞–º–∏.
>
> **–ó–∞–¥–∞—á–∞:** –°—Ç–≤–æ—Ä–∏—Ç–∏ `Map<String, List<Employee>>` –∑ `List<Employee>`, –¥–µ `employee.getProject()` –ø–æ–≤–µ—Ä—Ç–∞—î `Optional<String>`.
>
> **–†—ñ—à–µ–Ω–Ω—è:**
> –ú–∏ –Ω–µ –º–æ–∂–µ–º–æ –ø—Ä–æ—Å—Ç–æ –∑—Ä–æ–±–∏—Ç–∏ `groupingBy(e -> e.getProject().get())`, –±–æ —Ü–µ –∫–∏–Ω–µ –≤–∏–Ω—è—Ç–æ–∫ –¥–ª—è —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤ –±–µ–∑ –ø—Ä–æ–µ–∫—Ç—É.
>
> –ú–∏ –º–æ–∂–µ–º–æ "—Å–ø–ª—é—â–∏—Ç–∏" –¥–∞–Ω—ñ. –î–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞, —É —è–∫–æ–≥–æ —î –ø—Ä–æ–µ–∫—Ç, –º–∏ —Å—Ç–≤–æ—Ä—é—î–º–æ –ø–∞—Ä—É "–Ω–∞–∑–≤–∞ –ø—Ä–æ–µ–∫—Ç—É -> —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫". –°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏ –±–µ–∑ –ø—Ä–æ–µ–∫—Ç—É —ñ–≥–Ω–æ—Ä—É—é—Ç—å—Å—è.
>
> ```java
> List<Employee> employees = ...;
> 
> Map<String, List<Employee>> employeesByProject = employees.stream()
>     .flatMap(employee -> 
>         employee.getProject().stream() // –°—Ç–≤–æ—Ä—é—î –ø–æ—Ç—ñ–∫ –∑ 0 –∞–±–æ 1 –ø—Ä–æ–µ–∫—Ç—É
>                 .map(projectName -> new AbstractMap.SimpleEntry<>(projectName, employee))
>     ) // –û—Ç—Ä–∏–º—É—î–º–æ Stream<Entry<String, Employee>>
>     .collect(Collectors.groupingBy(
>         Map.Entry::getKey,
>         Collectors.mapping(Map.Entry::getValue, Collectors.toList())
>     ));
> ```
>
> **–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î:**
>
> 1. `flatMap` –æ–±—Ä–æ–±–ª—è—î –∫–æ–∂–Ω–æ–≥–æ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞.
> 2. `employee.getProject().stream()` –¥–ª—è —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞ –∑ –ø—Ä–æ–µ–∫—Ç–æ–º –ø–æ–≤–µ—Ä–Ω–µ `Stream` –∑ –æ–¥–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞ (–Ω–∞–∑–≤–∏ –ø—Ä–æ–µ–∫—Ç—É). –î–ª—è —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞ –±–µ–∑ –ø—Ä–æ–µ–∫—Ç—É ‚Äî –ø–æ—Ä–æ–∂–Ω—ñ–π `Stream`.
> 3. `.map(...)` –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ `flatMap` –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –Ω–∞–∑–≤—É –ø—Ä–æ–µ–∫—Ç—É –Ω–∞ –ø–∞—Ä—É `(–ø—Ä–æ–µ–∫—Ç, —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫)`.
> 4. `flatMap` "–≤–∏–∫–∏–¥–∞—î" —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤ –±–µ–∑ –ø—Ä–æ–µ–∫—Ç—É —ñ –∑–∞–ª–∏—à–∞—î –Ω–∞–º –ø–æ—Ç—ñ–∫ –ø–∞—Ä.
> 5. `groupingBy` –∑–±–∏—Ä–∞—î —Ü–µ–π –ø–æ—Ç—ñ–∫ –ø–∞—Ä —É –ø–æ—Ç—Ä—ñ–±–Ω—É –º–∞–ø—É.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ï–∫—Å–ø–µ—Ä—Ç–Ω–µ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è `Stream API` —Ç–∞ `Optional`. –¶–µ –¥—É–∂–µ —Å–∫–ª–∞–¥–Ω–∏–π, –∞–ª–µ –ø—Ä–∞–∫—Ç–∏—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥, —è–∫–∏–π –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞ –∫–æ–º–±—ñ–Ω—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –ø—Ä–æ—Å—É–Ω—É—Ç–∏—Ö —Ç–µ—Ö–Ω—ñ–∫ –¥–ª—è –≤–∏—Ä—ñ—à–µ–Ω–Ω—è —Ä–µ–∞–ª—å–Ω–æ—ó –∑–∞–¥–∞—á—ñ.*

* * *
