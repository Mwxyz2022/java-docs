---
layout: default
title: "Thread-safe –∫–æ–ª–µ–∫—Ü—ñ—ó"
parent: "–ö–æ–ª–µ–∫—Ü—ñ—ó: ArrayList —Ç–∞ LinkedList"
grand_parent: "Java Core"
nav_order: 13
---

# Thread-safe –∫–æ–ª–µ–∫—Ü—ñ—ó

* –∫–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å: `Thread-safe` –∫–æ–ª–µ–∫—Ü—ñ—ó ‚Äì —Ü–µ –∫–æ–ª–µ–∫—Ü—ñ—ó, —è–∫—ñ –º–æ–∂—É—Ç—å –±–µ–∑–ø–µ—á–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è –∫—ñ–ª—å–∫–æ–º–∞ –ø–æ—Ç–æ–∫–∞–º–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ –±–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ —Å–∞–º—ñ –¥–±–∞—é—Ç—å –ø—Ä–æ –≤–Ω—É—Ç—Ä—ñ—à–Ω—î –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –∞–±–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è.

* –ø–æ–Ω—è—Ç—Ç—è: `Thread-safe`, `concurrency`, `ConcurrentHashMap`, `CopyOnWriteArrayList`, `BlockingQueue`.

* –ø—Ä–∏–∫–ª–∞–¥–∏: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `ConcurrentHashMap` –¥–ª—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏—Ö –º–∞–ø, `CopyOnWriteArrayList` –¥–ª—è —Å–ø–∏—Å–∫—ñ–≤, –¥–µ —á–∞—Å—Ç—ñ —á–∏—Ç–∞–Ω–Ω—è —ñ —Ä—ñ–¥–∫—ñ –∑–º—ñ–Ω–∏.

* –∫–ª—é—á–æ–≤—ñ –º–æ–º–µ–Ω—Ç–∏: –ù–µ–æ–±—Ö—ñ–¥–Ω—ñ –≤ –±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤–∏—Ö –∑–∞—Å—Ç–æ—Å—É–Ω–∫–∞—Ö. –í–∏–±—ñ—Ä –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —Å—Ü–µ–Ω–∞—Ä—ñ—é –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è (–±–∞–≥–∞—Ç–æ —á–∏—Ç–∞–Ω—å/–∑–∞–ø–∏—Å—ñ–≤).

* —â–æ –≤–∞–∂–ª–∏–≤–æ –∑–Ω–∞—Ç–∏ –Ω–∞ —Å–ø—ñ–≤–±–µ—Å—ñ–¥—ñ: –ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ, –æ—Å–Ω–æ–≤–Ω—ñ `thread-safe` –∫–æ–ª–µ–∫—Ü—ñ—ó.

### **‚úÖ –û—Ñ—ñ—Ü—ñ–π–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è:**

**`Thread-safe –∫–æ–ª–µ–∫—Ü—ñ—ó`** ‚Äî —Ü–µ –∫–æ–ª–µ–∫—Ü—ñ—ó, —è–∫—ñ –º–æ–∂—É—Ç—å –±–µ–∑–ø–µ—á–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—å –∫—ñ–ª—å–∫–æ–º–∞ –ø–æ—Ç–æ–∫–∞–º–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ –±–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó.

### **üß† –ü—Ä–æ—Å—Ç–∏–º–∏ —Å–ª–æ–≤–∞–º–∏:**

–¶–µ –∫–æ–ª–µ–∫—Ü—ñ—ó, —è–∫—ñ –Ω–µ —Ä–æ–∑–≤–∞–ª—è—Ç—å—Å—è, —è–∫—â–æ –¥–æ –Ω–∏—Ö –∑–≤–µ—Ä—Ç–∞—Ç–∏–º—É—Ç—å—Å—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ –∑ —Ä—ñ–∑–Ω–∏—Ö –ø–æ—Ç–æ–∫—ñ–≤. –í–æ–Ω–∏ —Å–∞–º—ñ –¥–±–∞—é—Ç—å –ø—Ä–æ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è, –∫–æ–ø—ñ—ó —á–∏ –∞—Ç–æ–º–∞—Ä–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ "–ø–æ—Ç–æ–∫–æ–≤–æ–≥–æ —Ö–∞–æ—Å—É".

---

## **üìä –ù–∞–π–ø–æ—à–∏—Ä–µ–Ω—ñ—à—ñ thread-safe –∫–æ–ª–µ–∫—Ü—ñ—ó:**

| –ö–æ–ª–µ–∫—Ü—ñ—è | –¢–∏–ø | –ú–µ—Ö–∞–Ω—ñ–∑–º –±–µ–∑–ø–µ–∫–∏ | –ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è |
| :---: | :---: | ----- | ----- |
| **`ConcurrentHashMap`** | **`Map`** | –°–µ–≥–º–µ–Ω—Ç–æ–≤–∞–Ω–∞ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è, CAS | –ß–∞—Å—Ç—ñ —á–∏—Ç–∞–Ω–Ω—è —Ç–∞ –∑–∞–ø–∏—Å–∏ |
| **`CopyOnWriteArrayList`** | **`List`** | –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –Ω–∞ –∑–∞–ø–∏—Å | –ß–∞—Å—Ç—ñ —á–∏—Ç–∞–Ω–Ω—è, —Ä—ñ–¥–∫—ñ –∑–º—ñ–Ω–∏ |
| **`ConcurrentLinkedQueue`** | **`Queue`** | –ù–µ–±–ª–æ–∫—É—é—á—ñ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ (lock-free) | –í–∏—Å–æ–∫–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü—ñ—è –º—ñ–∂ –ø–æ—Ç–æ–∫–∞–º–∏ |
| **`BlockingQueue`** | **`Queue`** | –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –∑ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è–º (**`take/put`**) | –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –º—ñ–∂ –ø–æ—Ç–æ–∫–∞–º–∏ |
| **`SynchronizedList`** | –û–±–≥–æ—Ä—Ç–∫–∞ –¥–ª—è **`List`** | **`Collections.synchronizedList(list)`** | –ü—Ä–æ—Å—Ç–µ —Ä—ñ—à–µ–Ω–Ω—è, –±–∞–∑–æ–≤–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è |

---

## **–ü–æ—è—Å–Ω–µ–Ω–Ω—è –Ω–∞ –ø–∞–ª—å—Ü—è—Ö (üí°)**

–£—è–≤–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–Ω—É –∫—É—Ö–Ω—é:

* **`ArrayList`** ‚Äî —É—Å—ñ –∫—É—Ö–∞—Ä—ñ —Ä—ñ–∂—É—Ç—å –æ–≤–æ—á—ñ –∑ –æ–¥–Ω—ñ—î—ó –¥–æ—à–∫–∏. –•–∞–æ—Å. ü•¥
* **`CopyOnWriteArrayList`** ‚Äî –∫–æ–∂–Ω–æ–º—É –∫—É—Ö–∞—Ä—é –≤–∏–¥–∞—î—Ç—å—Å—è –∫–æ–ø—ñ—è –¥–æ—à–∫–∏, –∞–ª–µ —Ü–µ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ. üßë‚Äçüç≥üìÑ
* **`ConcurrentHashMap`** ‚Äî –∫–æ–∂–µ–Ω –∫—É—Ö–∞—Ä –º–∞—î –¥–æ—Å—Ç—É–ø –¥–æ —Å–≤–æ—î—ó –∑–æ–Ω–∏ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞. –†–æ–∑–¥—ñ–ª–µ–Ω–æ —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ. ‚ùÑÔ∏èü•ï

---

## **–ö–æ—Ä–∏—Å–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ (üß™)**

### **‚ùå –ù–µ–±–µ–∑–ø–µ–∫–∞ –∑–≤–∏—á–∞–π–Ω–æ—ó –∫–æ–ª–µ–∫—Ü—ñ—ó:**

```java
List<String> list = new ArrayList<>();

Runnable writer = () -> list.add(Thread.currentThread().getName());
Thread t1 = new Thread(writer);
Thread t2 = new Thread(writer);

t1.start(); t2.start(); // üí• –ú–æ–∂–µ —Å—Ç–∞—Ç–∏—Å—è race condition
```

### **‚úÖ Thread-safe –≤–∞—Ä—ñ–∞–Ω—Ç:**

```java
List<String> list = new CopyOnWriteArrayList<>();

Runnable writer = () -> list.add(Thread.currentThread().getName());
new Thread(writer).start();
new Thread(writer).start(); // üëç –ë–µ–∑–ø–µ—á–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è
```

### **–ü—Ä–∏–∫–ª–∞–¥ –∑ `ConcurrentHashMap`:**

```java
Map<String, Integer> map = new ConcurrentHashMap<>();

Runnable updater = () -> map.put(Thread.currentThread().getName(), 1);
new Thread(updater).start();
new Thread(updater).start(); // üß† –ë–µ–∑ –±–ª–æ–∫—É–≤–∞–Ω—å, –ø—Ä–∞—Ü—é—î –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ
```

---

## **–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è (‚öñÔ∏è)**

| –û—Å–æ–±–ª–∏–≤—ñ—Å—Ç—å | `ArrayList` / `HashMap` | `CopyOnWriteArrayList` | `ConcurrentHashMap` |
| :---: | :---: | :---: | :---: |
| **Thread-safe** | ‚ùå | ‚úÖ | ‚úÖ |
| **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –Ω–∞ –∑–∞–ø–∏—Å** | üîº (—à–≤–∏–¥–∫–æ) | üîΩ (–ø–æ–≤—ñ–ª—å–Ω–æ) | ‚öñÔ∏è (–∑–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–æ) |
| **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –Ω–∞ —á–∏—Ç–∞–Ω–Ω—è** | üîº | üîº | üîº |
| **–ü—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è** | –û–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–∏—Ö –∑–∞–¥–∞—á | –ë–∞–≥–∞—Ç–æ—á–∏—Ç–∞–ª—å–Ω–∏—Ö –∑–∞–¥–∞—á | –í–∏—Å–æ–∫–æ–Ω–≤–∞–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∏—Ö |

---

## **üß† –ú–Ω–µ–º–æ–Ω—ñ–∫–∞ –¥–ª—è –∑–∞–ø–∞–º‚Äô—è—Ç–æ–≤—É–≤–∞–Ω–Ω—è:**

**"CopyOnWrite ‚Äî —á–∏—Ç–∞–π —Ö–æ—á —Å—Ç–æ —Ä–∞–∑, –∑–º—ñ–Ω—é–π ‚Äî –∫–æ–ø—ñ—è\!"**

**"Concurrent ‚Äî –ø—Ä–∞—Ü—é—î —Ä–∞–∑–æ–º, –Ω–µ –±‚Äô—î—Ç—å—Å—è –Ω—ñ—Ö—Ç–æ\!"**

---

## **üü© –ü—ñ–¥—Å—É–º–æ–∫:**

* Thread-safe –∫–æ–ª–µ–∫—Ü—ñ—ó —Ä—è—Ç—É—é—Ç—å —É –±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ—á–Ω–∏—Ö –∑–∞—Å—Ç–æ—Å—É–Ω–∫–∞—Ö.
* –û–±–∏—Ä–∞–π —Ç–∏–ø –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –±–∞–ª–∞–Ω—Å—É **–∑–∞–ø–∏—Å/—á–∏—Ç–∞–Ω–Ω—è**.
* –ù–µ –∑–∞–≤–∂–¥–∏ –≤–∞—Ä—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ thread-safe ‚Äî —É –æ–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ —Ü–µ –ª–∏—à–µ –Ω–∞–∫–ª–∞–¥–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏.
* –ù–∞–π–±—ñ–ª—å—à –ø—Ä–∞–∫—Ç–∏—á–Ω—ñ: **`ConcurrentHashMap`**, **`CopyOnWriteArrayList`**, **`BlockingQueue`**.

üîó –ö–æ—Ä–∏—Å–Ω—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è:

* [Java Docs ‚Äî ConcurrentHashMap](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentHashMap.html)

* * *

# **FAQ ‚Äî –ß–∞—Å—Ç—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è (‚ùì)**

### **1 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–©–æ —Ç–∞–∫–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∞ (thread-safe) –∫–æ–ª–µ–∫—Ü—ñ—è?

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> **–ü–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∞ –∫–æ–ª–µ–∫—Ü—ñ—è** ‚Äî —Ü–µ –∫–æ–ª–µ–∫—Ü—ñ—è, —è–∫–∞ –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ —ó—ó –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å—Ç–∞–Ω –∑–∞–ª–∏—à–∞—Ç–∏–º–µ—Ç—å—Å—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∏–º, –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –∫—ñ–ª—å–∫–∞ –ø–æ—Ç–æ–∫—ñ–≤ –∑–≤–µ—Ä—Ç–∞—é—Ç—å—Å—è –¥–æ –Ω–µ—ó –æ–¥–Ω–æ—á–∞—Å–Ω–æ (—á–∏—Ç–∞—é—Ç—å —Ç–∞ –∑–º—ñ–Ω—é—é—Ç—å –¥–∞–Ω—ñ).
>
> –í–æ–Ω–∞ —ñ–Ω–∫–∞–ø—Å—É–ª—é—î –º–µ—Ö–∞–Ω—ñ–∑–º–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –±–ª–æ–∫—É–≤–∞–Ω–Ω—è, –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è, –∞—Ç–æ–º–∞—Ä–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó) –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å–≤–æ—ó—Ö –º–µ—Ç–æ–¥—ñ–≤. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –≤–∞–º, —è–∫ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—É, **–Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ** –ø–∏—Å–∞—Ç–∏ –∑–æ–≤–Ω—ñ—à–Ω—é —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é (`synchronized` –±–ª–æ–∫–∏) –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –±–∞–∑–æ–≤–æ—ó –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–æ—Å—Ç—ñ –æ–ø–µ—Ä–∞—Ü—ñ–π.
>
> **–ì–æ–ª–æ–≤–Ω–∞ –º–µ—Ç–∞:** –∑–∞–ø–æ–±—ñ–≥—Ç–∏ —Ç–∞–∫–∏–º –ø—Ä–æ–±–ª–µ–º–∞–º, —è–∫ **—Å—Ç–∞–Ω –≥–æ–Ω–∏—Ç–≤–∏ (race condition)**, –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ –¥–∞–Ω—ñ —Ç–∞ –≤–∏–Ω—è—Ç–∫–∏ —Ç–∏–ø—É `ConcurrentModificationException` —É –±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ.

#### **üìù –ê–Ω–∞–ª–æ–≥—ñ—è:**</h4>

–£—è–≤—ñ—Ç—å, —â–æ –∑–≤–∏—á–∞–π–Ω–∏–π `ArrayList` ‚Äî —Ü–µ –æ–¥–∏–Ω –±–ª–æ–∫–Ω–æ—Ç, —è–∫–∏–π –∫—ñ–ª—å–∫–∞ –ª—é–¥–µ–π –Ω–∞–º–∞–≥–∞—é—Ç—å—Å—è —Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ. –í–æ–Ω–∏ –º–æ–∂—É—Ç—å –∑–∞–≤–∞–∂–∞—Ç–∏ –æ–¥–∏–Ω –æ–¥–Ω–æ–º—É —ñ –∑—ñ–ø—Å—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Å–∏.
–ü–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∞ –∫–æ–ª–µ–∫—Ü—ñ—è ‚Äî —Ü–µ —è–∫ Google Doc. –°–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –¥–±–∞—î –ø—Ä–æ —Ç–µ, —â–æ–± –∑–º—ñ–Ω–∏ –≤—ñ–¥ —Ä—ñ–∑–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–µ –ø—Ä–∏–∑–≤–µ–ª–∏ –¥–æ —Ö–∞–æ—Å—É.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–†–æ–∑—É–º—ñ–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏—Ö –∫–æ–ª–µ–∫—Ü—ñ–π ‚Äî –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—ñ –¥–∞–Ω–∏—Ö —É –±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ.*

* * *

### **2 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ù–∞–∑–≤—ñ—Ç—å –∫—ñ–ª—å–∫–∞ —Å–ø–æ—Å–æ–±—ñ–≤ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—É –∫–æ–ª–µ–∫—Ü—ñ—é –≤ Java.

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –Ü—Å–Ω—É—î –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω–∏—Ö –ø—ñ–¥—Ö–æ–¥–∏:
>
> 1. **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–∏—Ö –æ–±–≥–æ—Ä—Ç–æ–∫ (Synchronized Wrappers):**
>     * –¶–µ –Ω–∞–π—Å—Ç–∞—Ä—ñ—à–∏–π —ñ –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π —Å–ø–æ—Å—ñ–±. –ö–ª–∞—Å `java.util.Collections` –Ω–∞–¥–∞—î —Å—Ç–∞—Ç–∏—á–Ω—ñ –º–µ—Ç–æ–¥–∏ –¥–ª—è "–æ–±–≥–æ—Ä—Ç–∞–Ω–Ω—è" –±—É–¥—å-—è–∫–æ—ó —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ—ó –∫–æ–ª–µ–∫—Ü—ñ—ó.
>     * **–ü—Ä–∏–∫–ª–∞–¥–∏:**
>         * `Collections.synchronizedList(new ArrayList<>());`
>         * `Collections.synchronizedMap(new HashMap<>());`
>         * `Collections.synchronizedSet(new HashSet<>());`
>     * **–Ø–∫ –ø—Ä–∞—Ü—é—î:** –ü–æ–≤–µ—Ä—Ç–∞—î –æ–±–≥–æ—Ä—Ç–∫—É, –¥–µ –∫–æ–∂–µ–Ω –º–µ—Ç–æ–¥ —î `synchronized`, —â–æ –æ–∑–Ω–∞—á–∞—î, —â–æ –æ–¥–Ω–æ—á–∞—Å–Ω–æ —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω –ø–æ—Ç—ñ–∫ –º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –±—É–¥—å-—è–∫—É –æ–ø–µ—Ä–∞—Ü—ñ—é.
>
> 2. **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∏—Ö –∫–æ–ª–µ–∫—Ü—ñ–π (Concurrent Collections):**
>     * –¶–µ –±—ñ–ª—å—à —Å—É—á–∞—Å–Ω–∏–π —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥. –¶—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ –ø–∞–∫–µ—Ç—ñ `java.util.concurrent`.
>     * –í–æ–Ω–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –±—ñ–ª—å—à —Å–∫–ª–∞–¥–Ω—ñ —Ç–∞ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è (–∞–±–æ –≤–∑–∞–≥–∞–ª—ñ –Ω–µ–±–ª–æ–∫—É—é—á—ñ –∞–ª–≥–æ—Ä–∏—Ç–º–∏), —â–æ–± –¥–æ—Å—è–≥—Ç–∏ –∫—Ä–∞—â–æ—ó –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —É –≤–∏—Å–æ–∫–æ–Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.
>     * **–ü—Ä–∏–∫–ª–∞–¥–∏:**
>         * `ConcurrentHashMap`
>         * `CopyOnWriteArrayList`
>         * `ConcurrentLinkedQueue`
>         * –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó `BlockingQueue`
>
> –£ —Å—É—á–∞—Å–Ω–æ–º—É –±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤–æ–º—É –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—ñ –ø–µ—Ä–µ–≤–∞–≥–∞ –º–∞–π–∂–µ –∑–∞–≤–∂–¥–∏ –Ω–∞–¥–∞—î—Ç—å—Å—è **–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∏–º –∫–æ–ª–µ–∫—Ü—ñ—è–º** —á–µ—Ä–µ–∑ —ó—Ö–Ω—é –≤–∏—â—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ç–∞ –∫—Ä–∞—â—É –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–Ω–∞–Ω–Ω—è –¥–≤–æ—Ö –æ—Å–Ω–æ–≤–Ω–∏—Ö —Å–ø–æ—Å–æ–±—ñ–≤: –∑–∞—Å—Ç–∞—Ä—ñ–ª—ñ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω—ñ –æ–±–≥–æ—Ä—Ç–∫–∏ —Ç–∞ —Å—É—á–∞—Å–Ω—ñ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó.*

* * *

### **3 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–£ —á–æ–º—É –Ω–µ–¥–æ–ª—ñ–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–∏—Ö –æ–±–≥–æ—Ä—Ç–æ–∫ (`Collections.synchronizedList` —Ç–æ—â–æ)? ‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –•–æ—á–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω—ñ –æ–±–≥–æ—Ä—Ç–∫–∏ –∑–∞–±–µ–∑–ø–µ—á—É—é—Ç—å –±–∞–∑–æ–≤—É –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—ñ—Å—Ç—å, –≤–æ–Ω–∏ –º–∞—é—Ç—å –∫—ñ–ª—å–∫–∞ —Å—É—Ç—Ç—î–≤–∏—Ö –Ω–µ–¥–æ–ª—ñ–∫—ñ–≤:
>
> 1. **–ù–∏–∑—å–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —Ç–∞ –ø–æ–≥–∞–Ω–∞ –º–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å:**
>     * –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è **–æ–¥–Ω–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è (lock) –Ω–∞ –≤—Å—é –∫–æ–ª–µ–∫—Ü—ñ—é**. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –æ–¥–Ω–æ—á–∞—Å–Ω–æ —Ç—ñ–ª—å–∫–∏ –æ–¥–∏–Ω –ø–æ—Ç—ñ–∫ –º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –±—É–¥—å-—è–∫—É –æ–ø–µ—Ä–∞—Ü—ñ—é (–Ω–∞–≤—ñ—Ç—å —á–∏—Ç–∞–Ω–Ω—è).
>     * –¶–µ —Å—Ç–≤–æ—Ä—é—î "–ø–ª—è—à–∫–æ–≤–µ –≥–æ—Ä–ª–æ", –∫–æ–ª–∏ –±–∞–≥–∞—Ç–æ –ø–æ—Ç–æ–∫—ñ–≤ –Ω–∞–º–∞–≥–∞—é—Ç—å—Å—è –∑–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –∫–æ–ª–µ–∫—Ü—ñ—ó.
>
> 2. **–ù–µ–ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∞ —ñ—Ç–µ—Ä–∞—Ü—ñ—è:**
>     * –Ü—Ç–µ—Ä–∞—Ü—ñ—è –ø–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω—ñ–π –∫–æ–ª–µ–∫—Ü—ñ—ó **–Ω–µ —î –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–æ—é**. –Ø–∫—â–æ –æ–¥–∏–Ω –ø–æ—Ç—ñ–∫ —ñ—Ç–µ—Ä—É—î, –∞ —ñ–Ω—à–∏–π –≤ —Ü–µ–π —á–∞—Å –∑–º—ñ–Ω—é—î –∫–æ–ª–µ–∫—Ü—ñ—é, –≤—Å–µ –æ–¥–Ω–æ –±—É–¥–µ –∫–∏–Ω—É—Ç–æ `ConcurrentModificationException`.
>     * –î–ª—è –±–µ–∑–ø–µ—á–Ω–æ—ó —ñ—Ç–µ—Ä–∞—Ü—ñ—ó –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤—Ä—É—á–Ω—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑—É–≤–∞—Ç–∏—Å—è –Ω–∞ –æ–±'—î–∫—Ç—ñ-–∫–æ–ª–µ–∫—Ü—ñ—ó:
>
>         ```java
>         synchronized (syncList) {
>             for (String s : syncList) { /* ... */ }
>         }
>         ```
>
> 3. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∞—Ç–æ–º–∞—Ä–Ω–∏—Ö "check-then-act" –æ–ø–µ—Ä–∞—Ü—ñ–π:**
>     * –¢–∞–∫—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó, —è–∫ `if (!map.containsKey(key)) { map.put(key, value); }`, –Ω–µ —î –∞—Ç–æ–º–∞—Ä–Ω–∏–º–∏. –ú—ñ–∂ `containsKey` —Ç–∞ `put` –º–æ–∂–µ –≤—Ç—Ä—É—Ç–∏—Ç–∏—Å—è —ñ–Ω—à–∏–π –ø–æ—Ç—ñ–∫.
>
> –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó, —è–∫-–æ—Ç `ConcurrentHashMap`, –≤–∏—Ä—ñ—à—É—é—Ç—å —É—Å—ñ —Ü—ñ –ø—Ä–æ–±–ª–µ–º–∏.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ì–ª–∏–±–æ–∫–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è –æ–±–º–µ–∂–µ–Ω—å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–∏—Ö –æ–±–≥–æ—Ä—Ç–æ–∫, –æ—Å–æ–±–ª–∏–≤–æ –ø—Ä–æ–±–ª–µ–º–∏ –∑ —ñ—Ç–µ—Ä–∞—Ü—ñ—î—é —Ç–∞ –∞—Ç–æ–º–∞—Ä–Ω—ñ—Å—Ç—é, —â–æ –ø–æ—è—Å–Ω—é—î, —á–æ–º—É –≤–æ–Ω–∏ –∑–∞–∑–≤–∏—á–∞–π —î –ø–æ–≥–∞–Ω–∏–º –≤–∏–±–æ—Ä–æ–º.*

* * *

### **4 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–Ø–∫ –ø—Ä–∞—Ü—é—î `ConcurrentHashMap` —ñ –≤ —á–æ–º—É –π–æ–≥–æ –ø–µ—Ä–µ–≤–∞–≥–∞ –Ω–∞–¥ `Hashtable` –∞–±–æ `Collections.synchronizedMap`? ‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> `ConcurrentHashMap` —î –∑–Ω–∞—á–Ω–æ –±—ñ–ª—å—à –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–æ—é.
>
> **–ü–µ—Ä–µ–≤–∞–≥–∏ –Ω–∞–¥ `Hashtable` / `synchronizedMap`:**
>
> * **–í–∏—Å–æ–∫–∞ –ø—Ä–æ–ø—É—Å–∫–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å (Throughput):** –û—Å–Ω–æ–≤–Ω–∞ –ø–µ—Ä–µ–≤–∞–≥–∞ ‚Äî –≤—ñ–Ω **–Ω–µ –±–ª–æ–∫—É—î –≤—Å—é –º–∞–ø—É** –ø—Ä–∏ –æ–ø–µ—Ä–∞—Ü—ñ—è—Ö –∑–∞–ø–∏—Å—É.
>
> **–Ø–∫ –ø—Ä–∞—Ü—é—î `ConcurrentHashMap` (–∑ Java 8):**
>
> 1. **–î—Ä—ñ–±–Ω–æ–≥—Ä–∞–Ω—É–ª—è—Ä–Ω–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è:** –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è **–Ω–∞ —Ä—ñ–≤–Ω—ñ –æ–∫—Ä–µ–º–æ–≥–æ "–∫–æ—à–∏–∫–∞" (bucket)**, –∞ –Ω–µ –Ω–∞ –≤—Å—ñ–π –º–∞–ø—ñ. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –∫—ñ–ª—å–∫–∞ –ø–æ—Ç–æ–∫—ñ–≤ –º–æ–∂—É—Ç—å –æ–¥–Ω–æ—á–∞—Å–Ω–æ –∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ –≤ **—Ä—ñ–∑–Ω—ñ** –∫–æ—à–∏–∫–∏.
> 2. **–ù–µ–±–ª–æ–∫—É—é—á—ñ —á–∏—Ç–∞–Ω–Ω—è:** –û–ø–µ—Ä–∞—Ü—ñ—ó —á–∏—Ç–∞–Ω–Ω—è (`get`) –∑–∞–∑–≤–∏—á–∞–π –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è **–±–µ–∑ –±—É–¥—å-—è–∫–∏—Ö –±–ª–æ–∫—É–≤–∞–Ω—å**, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ `volatile` —Ç–∞ CAS (Compare-And-Swap) –¥–ª—è –≥–∞—Ä–∞–Ω—Ç—ñ—ó –≤–∏–¥–∏–º–æ—Å—Ç—ñ –∑–º—ñ–Ω.
> 3. **–ê—Ç–æ–º–∞—Ä–Ω—ñ "check-then-act" –æ–ø–µ—Ä–∞—Ü—ñ—ó:** –ù–∞–¥–∞—î –∞—Ç–æ–º–∞—Ä–Ω—ñ –º–µ—Ç–æ–¥–∏, —è–∫-–æ—Ç `putIfAbsent()`, `compute()`, `merge()`, —â–æ –¥–æ–∑–≤–æ–ª—è—é—Ç—å –±–µ–∑–ø–µ—á–Ω–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –±–µ–∑ –∑–æ–≤–Ω—ñ—à–Ω—å–æ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó.
>
> **–†–µ–∑—É–ª—å—Ç–∞—Ç:** `ConcurrentHashMap` –¥–æ–∑–≤–æ–ª—è—î –¥–æ—Å—è–≥—Ç–∏ –¥—É–∂–µ –≤–∏—Å–æ–∫–æ–≥–æ —Ä—ñ–≤–Ω—è –ø–∞—Ä–∞–ª–µ–ª—ñ–∑–º—É, –æ—Å–∫—ñ–ª—å–∫–∏ –ø–æ—Ç–æ–∫–∏-—á–∏—Ç–∞—á—ñ –Ω–µ –±–ª–æ–∫—É—é—Ç—å –ø–æ—Ç–æ–∫—ñ–≤-–ø–∏—Å—å–º–µ–Ω–Ω–∏–∫—ñ–≤, —ñ –ø–∏—Å—å–º–µ–Ω–Ω–∏–∫–∏ —Ä—ñ–¥–∫–æ –±–ª–æ–∫—É—é—Ç—å –æ–¥–∏–Ω –æ–¥–Ω–æ–≥–æ. `Hashtable` –∂–µ, –Ω–∞–≤–ø–∞–∫–∏, –∑–º—É—à—É—î –≤—Å—ñ –ø–æ—Ç–æ–∫–∏ "—à–∏–∫—É–≤–∞—Ç–∏—Å—è –≤ —á–µ—Ä–≥—É".

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–†–æ–∑—É–º—ñ–Ω–Ω—è –∫–ª—é—á–æ–≤–æ–≥–æ –ø—Ä–∏–Ω—Ü–∏–ø—É `ConcurrentHashMap` ‚Äî –¥—Ä—ñ–±–Ω–æ–≥—Ä–∞–Ω—É–ª—è—Ä–Ω–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è ‚Äî —Ç–∞ –π–æ–≥–æ –≤–ø–ª–∏–≤—É –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å —É –±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.*

* * *

### **5 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ü–æ—è—Å–Ω—ñ—Ç—å, —è–∫ –ø—Ä–∞—Ü—é—î `CopyOnWriteArrayList` —ñ –∫–æ–ª–∏ –π–æ–≥–æ –¥–æ—Ü—ñ–ª—å–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏. ‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> **`CopyOnWriteArrayList`** ‚Äî —Ü–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è `List`.
>
> **–Ø–∫ –ø—Ä–∞—Ü—é—î:**
>
> * –ü—Ä–∏ **–±—É–¥—å-—è–∫—ñ–π –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑–∞–ø–∏—Å—É** (`add`, `remove`, `set`) –≤—ñ–Ω **–Ω–µ –∑–º—ñ–Ω—é—î —ñ—Å–Ω—É—é—á–∏–π –º–∞—Å–∏–≤**, –∞ —Å—Ç–≤–æ—Ä—é—î **–ø–æ–≤–Ω—É –Ω–æ–≤—É –∫–æ–ø—ñ—é** –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ –º–∞—Å–∏–≤—É, –≤–Ω–æ—Å–∏—Ç—å –∑–º—ñ–Ω–∏ –≤ —Ü—é –∫–æ–ø—ñ—é, –∞ –ø–æ—Ç—ñ–º –∞—Ç–æ–º–∞—Ä–Ω–æ –∑–∞–º—ñ–Ω—é—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å—Ç–∞—Ä–∏–π –º–∞—Å–∏–≤ –Ω–æ–≤–∏–º.
>
> * –û–ø–µ—Ä–∞—Ü—ñ—ó **—á–∏—Ç–∞–Ω–Ω—è** (`get`, —ñ—Ç–µ—Ä–∞—Ü—ñ—è) –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è **–±–µ–∑ –±—É–¥—å-—è–∫–∏—Ö –±–ª–æ–∫—É–≤–∞–Ω—å** —ñ –ø—Ä–∞—Ü—é—é—Ç—å –∑ –ø–æ—Ç–æ—á–Ω–æ—é –≤–µ—Ä—Å—ñ—î—é –º–∞—Å–∏–≤—É.
>
> **–ö–æ–ª–∏ –π–æ–≥–æ –¥–æ—Ü—ñ–ª—å–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:**
>
> –í—ñ–Ω —ñ–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è —Å—Ü–µ–Ω–∞—Ä—ñ—ó–≤, –¥–µ **–∫—ñ–ª—å–∫—ñ—Å—Ç—å —á–∏—Ç–∞–Ω—å –∑–Ω–∞—á–Ω–æ –ø–µ—Ä–µ–≤–∏—â—É—î –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Å—ñ–≤**.
>
> **–ü–µ—Ä–µ–≤–∞–≥–∏:**
>
> 1. **–î—É–∂–µ —à–≤–∏–¥–∫—ñ —á–∏—Ç–∞–Ω–Ω—è:** –û–ø–µ—Ä–∞—Ü—ñ—ó `get` —Ç–∞ —ñ—Ç–µ—Ä–∞—Ü—ñ—è –Ω–µ –≤–∏–º–∞–≥–∞—é—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó.
> 2. **–ü–æ–≤–Ω—ñ—Å—Ç—é –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏–π —ñ—Ç–µ—Ä–∞—Ç–æ—Ä (`fail-safe`):** –Ü—Ç–µ—Ä–∞—Ç–æ—Ä –ø—Ä–∞—Ü—é—î –∑—ñ "–∑–Ω—ñ–º–∫–æ–º" –º–∞—Å–∏–≤—É, —â–æ —ñ—Å–Ω—É–≤–∞–≤ –Ω–∞ –º–æ–º–µ–Ω—Ç –π–æ–≥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è. –í—ñ–Ω –Ω—ñ–∫–æ–ª–∏ –Ω–µ –∫–∏–Ω–µ `ConcurrentModificationException`.
>
> **–ù–µ–¥–æ–ª—ñ–∫–∏:**
>
> 1. **–î—É–∂–µ "–¥–æ—Ä–æ–≥—ñ" –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑–∞–ø–∏—Å—É:** –ö–æ–∂–Ω–∞ –∑–º—ñ–Ω–∞ –≤–∏–º–∞–≥–∞—î –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤—Å—å–æ–≥–æ –º–∞—Å–∏–≤—É (O(n)).
> 2. **–ó–∞—Å—Ç–∞—Ä—ñ–ª—ñ –¥–∞–Ω—ñ:** –Ü—Ç–µ—Ä–∞—Ç–æ—Ä–∏ –Ω–µ –±–∞—á–∞—Ç—å –∑–º—ñ–Ω, –∑—Ä–æ–±–ª–µ–Ω–∏—Ö –ø—ñ—Å–ª—è —ó—Ö —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è.
>
> **–ö–ª–∞—Å–∏—á–Ω–∏–π –ø—Ä–∏–∫–ª–∞–¥:** –°–ø–∏—Å–æ–∫ —Å–ª—É—Ö–∞—á—ñ–≤ –ø–æ–¥—ñ–π (listeners). –î–æ–¥–∞–≤–∞–Ω–Ω—è/–≤–∏–¥–∞–ª–µ–Ω–Ω—è —Å–ª—É—Ö–∞—á—ñ–≤ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —Ä—ñ–¥–∫–æ, –∞ —ñ—Ç–µ—Ä–∞—Ü—ñ—è –ø–æ –Ω–∏–º –¥–ª—è —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è ‚Äî –¥—É–∂–µ —á–∞—Å—Ç–æ.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–Ω–∞–Ω–Ω—è –ø—Ä–∏–Ω—Ü–∏–ø—É "–∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –ø—Ä–∏ –∑–∞–ø–∏—Å—ñ" —Ç–∞ –≤–º—ñ–Ω–Ω—è –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `CopyOnWriteArrayList`.*

* * *

### **6 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–©–æ —Ç–∞–∫–µ `BlockingQueue` —ñ —è–∫—É –ø—Ä–æ–±–ª–µ–º—É –≤–æ–Ω–∞ –≤–∏—Ä—ñ—à—É—î? –ù–∞–≤–µ–¥—ñ—Ç—å –ø—Ä–∏–∫–ª–∞–¥–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ–π. ‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> **`BlockingQueue`** ‚Äî —Ü–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É `Queue`, —è–∫–µ –Ω–∞–¥–∞—î **–±–ª–æ–∫—É—é—á—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó** –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤.
>
> **–ü—Ä–æ–±–ª–µ–º–∞, —è–∫—É –≤–æ–Ω–∞ –≤–∏—Ä—ñ—à—É—î:**
>
> –í–æ–Ω–∞ —î —ñ–¥–µ–∞–ª—å–Ω–∏–º —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –¥–ª—è –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—ó –≤–∑–∞—î–º–æ–¥—ñ—ó –º—ñ–∂ –ø–æ—Ç–æ–∫–∞–º–∏-**–ø—Ä–æ–¥—é—Å–µ—Ä–∞–º–∏ (producers)** —Ç–∞ –ø–æ—Ç–æ–∫–∞–º–∏-**—Å–ø–æ–∂–∏–≤–∞—á–∞–º–∏ (consumers)**.
>
> * –Ø–∫—â–æ **—Å–ø–æ–∂–∏–≤–∞—á** –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –µ–ª–µ–º–µ–Ω—Ç –∑ **–ø–æ—Ä–æ–∂–Ω—å–æ—ó** —á–µ—Ä–≥–∏, –≤—ñ–Ω **–±–ª–æ–∫—É—î—Ç—å—Å—è** —ñ —á–µ–∫–∞—î, –¥–æ–∫–∏ **–ø—Ä–æ–¥—é—Å–µ—Ä** –Ω–µ –¥–æ–¥–∞—Å—Ç—å –Ω–æ–≤–∏–π –µ–ª–µ–º–µ–Ω—Ç.
> * –Ø–∫—â–æ **–ø—Ä–æ–¥—é—Å–µ—Ä** –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –¥–æ–¥–∞—Ç–∏ –µ–ª–µ–º–µ–Ω—Ç —É **–∑–∞–ø–æ–≤–Ω–µ–Ω—É** (–æ–±–º–µ–∂–µ–Ω—É –∑–∞ —Ä–æ–∑–º—ñ—Ä–æ–º) —á–µ—Ä–≥—É, –≤—ñ–Ω **–±–ª–æ–∫—É—î—Ç—å—Å—è** —ñ —á–µ–∫–∞—î, –¥–æ–∫–∏ **—Å–ø–æ–∂–∏–≤–∞—á** –Ω–µ –∑–∞–±–µ—Ä–µ –µ–ª–µ–º–µ–Ω—Ç —ñ –Ω–µ –∑–≤—ñ–ª—å–Ω–∏—Ç—å –º—ñ—Å—Ü–µ.
>
> **–û—Å–Ω–æ–≤–Ω—ñ –±–ª–æ–∫—É—é—á—ñ –º–µ—Ç–æ–¥–∏:**
>
> * `put(E e)`: –¥–æ–¥–∞—î –µ–ª–µ–º–µ–Ω—Ç, –±–ª–æ–∫—É—é—á–∏—Å—å, —è–∫—â–æ —á–µ—Ä–≥–∞ –ø–æ–≤–Ω–∞.
> * `take()`: –æ—Ç—Ä–∏–º—É—î —Ç–∞ –≤–∏–¥–∞–ª—è—î –µ–ª–µ–º–µ–Ω—Ç, –±–ª–æ–∫—É—é—á–∏—Å—å, —è–∫—â–æ —á–µ—Ä–≥–∞ –ø–æ—Ä–æ–∂–Ω—è.
>
> **–ü—Ä–∏–∫–ª–∞–¥–∏ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ–π:**
>
> * **`ArrayBlockingQueue`**: –æ–±–º–µ–∂–µ–Ω–∞ –∑–∞ —Ä–æ–∑–º—ñ—Ä–æ–º —á–µ—Ä–≥–∞ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –º–∞—Å–∏–≤—É.
> * **`LinkedBlockingQueue`**: –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ –æ–±–º–µ–∂–µ–Ω–∞ —á–µ—Ä–≥–∞ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∑–≤'—è–∑–∞–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É.
> * **`SynchronousQueue`**: —á–µ—Ä–≥–∞ –±–µ–∑ –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó —î–º–Ω–æ—Å—Ç—ñ. –ë—É–¥—å-—è–∫–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è `put` –±–ª–æ–∫—É—î—Ç—å—Å—è, –¥–æ–∫–∏ —ñ–Ω—à–∏–π –ø–æ—Ç—ñ–∫ –Ω–µ –≤–∏–∫–ª–∏—á–µ `take`, —ñ –Ω–∞–≤–ø–∞–∫–∏.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–†–æ–∑—É–º—ñ–Ω–Ω—è –ø–∞—Ç–µ—Ä–Ω—É "–ü—Ä–æ–¥—é—Å–µ—Ä-–°–ø–æ–∂–∏–≤–∞—á" —Ç–∞ —Ä–æ–ª—ñ `BlockingQueue` —è–∫ –∫–ª—é—á–æ–≤–æ–≥–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—É –¥–ª—è –π–æ–≥–æ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó.*

* * *

### **7 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–Ü—Ç–µ—Ä–∞—Ç–æ—Ä–∏ –¥–ª—è `ArrayList` —î `fail-fast`, –∞ –¥–ª—è `CopyOnWriteArrayList` ‚Äî `fail-safe`. –ü–æ—è—Å–Ω—ñ—Ç—å —Ä—ñ–∑–Ω–∏—Ü—é —É –ø–æ–≤–µ–¥—ñ–Ω—Ü—ñ. ‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> **`ArrayList` (`fail-fast`):**
>
> * **–ü–æ–≤–µ–¥—ñ–Ω–∫–∞:** –Ø–∫—â–æ –≤–∏ —ñ—Ç–µ—Ä—É—î—Ç–µ –ø–æ `ArrayList` —ñ –≤ —Ü–µ–π –∂–µ —á–∞—Å —ñ–Ω—à–∏–π –ø–æ—Ç—ñ–∫ (–∞–±–æ —Ç–æ–π —Å–∞–º–∏–π –ø–æ—Ç—ñ–∫, –∞–ª–µ –Ω–µ —á–µ—Ä–µ–∑ —ñ—Ç–µ—Ä–∞—Ç–æ—Ä) –≤–∏–¥–∞–ª—è—î –µ–ª–µ–º–µ–Ω—Ç, —ñ—Ç–µ—Ä–∞—Ç–æ—Ä –Ω–µ–≥–∞–π–Ω–æ –∫–∏–¥–∞—î **`ConcurrentModificationException`**.
> * **–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** –Ü—Ç–µ—Ä–∞—Ç–æ—Ä –ø—Ä–∞—Ü—é—î –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–º –º–∞—Å–∏–≤–æ–º —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ª—ñ—á–∏–ª—å–Ω–∏–∫ `modCount` –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –∑–º—ñ–Ω.
>
> **`CopyOnWriteArrayList` (`fail-safe`):**
>
> * **–ü–æ–≤–µ–¥—ñ–Ω–∫–∞:** –Ø–∫—â–æ –≤–∏ —ñ—Ç–µ—Ä—É—î—Ç–µ –ø–æ `CopyOnWriteArrayList` —ñ –≤ —Ü–µ–π —á–∞—Å —ñ–Ω—à–∏–π –ø–æ—Ç—ñ–∫ –≤–∏–¥–∞–ª—è—î –µ–ª–µ–º–µ–Ω—Ç, **–Ω—ñ—á–æ–≥–æ –Ω–µ —Å—Ç–∞–Ω–µ—Ç—å—Å—è**. –Ü—Ç–µ—Ä–∞—Ç–æ—Ä **–Ω–µ –∫–∏–Ω–µ –≤–∏–Ω—è—Ç–æ–∫** —ñ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç—å —Å–≤–æ—é —Ä–æ–±–æ—Ç—É.
> * **–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è:** –Ü—Ç–µ—Ä–∞—Ç–æ—Ä –ø—Ä–∞—Ü—é—î –Ω–µ –∑ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ—é –∫–æ–ª–µ–∫—Ü—ñ—î—é, –∞ –∑ **–Ω–µ–∑–º—ñ–Ω–Ω–æ—é –∫–æ–ø—ñ—î—é (–∑–Ω—ñ–º–∫–æ–º)** –º–∞—Å–∏–≤—É, —è–∫–∞ —ñ—Å–Ω—É–≤–∞–ª–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ—Ç–µ—Ä–∞—Ç–æ—Ä–∞. –ó–º—ñ–Ω–∏ –≤ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–º—É —Å–ø–∏—Å–∫—É —Å—Ç–≤–æ—Ä—é—é—Ç—å –Ω–æ–≤—É –∫–æ–ø—ñ—é, –Ω–µ –∑–∞—á—ñ–ø–∞—é—á–∏ —Ç—É, –∑ —è–∫–æ—é –ø—Ä–∞—Ü—é—î —ñ—Ç–µ—Ä–∞—Ç–æ—Ä.
> * **–ù–∞—Å–ª—ñ–¥–æ–∫:** —ñ—Ç–µ—Ä–∞—Ç–æ—Ä –±—É–¥–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –∑—ñ **–∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–º–∏ –¥–∞–Ω–∏–º–∏** ‚Äî –≤—ñ–Ω –Ω–µ –ø–æ–±–∞—á–∏—Ç—å –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ü—å–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ß—ñ—Ç–∫–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è –ø—Ä–∞–∫—Ç–∏—á–Ω–æ—ó —Ä—ñ–∑–Ω–∏—Ü—ñ —É –ø–æ–≤–µ–¥—ñ–Ω—Ü—ñ –¥–≤–æ—Ö —Ç–∏–ø—ñ–≤ —ñ—Ç–µ—Ä–∞—Ç–æ—Ä—ñ–≤ –ø—Ä–∏ –æ–¥–Ω–æ—á–∞—Å–Ω—ñ–π –º–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.*

* * *

### **8 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ß–æ–º—É `ConcurrentHashMap` –¥–æ–∑–≤–æ–ª—è—î `null` —è–∫ –∑–Ω–∞—á–µ–Ω–Ω—è, –∞–ª–µ –Ω–µ —è–∫ –∫–ª—é—á? ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –ó–∞–±–æ—Ä–æ–Ω–∞ –Ω–∞ `null` –∫–ª—é—á—ñ –≤ `ConcurrentHashMap` —î —Å–≤—ñ–¥–æ–º–∏–º –¥–∏–∑–∞–π–Ω–µ—Ä—Å—å–∫–∏–º —Ä—ñ—à–µ–Ω–Ω—è–º –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è **–Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç—ñ**.
>
> –í `ConcurrentHashMap` –º–µ—Ç–æ–¥ `get(key)` –ø–æ–≤–µ—Ä—Ç–∞—î `null` —É –¥–≤–æ—Ö –≤–∏–ø–∞–¥–∫–∞—Ö:
>
> 1. –Ø–∫—â–æ –∫–ª—é—á–∞ –Ω–µ —ñ—Å–Ω—É—î –≤ –º–∞–ø—ñ.
> 2. –Ø–∫—â–æ –∫–ª—é—á —ñ—Å–Ω—É—î, –∞–ª–µ –π–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–æ—Ä—ñ–≤–Ω—é—î `null`.
>
> –£ –±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ —Ç–∞–∫–∞ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ñ—Å—Ç—å —î –Ω–µ–±–µ–∑–ø–µ—á–Ω–æ—é. –ü–æ—Ç—ñ–∫, —â–æ –æ—Ç—Ä–∏–º–∞–≤ `null`, –Ω–µ –º–æ–∂–µ –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —á–∏ —Ü–µ –æ–∑–Ω–∞—á–∞—î –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∫–ª—é—á–∞, —á–∏ –∫–ª—é—á –±—É–≤, –∞–ª–µ —ñ–Ω—à–∏–π –ø–æ—Ç—ñ–∫ –≤–∏–¥–∞–ª–∏–≤ –π–æ–≥–æ, —á–∏ –∫–ª—é—á —î, –∞–ª–µ –π–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è ‚Äî `null`.
>
> **–î–æ–∑–≤–æ–ª–∏–≤—à–∏ `null` —è–∫ –∫–ª—é—á, –Ω–µ–º–æ–∂–ª–∏–≤–æ –±—É–ª–æ –± —Ä–æ–∑—Ä—ñ–∑–Ω–∏—Ç–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∫–ª—é—á–∞ –≤—ñ–¥ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –∫–ª—é—á–∞ `null` –∑ –Ω–µ–≤—ñ–¥–æ–º–∏–º –∑–Ω–∞—á–µ–Ω–Ω—è–º.**
>
> –©–æ–± —É—Å—É–Ω—É—Ç–∏ —Ü—é –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ñ—Å—Ç—å —ñ –∑—Ä–æ–±–∏—Ç–∏ –ø–æ–≤–µ–¥—ñ–Ω–∫—É –º–µ—Ç–æ–¥—É `get()` –ø—Ä–æ—Å—Ç–æ—é —Ç–∞ –ø–µ—Ä–µ–¥–±–∞—á—É–≤–∞–Ω–æ—é, —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∏ –≤–∏—Ä—ñ—à–∏–ª–∏ –∑–∞–±–æ—Ä–æ–Ω–∏—Ç–∏ `null` —è–∫ –∫–ª—é—á—ñ. –Ø–∫—â–æ `get(key)` –ø–æ–≤–µ—Ä—Ç–∞—î `null`, –≤–∏ –º–æ–∂–µ—Ç–µ –±—É—Ç–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ç–∞–∫–æ–≥–æ –∫–ª—é—á–∞ –≤ –º–∞–ø—ñ –Ω–µ–º–∞—î.
>
> `null` —è–∫ **–∑–Ω–∞—á–µ–Ω–Ω—è** –¥–æ–∑–≤–æ–ª–µ–Ω–æ, —Ç–æ–º—É —â–æ `containsKey(key)` –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –∫–ª—é—á–∞, —É—Å—É–≤–∞—é—á–∏ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ñ—Å—Ç—å.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ì–ª–∏–±–æ–∫–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è –¥–∏–∑–∞–π–Ω—É API –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∏—Ö –∫–æ–ª–µ–∫—Ü—ñ–π —Ç–∞ –ø—Ä–∏—á–∏–Ω, —â–æ —Å—Ç–æ—è—Ç—å –∑–∞ –ø–µ–≤–Ω–∏–º–∏ –æ–±–º–µ–∂–µ–Ω–Ω—è–º–∏.*

* * *

### **9 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ù–∞–ø–∏—à—ñ—Ç—å –∫–æ–¥, —è–∫–∏–π –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ "–≤—ñ—á–Ω–æ–≥–æ" –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ `Collections.synchronizedMap`, –∞–ª–µ –Ω–µ –∑ `ConcurrentHashMap`. ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> "–í—ñ—á–Ω–µ" –±–ª–æ–∫—É–≤–∞–Ω–Ω—è (deadlock) –º–æ–∂–µ –≤–∏–Ω–∏–∫–Ω—É—Ç–∏, —è–∫—â–æ –¥–≤–∞ –ø–æ—Ç–æ–∫–∏ –Ω–∞–º–∞–≥–∞—é—Ç—å—Å—è –∑–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–∏—Ö –∫–æ–ª–µ–∫—Ü—ñ–π —É —Ä—ñ–∑–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É.
>
> **`Collections.synchronizedMap` –±–ª–æ–∫—É—î –≤–µ—Å—å –æ–±'—î–∫—Ç.**
>
> ```java
> Map<String, String> map1 = Collections.synchronizedMap(new HashMap<>());
> Map<String, String> map2 = Collections.synchronizedMap(new HashMap<>());
>
> // –ü–æ—Ç—ñ–∫ 1
> new Thread(() -> {
>     synchronized (map1) {
>         try { Thread.sleep(100); } catch (Exception e) {}
>         synchronized (map2) {
>             // —â–æ—Å—å —Ä–æ–±–∏—Ç—å
>         }
>     }
> }).start();
>
> // –ü–æ—Ç—ñ–∫ 2
> new Thread(() -> {
>     synchronized (map2) { // –ë–ª–æ–∫—É—î –≤ –∑–≤–æ—Ä–æ—Ç–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É!
>         synchronized (map1) {
>             // —â–æ—Å—å —Ä–æ–±–∏—Ç—å
>         }
>     }
> }).start();
> ```
>
> **–°—Ü–µ–Ω–∞—Ä—ñ–π deadlock:**
>
> 1. –ü–æ—Ç—ñ–∫ 1 –±–ª–æ–∫—É—î `map1` —ñ —á–µ–∫–∞—î –Ω–∞ `map2`.
> 2. –ü–æ—Ç—ñ–∫ 2 –±–ª–æ–∫—É—î `map2` —ñ —á–µ–∫–∞—î –Ω–∞ `map1`.
> 3. –û–±–∏–¥–≤–∞ –ø–æ—Ç–æ–∫–∏ –±—É–¥—É—Ç—å —á–µ–∫–∞—Ç–∏ –≤—ñ—á–Ω–æ.
>
> **–ß–æ–º—É —Ü–µ –Ω–µ —Å—Ç–∞–Ω–µ—Ç—å—Å—è –∑ `ConcurrentHashMap`?**
>
> –¢–æ–º—É —â–æ `ConcurrentHashMap` –Ω–µ –±–ª–æ–∫—É—î –≤—Å—é –º–∞–ø—É. –ê—Ç–æ–º–∞—Ä–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó, —è–∫-–æ—Ç `putIfAbsent`, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ, –±—ñ–ª—å—à –≥—Ä–∞–Ω—É–ª—è—Ä–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è, —è–∫—ñ –Ω–µ –¥–æ–∑–≤–æ–ª—è—Ç—å —Ç–∞–∫–æ–º—É –ø—Ä–æ—Å—Ç–æ–º—É –¥–µ–¥–ª–æ–∫—É –≤–∏–Ω–∏–∫–Ω—É—Ç–∏. –ù–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ —Å–∫–ª–∞–¥–Ω—É –æ–ø–µ—Ä–∞—Ü—ñ—é, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –º–µ—Ç–æ–¥ `compute`, —è–∫–∏–π –ø—Ä–∏–π–º–∞—î –ª—è–º–±–¥—É —ñ –≤–∏–∫–æ–Ω—É—î —ó—ó –∞—Ç–æ–º–∞—Ä–Ω–æ –¥–ª—è –ø–µ–≤–Ω–æ–≥–æ –∫–ª—é—á–∞, –Ω–µ –±–ª–æ–∫—É—é—á–∏ –≤—Å—é –º–∞–ø—É.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–†–æ–∑—É–º—ñ–Ω–Ω—è —Ç–æ–≥–æ, —è–∫ —Ä—ñ–∑–Ω—ñ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó (–≥–ª–æ–±–∞–ª—å–Ω–µ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è vs –≥—Ä–∞–Ω—É–ª—è—Ä–Ω–µ) –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ —Ä–∏–∑–∏–∫ –≤–∏–Ω–∏–∫–Ω–µ–Ω–Ω—è –¥–µ–¥–ª–æ–∫—ñ–≤.*

* * *

### **10 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–Ø–∫ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –∞—Ç–æ–º–∞—Ä–Ω—É –æ–ø–µ—Ä–∞—Ü—ñ—é "–ø–µ—Ä–µ–≤—ñ—Ä-—ñ-–∑–º—ñ–Ω–∏" (`check-then-act`) –≤ `ConcurrentHashMap`? ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> `ConcurrentHashMap` –Ω–∞–¥–∞—î —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ –º–µ—Ç–æ–¥–∏ –¥–ª—è —Ü—å–æ–≥–æ, —è–∫—ñ –≥–∞—Ä–∞–Ω—Ç—É—é—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ñ—Å—Ç—å.
>
> **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π, –Ω–µ–∞—Ç–æ–º–∞—Ä–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥:**
>
> ```java
> if (!map.containsKey(key)) {
>     map.put(key, value);
> }
> ```
>
> –ú—ñ–∂ `containsKey` —Ç–∞ `put` –º–æ–∂–µ –≤—Ç—Ä—É—Ç–∏—Ç–∏—Å—è —ñ–Ω—à–∏–π –ø–æ—Ç—ñ–∫.
>
> **–ü—Ä–∞–≤–∏–ª—å–Ω—ñ, –∞—Ç–æ–º–∞—Ä–Ω—ñ –ø—ñ–¥—Ö–æ–¥–∏:**
>
> 1. **`putIfAbsent(K key, V value)`:**
>     * –î–æ–¥–∞—î –∑–∞–ø–∏—Å —Ç—ñ–ª—å–∫–∏ –≤ —Ç–æ–º—É –≤–∏–ø–∞–¥–∫—É, —è–∫—â–æ –∫–ª—é—á–∞ —â–µ –Ω–µ–º–∞—î. –¶–µ –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π –≤–∏–ø–∞–¥–æ–∫.
>
>     ```java
>     map.putIfAbsent("user:1", "default_value");
>     ```
>
> 2. **`replace(K key, V oldValue, V newValue)`:**
>     * –ó–∞–º—ñ–Ω—é—î –∑–Ω–∞—á–µ–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ –≤ —Ç–æ–º—É –≤–∏–ø–∞–¥–∫—É, —è–∫—â–æ –ø–æ—Ç–æ—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–æ—Ä—ñ–≤–Ω—é—î `oldValue`.
>
> 3. **`compute(K key, BiFunction remappingFunction)` (–∑ Java 8):**
>     * –ù–∞–π–±—ñ–ª—å—à –ø–æ—Ç—É–∂–Ω–∏–π –º–µ—Ç–æ–¥. –í—ñ–Ω –∞—Ç–æ–º–∞—Ä–Ω–æ –æ–±—á–∏—Å–ª—é—î –Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Å—Ç–∞—Ä–æ–≥–æ.
>
>     **–ü—Ä–∏–∫–ª–∞–¥: –ª—ñ—á–∏–ª—å–Ω–∏–∫ —Å–ª—ñ–≤.**
>
>     ```java
>     ConcurrentHashMap<String, Integer> wordCount = new ConcurrentHashMap<>();
>     String word = "hello";
>
>     // –ê—Ç–æ–º–∞—Ä–Ω–æ –∑–±—ñ–ª—å—à—É—î –ª—ñ—á–∏–ª—å–Ω–∏–∫ –¥–ª—è —Å–ª–æ–≤–∞
>     wordCount.compute(word, (k, v) -> (v == null) ? 1 : v + 1);
>     ```
>
> –¶–µ–π –∫–æ–¥ —î –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏–º —ñ –¥—É–∂–µ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–º.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–Ω–∞–Ω–Ω—è —Å—É—á–∞—Å–Ω–æ–≥–æ API `ConcurrentHashMap` —Ç–∞ –≤–º—ñ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –π–æ–≥–æ –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –∞—Ç–æ–º–∞—Ä–Ω–∏—Ö, –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π.*

* * *

### **11 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–£ —á–æ–º—É –æ—Å–Ω–æ–≤–Ω–∏–π –ø—Ä–∏–Ω—Ü–∏–ø —Ä–æ–±–æ—Ç–∏ `ConcurrentLinkedQueue`? –ß–æ–º—É –≤–æ–Ω–∞ –≤–≤–∞–∂–∞—î—Ç—å—Å—è –Ω–µ–±–ª–æ–∫—É—é—á–æ—é? ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> `ConcurrentLinkedQueue` ‚Äî —Ü–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∞, –Ω–µ–æ–±–º–µ–∂–µ–Ω–∞ —á–µ—Ä–≥–∞ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∑–≤'—è–∑–∞–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É.
>
> **–û—Å–Ω–æ–≤–Ω–∏–π –ø—Ä–∏–Ω—Ü–∏–ø —Ä–æ–±–æ—Ç–∏:**
>
> –í–æ–Ω–∞ –ø–æ–±—É–¥–æ–≤–∞–Ω–∞ –Ω–∞ **–Ω–µ–±–ª–æ–∫—É—é—á–∏—Ö (lock-free) –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö**. –ó–∞–º—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç—Ä–∞–¥–∏—Ü—ñ–π–Ω–∏—Ö `synchronized` –±–ª–æ–∫—É–≤–∞–Ω—å, –≤–æ–Ω–∞ –ø–æ–∫–ª–∞–¥–∞—î—Ç—å—Å—è –Ω–∞ **–∞—Ç–æ–º–∞—Ä–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –Ω–∞ —Ä—ñ–≤–Ω—ñ –ø—Ä–æ—Ü–µ—Å–æ—Ä–∞**, –∑–æ–∫—Ä–µ–º–∞ –Ω–∞ **CAS (Compare-And-Swap)**.
>
> **–Ø–∫ –ø—Ä–∞—Ü—é—î CAS (—Å–ø—Ä–æ—â–µ–Ω–æ):**
>
> 1. –û–ø–µ—Ä–∞—Ü—ñ—è `compareAndSet(expectedValue, newValue)` –∞—Ç–æ–º–∞—Ä–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –º–∞—î –∑–º—ñ–Ω–Ω–∞ –∑–Ω–∞—á–µ–Ω–Ω—è `expectedValue`.
> 2. –Ø–∫—â–æ —Ç–∞–∫, –≤–æ–Ω–∞ –æ–Ω–æ–≤–ª—é—î —ó—ó –Ω–∞ `newValue` —ñ –ø–æ–≤–µ—Ä—Ç–∞—î `true`.
> 3. –Ø–∫—â–æ –Ω—ñ (—Ç–æ–±—Ç–æ —ñ–Ω—à–∏–π –ø–æ—Ç—ñ–∫ –≤–∂–µ –∑–º—ñ–Ω–∏–≤ —ó—ó), –æ–ø–µ—Ä–∞—Ü—ñ—è –Ω—ñ—á–æ–≥–æ –Ω–µ —Ä–æ–±–∏—Ç—å —ñ –ø–æ–≤–µ—Ä—Ç–∞—î `false`.
>
> `ConcurrentLinkedQueue` –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î CAS –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω—å `next` —É —Å–≤–æ—ó—Ö –≤—É–∑–ª–∞—Ö. –ö—ñ–ª—å–∫–∞ –ø–æ—Ç–æ–∫—ñ–≤ –º–æ–∂—É—Ç—å –æ–¥–Ω–æ—á–∞—Å–Ω–æ –Ω–∞–º–∞–≥–∞—Ç–∏—Å—è –¥–æ–¥–∞—Ç–∏ –µ–ª–µ–º–µ–Ω—Ç. –¢–æ–π, —Ö—Ç–æ "–≤–∏–≥—Ä–∞—î" CAS-–≥–æ–Ω–∫—É, —É—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–∏—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è, –∞ —ñ–Ω—à—ñ —Å–ø—Ä–æ–±—É—é—Ç—å —â–µ —Ä–∞–∑.
>
> **–ß–æ–º—É –≤–æ–Ω–∞ –Ω–µ–±–ª–æ–∫—É—é—á–∞?**
>
> –¢–æ–º—É —â–æ –∂–æ–¥–µ–Ω –ø–æ—Ç—ñ–∫ –Ω–µ "–±–ª–æ–∫—É—î—Ç—å—Å—è" –≤ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—ñ –Ω–∞ –∑–Ω—è—Ç—Ç—è –±–ª–æ–∫—É–≤–∞–Ω–Ω—è. –ù–∞–≤—ñ—Ç—å —è–∫—â–æ CAS-–æ–ø–µ—Ä–∞—Ü—ñ—è –Ω–µ –≤–¥–∞–ª–∞—Å—è, –ø–æ—Ç—ñ–∫ –Ω–µ –∑–∞—Å–∏–Ω–∞—î, –∞ –ø—Ä–æ—Å—Ç–æ —Ä–æ–±–∏—Ç—å —â–µ –æ–¥–Ω—É —Å–ø—Ä–æ–±—É, —â–æ —î –¥—É–∂–µ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–º —É –≤–∏—Å–æ–∫–æ–Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö, –æ—Å–∫—ñ–ª—å–∫–∏ —É—Å—É–≤–∞—î –ø—Ä–æ–±–ª–µ–º–∏, —è–∫-–æ—Ç –¥–µ–¥–ª–æ–∫–∏ —Ç–∞ "–∫–æ–Ω–≤–æ—ó".

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–†–æ–∑—É–º—ñ–Ω–Ω—è –ø—Ä–∏–Ω—Ü–∏–ø—ñ–≤ `lock-free` –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è —Ç–∞ —Ä–æ–ª—ñ CAS-–æ–ø–µ—Ä–∞—Ü—ñ–π. –¶–µ –¥—É–∂–µ –ø—Ä–æ—Å—É–Ω—É—Ç–∞ —Ç–µ–º–∞.*

* * *

### **12 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ß–∏–º `Stack` –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≤—ñ–¥ `ArrayDeque` –∑ —Ç–æ—á–∫–∏ –∑–æ—Ä—É –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–æ—Å—Ç—ñ —Ç–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ? ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> * **`Stack` (–∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π –∫–ª–∞—Å):**
>   * **–ü–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—ñ—Å—Ç—å:** **–¢–∞–∫**, —î –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏–º. –í—ñ–Ω —É—Å–ø–∞–¥–∫–æ–≤—É—î –≤—ñ–¥ `Vector`, —ñ –≤—Å—ñ –π–æ–≥–æ –º–µ—Ç–æ–¥–∏ (`push`, `pop`) —î `synchronized`.
>   * **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:** **–ù–∏–∑—å–∫–∞**. –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –Ω–∞ –≤–µ—Å—å –æ–±'—î–∫—Ç, —â–æ —Å—Ç–≤–æ—Ä—é—î –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –¥–æ—Å—Ç—É–ø—ñ.
>
> * **`ArrayDeque` (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞):**
>   * **–ü–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—ñ—Å—Ç—å:** **–ù—ñ**, –Ω–µ —î –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏–º. –í—ñ–Ω —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–∏–π –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—ó –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –≤ **–æ–¥–Ω–æ–ø–æ—Ç–æ–∫–æ–≤–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ**.
>   * **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å:** **–î—É–∂–µ –≤–∏—Å–æ–∫–∞**, –∑–Ω–∞—á–Ω–æ –≤–∏—â–∞ –∑–∞ `Stack`, –æ—Å–∫—ñ–ª—å–∫–∏ –Ω–µ–º–∞—î –Ω–∞–∫–ª–∞–¥–Ω–∏—Ö –≤–∏—Ç—Ä–∞—Ç –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é.
>
> **–Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–µ–Ω –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏–π —Å—Ç–µ–∫:**
>
> * –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `Stack`.
> * –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `ArrayDeque` (–±–æ –≤—ñ–Ω –Ω–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏–π).
> * –ù–∞–π–∫—Ä–∞—â–∏–º –≤–∏–±–æ—Ä–æ–º —î —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è `Deque`, —è–∫–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, **`ConcurrentLinkedDeque`** –∞–±–æ **`LinkedBlockingDeque`**.
>
> –¢–∞–∫–∏–º —á–∏–Ω–æ–º, `Stack` —î –ø–æ–≥–∞–Ω–∏–º –∫–æ–º–ø—Ä–æ–º—ñ—Å–æ–º: –≤—ñ–Ω –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏–π, –∞–ª–µ –Ω–µ–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π —ñ –º–∞—î –ø–æ–≥–∞–Ω–∏–π –¥–∏–∑–∞–π–Ω. `ArrayDeque` ‚Äî —à–≤–∏–¥–∫–∏–π, –∞–ª–µ —Ç—ñ–ª—å–∫–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ—Ç–æ–∫—É.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–í–º—ñ–Ω–Ω—è –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –Ω–µ —Ç—ñ–ª—å–∫–∏ –∫–ª–∞—Å, –∞ –π –π–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç. –ó–Ω–∞–Ω–Ω—è —Ç–æ–≥–æ, —â–æ `Stack` –Ω–µ —î –≥–∞—Ä–Ω–∏–º –≤–∏–±–æ—Ä–æ–º –Ω–∞–≤—ñ—Ç—å —É –±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤–æ–º—É —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ.*

* * *

### **13 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–£—è–≤—ñ—Ç—å, —â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–∞ –º–∞–ø–∞, —è–∫–∞ –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è –±–∞–≥–∞—Ç—å–æ–º –ø–æ—Ç–æ–∫–∞–º, –∞–ª–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏—Å—è –±—É–¥–µ –ª–∏—à–µ –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó. –Ø–∫–∏–π –Ω–∞–π–∫—Ä–∞—â–∏–π —Å–ø–æ—Å—ñ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞–∫—É –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—É –º–∞–ø—É? ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –¶–µ –∫–ª–∞—Å–∏—á–Ω–∏–π —Å—Ü–µ–Ω–∞—Ä—ñ–π "read-mostly". `ConcurrentHashMap` –ø—ñ–¥—ñ–π–¥–µ, –∞–ª–µ —î —â–µ –∫—Ä–∞—â–µ, –ø—Ä–æ—Å—Ç—ñ—à–µ —ñ –±—ñ–ª—å—à —ñ–¥—ñ–æ–º–∞—Ç–∏—á–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è.
>
> **–ù–∞–π–∫—Ä–∞—â–∏–π —Å–ø–æ—Å—ñ–±:**
>
> 1. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–∞ –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ –∑–≤–∏—á–∞–π–Ω—É, **–Ω–µ–ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—É `HashMap`** –ø—ñ–¥ —á–∞—Å —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó.
> 2. –ü—ñ—Å–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è, "–æ–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏" —ó—ó –¥–ª—è —ñ–Ω—à–∏—Ö –ø–æ—Ç–æ–∫—ñ–≤, –æ–±–µ—Ä–Ω—É–≤—à–∏ —ó—ó –≤ **`Collections.unmodifiableMap()`**.
>
> ```java
> public class ConfigLoader {
>     private final Map<String, String> config;
>
>     public ConfigLoader() {
>         Map<String, String> tempMap = new HashMap<>();
>         // ... –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –º–∞–ø–∏
>         tempMap.put("db.url", "...");
>
>         // –†–æ–±–∏–º–æ —ó—ó –Ω–µ–∑–º—ñ–Ω–Ω–æ—é
>         this.config = Collections.unmodifiableMap(tempMap);
>     }
>
>     public Map<String, String> getConfig() {
>         return this.config;
>     }
> }
> ```
>
> **–ß–æ–º—É —Ü–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–æ —ñ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ?**
>
> 1. –ü—ñ—Å–ª—è –æ–±–≥–æ—Ä—Ç–∞–Ω–Ω—è –≤ `unmodifiableMap`, –º–∞–ø–∞ —Å—Ç–∞—î **—Ñ–∞–∫—Ç–∏—á–Ω–æ —ñ–º—É—Ç–∞–±–µ–ª—å–Ω–æ—é**.
> 2. **–Ü–º—É—Ç–∞–±–µ–ª—å–Ω—ñ –æ–±'—î–∫—Ç–∏ —î –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–∏–º–∏ "–∑ –∫–æ—Ä–æ–±–∫–∏"**. –û—Å–∫—ñ–ª—å–∫–∏ —ó—Ö–Ω—ñ–π —Å—Ç–∞–Ω –Ω–µ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏, –Ω–µ–º–∞—î –ø–æ—Ç—Ä–µ–±–∏ –≤ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –ø—Ä–∏ —á–∏—Ç–∞–Ω–Ω—ñ.
> 3. –û–ø–µ—Ä–∞—Ü—ñ—ó —á–∏—Ç–∞–Ω–Ω—è –±—É–¥—É—Ç—å —Ç–∞–∫–∏–º–∏ –∂ —à–≤–∏–¥–∫–∏–º–∏, —è–∫ —ñ –¥–ª—è –∑–≤–∏—á–∞–π–Ω–æ—ó `HashMap` (O(1)), —ñ –Ω–µ –±—É–¥—É—Ç—å –º–∞—Ç–∏ –Ω–∞–∫–ª–∞–¥–Ω–∏—Ö –≤–∏—Ç—Ä–∞—Ç –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é, —è–∫—ñ –±—É–ª–∏ –± —É `ConcurrentHashMap`.
>
> –¶–µ –¥—É–∂–µ –ø–æ—à–∏—Ä–µ–Ω–∏–π –ø–∞—Ç–µ—Ä–Ω –¥–ª—è –æ–±'—î–∫—Ç—ñ–≤-–∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–†–æ–∑—É–º—ñ–Ω–Ω—è –ø–µ—Ä–µ–≤–∞–≥ —ñ–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ –¥–ª—è –±–∞–≥–∞—Ç–æ–ø–æ—Ç–æ–∫–æ–≤–æ—Å—Ç—ñ. –ó–¥–∞—Ç–Ω—ñ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç—É–≤–∞—Ç–∏ –ø—Ä–æ—Å—Ç—ñ —Ç–∞ –Ω–∞–¥—ñ–π–Ω—ñ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è.*

* * *

### **14 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–Ø–∫–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è `BlockingQueue` –Ω–µ –º–∞—î –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ—ó —î–º–Ω–æ—Å—Ç—ñ —ñ –±–ª–æ–∫—É—î –ø—Ä–æ–¥—é—Å–µ—Ä–∞ –¥–æ –ø–æ—è–≤–∏ —Å–ø–æ–∂–∏–≤–∞—á–∞?

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –¶–µ **`SynchronousQueue`**.
>
> **`SynchronousQueue`** ‚Äî —Ü–µ –æ—Å–æ–±–ª–∏–≤–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—è `BlockingQueue`, —è–∫–∞ **–Ω–µ –º–∞—î –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–≥–æ –±—É—Ñ–µ—Ä–∞**. –í–æ–Ω–∞ –Ω–µ –º–æ–∂–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –∂–æ–¥–Ω–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç–∞.
>
> **–Ø–∫ –≤–æ–Ω–∞ –ø—Ä–∞—Ü—é—î:**
>
> * –ë—É–¥—å-—è–∫–∏–π –≤–∏–∫–ª–∏–∫ –º–µ—Ç–æ–¥—É `put(e)` –ø–æ—Ç–æ–∫–æ–º-–ø—Ä–æ–¥—é—Å–µ—Ä–æ–º –±—É–¥–µ **–±–ª–æ–∫—É–≤–∞—Ç–∏—Å—è**, –¥–æ–∫–∏ —ñ–Ω—à–∏–π –ø–æ—Ç—ñ–∫-—Å–ø–æ–∂–∏–≤–∞—á –Ω–µ –≤–∏–∫–ª–∏—á–µ –º–µ—Ç–æ–¥ `take()`.
> * –ù–∞–≤–ø–∞–∫–∏, –±—É–¥—å-—è–∫–∏–π –≤–∏–∫–ª–∏–∫ `take()` –ø–æ—Ç–æ–∫–æ–º-—Å–ø–æ–∂–∏–≤–∞—á–µ–º –±—É–¥–µ **–±–ª–æ–∫—É–≤–∞—Ç–∏—Å—è**, –¥–æ–∫–∏ —ñ–Ω—à–∏–π –ø–æ—Ç—ñ–∫-–ø—Ä–æ–¥—é—Å–µ—Ä –Ω–µ –≤–∏–∫–ª–∏—á–µ `put(e)`.
>
> –¶–µ –º–æ–∂–Ω–∞ —É—è–≤–∏—Ç–∏ —è–∫ –æ–ø–µ—Ä–∞—Ü—ñ—é **–ø—Ä—è–º–æ—ó "–ø–µ—Ä–µ–¥–∞—á—ñ –∑ —Ä—É–∫ –≤ —Ä—É–∫–∏"** –º—ñ–∂ –¥–≤–æ–º–∞ –ø–æ—Ç–æ–∫–∞–º–∏.
>
> `SynchronousQueue` —ñ–¥–µ–∞–ª—å–Ω–æ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó "—Ä–∞–Ω–¥–µ–≤—É" –º—ñ–∂ –ø–æ—Ç–æ–∫–∞–º–∏ –∞–±–æ –≤ —Å–∏—Å—Ç–µ–º–∞—Ö –æ–±—Ä–æ–±–∫–∏ –∑–∞–≤–¥–∞–Ω—å, –¥–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –≥–∞—Ä–∞–Ω—Ç—É–≤–∞—Ç–∏, —â–æ –∑–∞–≤–¥–∞–Ω–Ω—è –Ω–µ –Ω–∞–∫–æ–ø–∏—á—É—é—Ç—å—Å—è, –∞ –≤—ñ–¥—Ä–∞–∑—É –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –Ω–∞ –æ–±—Ä–æ–±–∫—É –≤—ñ–ª—å–Ω–æ–º—É –≤–∏–∫–æ–Ω–∞–≤—Ü—é.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–ó–Ω–∞–Ω–Ω—è –ø—Ä–æ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∏—Ö –∫–æ–ª–µ–∫—Ü—ñ–π.*

* * *

### **15 ‚ùì –ü–∏—Ç–∞–Ω–Ω—è:**

–ß–∏ –≥–∞—Ä–∞–Ω—Ç—É—é—Ç—å –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó, —â–æ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞, —è–∫–∞ —ó—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î, —Ç–∞–∫–æ–∂ –±—É–¥–µ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω–æ—é? ‚≠êÔ∏è‚≠êÔ∏è

> #### **üí¨ –í—ñ–¥–ø–æ–≤—ñ–¥—å:**
>
> –ù—ñ, **–Ω–µ –≥–∞—Ä–∞–Ω—Ç—É—é—Ç—å**.
>
> –ü–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó –≥–∞—Ä–∞–Ω—Ç—É—é—Ç—å –ª–∏—à–µ **–∞—Ç–æ–º–∞—Ä–Ω—ñ—Å—Ç—å —Ç–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å —Å–≤–æ—ó—Ö –≤–ª–∞—Å–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π**. –í–æ–Ω–∏ –Ω–µ –º–æ–∂—É—Ç—å –≥–∞—Ä–∞–Ω—Ç—É–≤–∞—Ç–∏ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—ñ—Å—Ç—å —Å–∫–ª–∞–¥–µ–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π –∞–±–æ –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∏, —è–∫–∞ —ó—Ö –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î.
>
> **–ü—Ä–∏–∫–ª–∞–¥ –ø—Ä–æ–±–ª–µ–º–∏:**
>
> –£—è–≤—ñ—Ç—å, —â–æ –≤–∏ —Ä–µ–∞–ª—ñ–∑—É—î—Ç–µ –æ–ø–µ—Ä–∞—Ü—ñ—é "–ø–µ—Ä–µ–∫–∞–∑—É –≥—Ä–æ—à–µ–π" –º—ñ–∂ –¥–≤–æ–º–∞ —Ä–∞—Ö—É–Ω–∫–∞–º–∏, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ `ConcurrentHashMap`.
>
> ```java
> public void transfer(String from, String to, long amount) {
>     long fromBalance = balances.get(from);
>     long toBalance = balances.get(to);
>
>     balances.put(from, fromBalance - amount);
>     balances.put(to, toBalance + amount);
> }
> ```
>
> –•–æ—á–∞ –∫–æ–∂–µ–Ω `get` —ñ `put` —î –∞—Ç–æ–º–∞—Ä–Ω–∏–º, –≤—Å—è –æ–ø–µ—Ä–∞—Ü—ñ—è `transfer` **–Ω–µ —î –∞—Ç–æ–º–∞—Ä–Ω–æ—é**.
>
> **–©–æ –º–æ–∂–µ –ø—ñ—Ç–∏ –Ω–µ —Ç–∞–∫:**
>
> 1. –ü–æ—Ç—ñ–∫ A —á–∏—Ç–∞—î –±–∞–ª–∞–Ω—Å–∏.
> 2. –ü–æ—Ç—ñ–∫ B —Ç–∞–∫–æ–∂ —á–∏—Ç–∞—î —Ç—ñ —Å–∞–º—ñ –±–∞–ª–∞–Ω—Å–∏ –¥–æ —Ç–æ–≥–æ, —è–∫ –ü–æ—Ç—ñ–∫ A —ó—Ö –æ–Ω–æ–≤–∏–≤.
> 3. –û–±–∏–¥–≤–∞ –ø–æ—Ç–æ–∫–∏ –≤–∏–∫–æ–Ω—É—é—Ç—å —Å–≤–æ—ó –æ–ø–µ—Ä–∞—Ü—ñ—ó, —ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–º (–æ–¥–∏–Ω –∑ –ø–µ—Ä–µ–∫–∞–∑—ñ–≤ –±—É–¥–µ "–≤—Ç—Ä–∞—á–µ–Ω–æ").
>
> **–†—ñ—à–µ–Ω–Ω—è:**
> –ü–æ—Ç—Ä—ñ–±–Ω–∞ **–∑–æ–≤–Ω—ñ—à–Ω—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è** –Ω–∞ —Ä—ñ–≤–Ω—ñ –±—ñ–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü—ñ—ó, —è–∫–∞ –æ—Ö–æ–ø–ª—é—î –≤—Å—ñ –¥—ñ—ó, —â–æ –º–∞—é—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω—ñ –∞—Ç–æ–º–∞—Ä–Ω–æ. –ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∞—Ç–æ–º–∞—Ä–Ω—ñ –º–µ—Ç–æ–¥–∏ —Å–∞–º–æ–≥–æ `ConcurrentHashMap` (`compute`).
>
> **–í–∏—Å–Ω–æ–≤–æ–∫:** –ü–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—ñ –∫–æ–ª–µ–∫—Ü—ñ—ó —î –±—É–¥—ñ–≤–µ–ª—å–Ω–∏–º–∏ –±–ª–æ–∫–∞–º–∏, –∞–ª–µ –≤–æ–Ω–∏ –Ω–µ –∑–≤—ñ–ª—å–Ω—è—é—Ç—å —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞ –≤—ñ–¥ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –¥—É–º–∞—Ç–∏ –ø—Ä–æ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é –Ω–∞ —Ä—ñ–≤–Ω—ñ –≤—Å—ñ—î—ó –±—ñ–∑–Ω–µ—Å-—Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó.

#### **üìå –©–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å:**

*–†–æ–∑—É–º—ñ–Ω–Ω—è —Ç–æ–≥–æ, —â–æ –ø–æ—Ç–æ–∫–æ–±–µ–∑–ø–µ—á–Ω—ñ—Å—Ç—å ‚Äî —Ü–µ –Ω–µ "—Å—Ä—ñ–±–Ω–∞ –∫—É–ª—è". –ó–¥–∞—Ç–Ω—ñ—Å—Ç—å —Ä–æ–∑—Ä—ñ–∑–Ω—è—Ç–∏ –∞—Ç–æ–º–∞—Ä–Ω—ñ—Å—Ç—å –æ–∫—Ä–µ–º–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π —Ç–∞ –∞—Ç–æ–º–∞—Ä–Ω—ñ—Å—Ç—å —Å–∫–ª–∞–¥–µ–Ω–∏—Ö –±—ñ–∑–Ω–µ—Å-—Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π.*
